---
layout: post
title: Migrating to MRTK2 - Mixed Reality Toolkit Standard Shader 'breaks'
date: '2019-05-06T16:15:00.001+02:00'
orgauthor: Joost van Schaik
tags:
- HoloLens
- Unity
- Windows Mixed Reality
- MRTK2
- HoloLens2
modified_time: '2019-05-06T16:18:30.841+02:00'
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-7035314704499869816
blogger_orig_url: https://dotnetbyexample.blogspot.com/2019/05/migrate-to-mrtk2-mixed-reality-toolkit.html
comment_issue_id: 327
---

<h2>Intro</h2><p>At this moment I am trying to learn as much as possible about the new <a href="https://github.com/Microsoft/MixedRealityToolkit-Unity" target="_blank"><a href="https://github.com/Microsoft/MixedRealityToolkit-Unity/blob/mrtk_release/Documentation/GettingStartedWithTheMRTK.md" target="_blank">Mixed Reality Toolkit 2</a>, to be ready for <a href="https://www.microsoft.com/en-us/hololens" target="_blank">HoloLens</a> 2 when it comes. I opted for using a rather brutal cold turkey learning approach: I took my existing <a href="https://www.microsoft.com/store/productId/9P6SVQQCP2SQ" target="_blank">AMS HoloATC</a> app, ripped out the ye goode olde HoloToolkit, and replaced it by the new MRTK2 - fresh from GitHub. Not surprisingly this breaks a lot. I am not sure if this is the intended way of migrating - it's like renovating the house by starting with bulldozering a couple of walls away. But this is the way I chose do it, as it forces me to adhere to the new style and learn how stuff works, without compromises. It also makes me very clear where things are going to break when I do this to <em>customer</em> apps. </p><p>So I am starting a series of short blog posts, that basically documents the bumps in the road as I encounter them, as well as how I swerved around them or solved them. I hope other people will benefit from this, especially as I will showing a lot of moved cheese. And speaking of...</p><h2>Help! My Standard Shader is broken!</h2><p>So you had this nice <a href="https://www.microsoft.com/en-us/windows/windows-mixed-reality" target="_blank">Mixed Reality</a> app that showed these awesome holograms:</p><p><img width="640" height="317" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190506/Before.png" border="0"></p><p>and then you decided to upgrade to the <a href="https://github.com/Microsoft/MixedRealityToolkit-Unity" target="_blank">Mixed Reality Toolkit</a> 2</p><p><img width="640" height="332" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190506/AfterUpgrade.png" border="0"></p><p>and you did not expect to see this. This is typically the color Unity shows when a material is missing or something in the shader is thoroughly broken. And indeed, if you look at the materials:</p><p><img style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190506/Materials.png" border="0"></p><p>something indeed is broken.</p><p><img style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190506/Broken.png" border="0"></p><h2>How to fix this</h2><p>There is good new, bad news, and slightly better news.</p><ul><li>The good news - it's easy to fix.</li><li>The bad news is - you have to do this for <em>every material in your apps that used the </em>'<em>old</em>' HTK Standard shader</li><li>The slightly better news - you can do this for multiple materials in one go. Provided they are all in one folder, or you do something nifty with search</li></ul><p>So, in your assets select your materials:</p><p><img style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190506/SelectAll.png" border="0"></p><p>Then in the inspector select the Mixed Reality Toolkit Standard Shader (again) :</p><p><img width="578" height="496" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190506/SelectShader.png" border="0"></p><p>And boom. Everything looks like it should. </p><p><img width="640" height="311" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190506/AfterFix.png" border="0"></p><p>Or nearly so,because although it carries the same name, it's actually a different shader. Stuff actually might look a wee bit different. In my sample app, especially the blue seems to look a bit different. </p><h2>So what happened?</h2><p>If you look what Git marks as changed, only the tree materials themselves are marked changed:</p><p><img style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190506/DiffShell.png" border="0"></p><p>and if you look at a diff, you will see the referenced file GUID for the shader is changed. So indeed, although it carries the same name (Mixed Reality Toolkit Standard), as far as Unity is concerned it's a different shader. </p><p><img width="640" height="313" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190506/DiffGit.png" border="0"></p><p>(you might want to click on the picture to be able to actually read this).</p><p>As you scroll down through the diff, you will see lots of additions too, so this is not only a different shader<em> id</em>, it's actually a different or new shader as well. Why they deliberately chose to break the shader ID - beats me. Maybe to make upgrading from one shader to another possible, or have both the old and the new one simultaneously work in one project, making upgrade easier. But since they have the same name, this might also induce confusion. Whatever- but this is what causes the shader to 'break' at upgrade, an now you know how to fix it, too.</p><h2>Conclusion</h2><p>I hope to have eliminated once source of confusion today, and I wish you a lot of fun <a href="https://mybuild.techcommunity.microsoft.com/home" target="_blank">watching the //BUILD 2019 keynote</a> in a few hours. </p><p>You can <a href="https://github.com/LocalJoost/MRTKMigrate1" target="_blank">find a demo project here</a>.</p><ul><li>Branch "<a href="https://github.com/LocalJoost/MRTKMigrate1/tree/master" target="_blank">master</a>" shows the original project with HoloToolkit</li><li>Branch "<a href="https://github.com/LocalJoost/MRTKMigrate1/tree/broken" target="_blank">broken</a>" shows the project upgraded to MRTK2 - with broken shaders</li><li>Branch "<a href="https://github.com/LocalJoost/MRTKMigrate1/tree/fixed" target="_blank">fixed</a>" shows the fixed project</li></ul>
