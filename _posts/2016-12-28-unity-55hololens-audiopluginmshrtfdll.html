---
layout: post
title: 'Unity 5.5/HoloLens: AudioPluginMsHRTF.dll has failed the AppContainerCheck
  check'
date: '2016-12-28T15:20:00.000+01:00'
author: Joost van Schaik
tags:
- UWP
- HoloLens
- Spatial Sound
- Unity3D
modified_time: '2017-02-17T17:55:43.813+01:00'
thumbnail: https://lh3.googleusercontent.com/-kqkqUUcvc54/WGPKQHWw7OI/AAAAAAAAOjA/5TyBXLT5cOo/s72-c/image_thumb%25255B6%25255D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-5388813753192183057
blogger_orig_url: https://dotnetbyexample.blogspot.com/2016/12/unity-55hololens-audiopluginmshrtfdll.html
---

<p>All right, so I was finally past a couple of deadlines with paid HoloLens apps and was ready to take the plunge to update my app <a href="ms-windows-store://pdp/?ProductId=9NBLGGH52SZP" target="_blank">AMS HoloATC</a> to Unity 5.5 and the newest <a href="https://github.com/Microsoft/HoloToolkit-Unity" target="_blank">HoloToolkit</a>. After wrestling my way past some some interesting breaking changes (more about that later), I was finally at the point where everything worked again as it did before – and started adding new features. Today was the day I thought it was ready enough to justify a new submission to the store. I had tested everything thoroughly, so what could possibly go wrong.</p> <p><a href="https://lh3.googleusercontent.com/-74KF2g0Rc_Y/WGPKPdNBsWI/AAAAAAAAOi8/FIvRKDZjqJo/s1600-h/image%25255B12%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="https://lh3.googleusercontent.com/-kqkqUUcvc54/WGPKQHWw7OI/AAAAAAAAOjA/5TyBXLT5cOo/image_thumb%25255B6%25255D.png?imgmax=800" width="654" height="416"></a></p> <p><img title="View source image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: right; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="Image result for wtf" src="http://evolutionaryparenting.com/wp-content/uploads/2015/01/picard-wtf.jpg" width="182" align="right" height="143"></p> <p>Why, if it ain’t my dear old friend the WACK. The 'binary analyzer' has found a file <strong>AudioPluginMsHRTF.dll</strong> that does not pass the AppContainerCheck and the WACK gives me a whole bunch of suggestions that don't mean anything to me. Apparently I have to add a couple of options when I link the app, but I have not seen a linker since I wrote my last C program, which was – I think – before 2000. Now I know the WACK has some issues, so I tried submitting it anyway – but no dice. The Windows Store spitted it right back to me, with the same error. So now what?</p> <p>Fortunately I have had <a href="http://localjoost.github.io/2016/11/13/a-hololens-airplane-tracker-7activating.html" target="_blank">dealt with Spatial Sound before</a> and recognized the “Ms HRTF Spatializer” as something I just selected in Unity<em>. </em>After numerous (time consuming) failures trying to juggle the WACK, I took a desperate measure. I went back to a machine that had a previous installation of Unity on it – 5.4 – and checked AudioPluginMsHRTF.dll there. I found it in <br>C:\Program Files\Unity HoloLens 5.4.0f3-HTP\Editor\Data\VR\Unity\WindowsStoreApps. It reports being its size as 2931200 bytes<br>For Unity 5.5, in <br>C:\Program Files\Unity550f3\Editor\Data\UnityExtensions\Unity\VR\WindowsStoreApps\uap_x86, there’s a file of 13312 bytes big. Only 13kb. Yet, when you deploy and app with this only 13kb dll to a HoloLens Spatial Sound works. You can clearly hear the difference – simple stereo versus spatial sound.</p> <p>So I went about and looked around where this dll is taken from when Visual Studio project is built, and found it comes from the plugins directory in the project directory of the generated solution. In my case that’s C:\Projects\AMS_HoloATC\AMS HoloATC\App\AMS HoloATC\Plugins\X86. I replaced the 13kb AudioPluginMsHRTF.dll by the one I had taken from the 5.4 installation. That fixed the WACK. Unfortunately, it also made the app crash whenever I used Spatial Sound. Nice try, no cigar. But it conformed my suspicions that the 5.5 version of this dll is indeed the thing that makes the WACK protest.</p> <p><a href="https://lh3.googleusercontent.com/-T6YS8Jhe10k/WGQLXhwKHLI/AAAAAAAAOjU/Jwg6SYL5Rfw/s1600-h/image%25255B5%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: left; padding-top: 0px; padding-left: 0px; margin: 0px 7px 0px 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="https://lh3.googleusercontent.com/-3ZTkqjglduM/WGQLX8lupZI/AAAAAAAAOjY/x3vHCHFUV64/image_thumb%25255B3%25255D.png?imgmax=800" width="194" align="left" height="244"></a>So what I did, in the end, was just get rid of ‘real’ Spatial Sound. I went to Edit/Project settings in Unity and set “Spatializer Plugin” to “None”, disabling the Ms HRTF Spatializer. Re-created the Visual Studio solution from complete scratch, and the reference to AudioPluginMsHRTF.dll and AudioPluginMsHRTF.pdb were gone. And so was the WACK error.</p> <p>But of course, now my app has no real spatial sound anymore – it’s reduced to ‘normal’ Unity Stereo Panning. But a running app is better than one that does not. I have filed a bug at Unity with a repro and contacted some people within Microsoft. I will keep you posted about any progress. In the mean time, this should keep you going forward.</p> <p>For those who want to try out themselves, I have made this <a href="https://1drv.ms/u/s!AjesCJDYqwYk1NlSQpOzMEG6Qvxu-w" target="_blank">zipped up solution including all the files I built</a>, and you can easily check the resulting app does not pass the WACK. </p> <p><strong>Update 30-dec-2016 </strong>– the issue has been <a href="https://issuetracker.unity3d.com/product/unity/issues/guid/865507/" target="_blank">confirmed as a bug by Unity</a> and will be addressed.</p> <p><strong>Update 31-jan-2016 </strong>– the issue has been fixed – in Unity 5.5.1p2 or higher.</p>