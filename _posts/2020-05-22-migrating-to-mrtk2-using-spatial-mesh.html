---
layout: post
title: 'Migrating to MRTK2: using a Spatial Mesh inside the Unity Editor'
date: '2020-05-22T06:50:00.000+02:00'
author: Joost van Schaik
tags:
- HoloLens
- Windows Mixed Reality
- MRTK2
- Unity3D
- HoloLens2
modified_time: '2020-07-22T12:16:22.078+02:00'
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-6010350203616313631
blogger_orig_url: https://dotnetbyexample.blogspot.com/2020/05/migrating-to-mrtk2-using-spatial-mesh.html
---

<h2>Intro</h2><p><img width="257" height="146" align="right" style="border: 0px currentcolor; border-image: none; float: right; display: inline; background-image: none;" src="https://www.schaikweb.net/blog/20200520/00_hero.png" border="0">If you are developing an app using the <a href="https://www.microsoft.com/en-us/windows/windows-mixed-reality" target="_blank"><a href="https://github.com/Microsoft/MixedRealityToolkit-Unity" target="_blank">Mixed Reality Toolkit</a> 2 that requires interaction with a Spatial Mesh, the development process can become cumbersome: add code or assets with Unity and Visual Studio, create IL2CPP solution, wait, compile and deploy, wait, check behavior - rinse and repeat. You quickly learn to do as much as possible inside the Unity editor and/or use Holographic Remoting if you want stay productive and make your deadline. But a Spatial Mesh inside the Unity Editor does not exist.</p><p>... or does it? ;)</p><h2>Begun the Clone Wars have again</h2><p>You guessed it - before we can see anything at all, a lot of cloning and configuring of profiles needs to be happening first. </p><ul><li>Clone the Toolkit Configuration Profile itself. I used DefaultHoloLens2CameraProfile this time. </li><li>Turn off the diagnostics (as ever).</li><li>Enable Spatial Awareness System</li><li>Clone the MixedRealityAwareness profile</li><li>Clone the MixedRealityAwarenessMeshObserver profile (the names of these things become more tongue-breaking the deeper you go)</li><li>Change the Display option (all the way down) to "Occlusion"</li></ul><p><img style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20200520/02_occlusion.png" border="0"></p><h2>And now the interesting part</h2><p>On top of the Spatial Awareness System Settings there's this giant button over the whole length of the UI which is labeled "+ Add Spatial Observer". </p><p><img style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20200520/03_addobserver.png" border="0"></p><p>If you click that one, it will add a "New data provider 1" at the bottom, below the Display settings we just changed the previous step.</p><p><img style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20200520/04_newdataprovider.png" border="0"></p><p>Select "SpatialObjectMeshObserver" for type</p><p><img width="640" height="127" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20200520/05_selectobserver.png" border="0"></p><p>And if you hit the play button, lo and behold:</p><p><img width="640" height="701" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20200520/06_spatialmap1.png" border="0"></p><p>Basically you are now already where you want to be, but although the wireframe material works very well inside a <a href="https://www.microsoft.com/en-us/hololens" target="_blank">HoloLens</a>, it does not work very well in an editor. At least, that is my opinion. </p><h2>Making the mesh more usable inside the editor</h2><p>You might have noticed the SpatialObjectMeshObserver comes with a with a profile "DefaultObjectMeshObserverProfile" - I'd almost say <em>of course</em> it does. Anyway, clone that one as well. Then we create a simple material:</p><p><img width="453" height="480" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20200520/07_material.png" border="0"></p><p>Of course using the <a href="https://www.microsoft.com/en-us/windows/windows-mixed-reality" target="_blank">Mixed Reality</a> Toolkit Standard shader. I only change the color to RGB 115,115,115 which is a kind of battleship grey. You make take any color you fancy, as far as I am concerned. Set that material to the "Visible Material" of the Spatial Mesh Object Observer you just added (<em>not</em> in the material of the "Windows Mixed Reality Spatial Mesh Observer"!)</p><p><img width="640" height="153" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20200520/08_setmaterial.png" border="0"></p><p>The result, if you run play mode again, is definitely better IMHO:</p><p><img width="640" height="694" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20200520/09_spatialmap2.png" border="0"></p><h2>Using a mesh of a custom environment</h2><p>So it's nice to be able to use some sample mesh, but what if you need to the mesh of a real space? No worries, because just like in HoloLens1, the device portal allows you to download a scan of the current (real) space the HoloLens sees:</p><p><img width="640" height="391" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20200520/10_downloadspatialmap.png" border="0"></p><p>You can download this space by hitting the save button. This will download a SpatialMapping.obj file. Bring this into your Unity project, then drag it on top of the Spatial Mesh Object observer's "Spatial Mesh Object" property:</p><p><img width="640" height="151" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20200520/11_usespatialmap.png" border="0"></p><p>And then, when you hit play mode, you will see the study where I have been hiding in during these worrying times. It has been my domain for working for the past 2.5 months for working and blogging, as well as following BUILD and the Mixed Reality Dev Days. If you download the <a href="https://github.com/LocalJoost/ExampleSpatialMeshExample" target="_blank">demo project</a>, it will also include a cube that moves forward, to show objects actually bounce off the fake spatial mesh, just like a real spatial mesh. </p><p><img width="640" height="697" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20200520/12_bounce.png" border="0"></p><p>Note: if you compile and deploy this project to a HoloLens (either 1 or 2) you won't see this 'fake mesh' at all. It only appears in the editor. Which is exactly what we want. It's for development purposes only.</p><h2>Conclusion</h2><p>Using this little technique you can develop for interacting with the Spatial Mesh while staying inside the Unity editor. You will need less access to a physical HoloLens 2 device, but more importantly speed up development this way. <a href="https://github.com/LocalJoost/ExampleSpatialMeshExample" target="_blank">The demo project is, al always, on GitHub</a></p>