---

title: A HoloLens airplane tracker 6–adding an airport (and a tower)
date: '2016-10-26T13:32:00.000+02:00'
orgauthor: Joost van Schaik
tags:
- UWP
- HoloLens
- Unity3D
modified_time: '2016-10-31T11:33:23.826+01:00'
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-891712076559964409
blogger_orig_url: https://dotnetbyexample.blogspot.com/2016/10/a-hololens-airplane-tracker-6adding.html
---

<h2>Intro</h2> <p>This episode is nearly codeless, it’s all Unity and general geeky GIS stuff. We are going to cut out a piece of <a href="https://www.openstreetmap.org" target="_blank">OpenStreetMap</a> to depict the location of Schiphol. We are also putting a real 3D ATC tower on the map. If you look closely, it has only a very superficial liking to that of the actual Schiphol ATC tower, but those are just <em>minor</em> details ;) </p> <h2><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_E4C9/schiphol3.png"><img title="schiphol[3]" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: right; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="schiphol[3]" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_E4C9/schiphol3_thumb.png" width="228" align="right" height="304"></a>Getting and positioning the map</h2> <p>Getting it was easy enough. As I wrote, I went about to cut out a piece of rectangular OpenStreetMap that contains Schiphol airport and, incidentally and certainly not coincidentally, the <a href="https://www.google.nl/maps/@52.3467827,4.7507884,3a,75y,23.14h,90.64t/data=!3m6!1e1!3m4!1s4483lSDzlR1-QvRvlUB_Iw!2e0!7i13312!8i6656" target="_blank">Wortell offices</a>. We will deal with that in the final episode of the series.</p> <p>Now <em>positioning</em> that map is a little tricky, as I have set the center Unity’s coordinate system to the center of Schiphol according to Google Maps. But the center of Schiphol, according to <a href="http://www.latlong.net/" target="_blank">this nifty site</a> which also displays coordinates, is found at a location that is about 25% from the bottom of the image and a little to the left. </p><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_E4C9/image.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: left; padding-top: 0px; padding-left: 0px; margin: 0px 6px 0px 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_E4C9/image_thumb.png" width="197" align="left" height="192"></a>  <p>The way I solved this was with a little bit of knowledge of geo coordinates and an advanced technique I learned in my years in Geo Information Systems, which can be described as ‘fiddling until it fits’ ;)</p> <p>First order of business is to try and find out as closely as you can the lat/lon coordinates of the upper left and the lower right corner of the image. I also used <a href="http://www.latlong.net/" target="_blank">latlong.net</a> for that. As far as I could see, top/left is (52.368739, 4.706697) and bottom right (52.285193, 4.811196), while the center of Schiphol is (52.307687, 4.767424)</p> <p>Now we need to go back to <a href="http://localjoost.github.io/2016/09/28/converting-latlon-coordinates-to-local.html" target="_blank">a precursor to this series</a> in which I explained how to convert lat/lon coordinates to Unity’s X/Y/Z coordinates using a tangential plane. We can convert these coordinates using this code</p><pre>double x, y, z;

GpsUtils.GeodeticToEnu(52.368739, 4.706697, 0, 52.307687, 4.767424, 0, 
  out x, out y, out z);
Debug.WriteLine($"{x / 15000},{y / 15000}");

GpsUtils.GeodeticToEnu(52.285193, 4.811196, 0, 52.307687, 4.767424, 0, 
  out x, out y, out z);
Debug.WriteLine($"{x / 15000},{y / 15000}");</pre>
<p>Note I ignore the Z coordinate, and I divide the result by 15000 as that is how I scaled the airplane data as well. The result is</p>
<p>-0.275750329947415,0.453014630195657<br>0.199135521004053,-0.166804762707821</p>
<p>So we now know the map in Unity is 0.474885850951468 (east-west) by 0.619819392903478 (north-south) meters. We will need this knowledge soon. But first, drag your map cut-out into your App/Textures folder in Unity:</p>
<p><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_thumb.png" width="244" height="144"></a></p>
<p>Then proceed to create a <em>material</em> based upon this texture. In the Materials folder, right-click, hit Create/Material and call the material “SchipholMaterial” (or whatever it is you fancy). Then drag your Schiphol texture on top of the “Albedo map” square</p>
<p><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_3.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_thumb_3.png" width="244" height="104"></a></p>
<p>Next, click the white rectangle to the right of the Albedo square. That pops up a color picker – set the color to B3B3B3FF to make the Schiphol map a bit less overly bright.</p>
<p><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_E4C9/image_3.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_E4C9/image_thumb_3.png" width="154" height="292"></a></p>
<p>Then, in HologramCollection, create a 3D Plane object. Initially this will look like this:</p>
<p><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_4.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_thumb_4.png" width="654" height="348"></a></p>
<p>What is important to wrap your head around is that at scale 1:1, a plane’s size is 10x10 of these blocks which is 10x10 <em>meters</em> in HoloLens. We need to reduce that size so that it’s about 0.62 by 0.475 meters as that is 1:15000 scale. As 10m = scale 1, we need to scale the plane by 0.0475 for X, and 0.062 for Z (leave Y to 1). </p>
<p>Now drag your SchipholMaterial below the “Add Component” button on your Plane. Yes! Unity shows or Schiphol map, with the right dimensions, the right size…</p>
<p><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_5.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_thumb_5.png" width="504" height="260"></a></p>
<p>… upside down. Life – and Unity is - full of these little surprises. I have <em>no</em> idea why this is necessary, but if you go to the transform section of the object and hit “180” in the Rotation Y box, </p>
<p><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_6.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_thumb_6.png" width="504" height="262"></a></p>
<p>… that will fix it. Unfortunately, we are still not done, and I will show you why. Add a Sphere to the HologramCollection, size it 0.015 in all directions, give it the Trail Line as material. You will notice a blue dot in the middle of the image if you look from above. That’s 0,0,0 according to Unity.</p>
<p><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_7.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_thumb_7.png" width="304" height="397"></a></p>
<p>(I toned down the light a little to make this better visible). Unfortunately, as I stated before, 0,0,0 should be on another place, quite a bit down and to the right, near the “Schiphol” label. If we continue to use this, airplanes taking off won’t be properly aligned with the runways :(. </p>
<p>Back to what we found earlier. The corners of the map should be </p>-0.275750329947415,0.453014630195657<br>0.199135521004053,-0.166804762707821 
<p>on <a href="http://localjoost.github.io/2016/09/28/converting-latlon-coordinates-to-local.html" target="_blank">the tangential plane we created and used the center of Schiphol</a> as found by Google Maps as 0,0 in the horizontal plane. Now what follows this might look odd, but there is logic to that.</p>
<ul>
<li>Summarize both X values, and divide the result by two. That is half of the <em>difference in distance to what should be the X-center</em>. This is about –0.038 
<li>Summarize both Y values, and divide that result by two as well. That is half of the <em>difference in distance to what should be the Z-center </em>(yeah, gets me every time too – what you tend to think of as Y from your Math class, is Z in Unity). This is about 0.143 
<li>Add those values to X and Z position in the Plane’s transform:</li></ul>
<p><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_8.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_thumb_8.png" width="304" height="79"></a></p>
<p>And boom. Compare that to the Google maps marker coordinate and that seems to fit <em>pretty </em>well. </p><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_9.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_thumb_9.png" width="275" height="204"></a><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_E4C9/image.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; margin: 0px 6px 0px 20px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_E4C9/image_thumb.png" width="197" height="200"></a> 
<p>Not an exact fit, but that’s because we manually determined the corner’s lat/lon positions. But we are not talking zoning permits here (lengthy legal battles have been fought over mere centimeters on those in my lovely country) so it will do for this app. </p>
<p>I left the sphere in the project as a reference but disabled it, as we don’t need it anymore but you can enable it again and see it indeed shows up at the center of the map.</p>
<p>So. Now we have a properly sized and positioned map. There is a tiny detail missing.</p>
<h2>Adding an ATC tower</h2>
<p>Once again we go to CGTrader and browse around for a tower. Unfortunately the <a href="https://www.bing.com/images/search?q=schiphol+atc+tower&amp;view=detailv2&amp;&amp;id=33D8C20BE99F79748625D06979EBFA8E44BEF69B&amp;selectedIndex=3&amp;ccid=V6m%2fdRb4&amp;simid=608023454551377581&amp;thid=OIP.M57a9bf7516f8b006141d4e0125d6fe61o0&amp;ajaxhist=0" target="_blank">iconic Schiphol ATC tower</a> is not available (paid or free) so I settled for the <a href="https://www.cgtrader.com/free-3d-models/architectural-exterior/industrial/hong-kong-airport-control-tower" target="_blank">Hong Kong ATC tower</a> that bears some superficial resemblance to it. Unfortunately there is some building in the attached to the actual tower in model - that I neither need or want. I followed this rather crude work flow to deal with that:</p>
<ul>
<li>I downloaded the model fbx model zip file 
<li>Unpacked it, and renamed 3d-model.fbx to tower.fbx 
<li>I created a folder “Tower” in my Assets folder in the Unity editor 
<li>I dragged the tower.fbx into that folder 
<li>And then I dragged the resulting tower prefab on the HologramCollection. It will be<em> very</em> large. 
<li>Set its position to far far away, like 5000,5000,5000 to be out of the way of what we have already created. 
<li>Double click on “Tower” to get in into view. I got about this:</li></ul>
<p><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_10.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_thumb_10.png" width="304" height="387"></a></p>
<p>Rotate around it till you get about this:</p>
<p><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_11.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_thumb_11.png" width="304" height="314"></a></p>
<p>Now what we want to get rid off, is the <em>building</em> next to the tower. I don’t know if I am legally entitled to <em>change</em> a model, so I limit myself to <em>hiding parts of it</em>. This works as follows.</p>
<ul>
<li>First, make sure this button is selected. </li></ul>
<p><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_12.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; margin: 0px 0px 6px 37px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_thumb_12.png" width="189" height="65"></a></p>
<ul>
<li>Select the model by clicking on the <em>building. </em>Not the tower. This will select the whole model nonetheless </li>
<li>Click the building again. This will only select the building 
<li>Go to the inspector. Uncheck the checkbox all the way to the top left</li></ul>
<p><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_13.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_thumb_13.png" width="304" height="134"></a></p>
<p>That will get rid of most of the unwanted stuff:</p>
<p><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_14.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_thumb_14.png" width="304" height="330"></a></p>
<p>See? Rinse and repeat until all the stuff you don’t want is invisible. Remember: click once selects the whole model, click twice to select only what you want. Hidden too much? CTRL-Z is your friend. It’s a bit of a hassle, especially the small floating bits just right of the tower, but in the end you should be left with just this:</p>
<p><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_15.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_thumb_15.png" width="304" height="289"></a></p>
<p>When you are done, scale the tower to 0.001,0.001,0.001 and put it’s location to 0,0,0. Select the Main Camera, then GameObject/Align View to Selected and you will see Schiphol again, with a tiny ATC tower standing on top of it. If you look at it almost dead from above, you will see that it’s a bit off to the right and the bottom, according to this aerial picture from Google Maps that ironically enough blocks the view of the actual tower itself with a label – so I marked it with a red circle</p>
<p><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_16.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_thumb_16.png" width="244" height="222"></a><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_17.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; margin: 0px 0px 0px 15px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_thumb_17.png" width="287" height="222"></a></p>
<p>As it is the wrong tower – and as it’s not to scale, I did not bother with calculating it exact position but dragged it around a bit until it looked like it was in the same spot, which was –0.0283 for X and 0.0316 for Z. Fiddling a bit around with the view spot so I could see the tower’s base hitting the ground made it look like this:</p>
<p><a href="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_18.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/A-HoloLens-airplane-tracker-6Adding-an-a_8491/image_thumb_18.png" width="393" height="304"></a></p>
<p>And that’s fine with me. I’ll call it a day.</p>
<h2>Conclusion</h2>
<p>I have shown you how to orientate, scale and properly position (geographical) maps and objects on those maps in Unity, using some GIS knowledge, calculus, common sense and fiddling around. This makes your app look just that little extra pretty, plus it bases it in ‘real space’ which makes it extra cool.</p>
<p>Code – well, more like assets and config, <a href="https://github.com/LocalJoost/HoloATC_Demo/tree/Blog6" target="_blank">can be found here</a>. And I’d like to say hi to my fellow MVP <a href="https://twitter.com/tomverhoeff" target="_blank">Tom Verhoeff</a> and his trainee Ryan, who seem to like this tutorial so I hope I made both their days ;)</p>