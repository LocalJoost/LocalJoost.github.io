---
layout: post
title: Scanning physical objects with an Xbox One Kinect to use as Holograms in HoloLens
date: '2017-01-31T12:28:00.001+01:00'
orgauthor: Joost van Schaik
tags:
- HoloLens
- Kinect
modified_time: '2017-02-24T07:52:18.809+01:00'
thumbnail: https://lh3.googleusercontent.com/-9kND7Q3Ay7o/WJB0uZAJDzI/AAAAAAAAOnU/eMrWOCaAf2U/s72-c/image_thumb.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-4537276196905090091
blogger_orig_url: https://dotnetbyexample.blogspot.com/2017/01/scanning-physical-objects-with-xbox-one.html
comment_issue_id: 274
---

<h2>Intro</h2> <p><a href="https://lh3.googleusercontent.com/-xm394bxhGno/WJB0t4tfOtI/AAAAAAAAOnQ/uZHKsxDglbc/s1600-h/image%25255B2%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: right; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="https://lh3.googleusercontent.com/-9kND7Q3Ay7o/WJB0uZAJDzI/AAAAAAAAOnU/eMrWOCaAf2U/image_thumb.png?imgmax=800" width="244" align="right" height="215"></a>There are several demos out there that show obviously <i>scanned</i> models of people or physical objects used in HoloLens applications. I think it was fellow MVP and Dresdener 3D genius <a href="https://twitter.com/rschu" target="_blank">René Schulte</a> who first <a href="https://twitter.com/rschu/status/737767579108974593" target="_blank">used his bust in a demo</a> or at least went public with it. Unfortunately I have not been able to find very much about the actual process used to do the scanning and get to this result, so I have been trying to kludge together a procedure to make a full color 3d scan of a physical object – myself – and show it in a HoloLens.</p> <h2>Shopping list</h2> <p>For this you will need the following hardware:  <ul> <li>A PC with a USB3 port. A Surface 4 Pro i7 has been successfully used for this goal  <li><a href="https://www.microsoftstore.com/store/msusa/en_US/pdp/Kinect-Sensor-for-Xbox-One/productID.2267482500" target="_blank">A Kinect sensor for Xbox one, aka Kinect 2</a>  <li><a href="https://www.microsoftstore.com/store/msusa/en_US/pdp/Kinect-Adapter-for-Xbox-One-S-and-Windows-PC/productID.2233937600" target="_blank">A Kinect Adapter for Xbox One S and Windows PC</a> </li></ul> <p>And the following software:  <ul> <li>The <a href="https://www.microsoft.com/en-us/store/p/3d-scan/9nblggh68pmc" target="_blank">3D Scan app</a> (see below)  <li>&nbsp;<a href="http://cloudcompare.org/release" target="_blank">CloudCompare Stereo</a>  <li>This special <a href="https://forum.unity3d.com/attachments/unityvc-zip.213471/" target="_blank">shader</a> that I nicked from <a href="https://forum.unity3d.com/threads/standard-shader-with-vertex-colors.316529" target="_blank">this thread</a> on the Unity forms</li></ul> <h2>Setting up the hardware</h2> <p>The Kinect adapter, when you remove it from the box, seems to be quite an intricate contraption of two boxes and three wires, one of them permanently connected to one of the boxes. That box – I’ll call it box #1 - is about the size of a package of cigarettes, and is the power supply. There is a wire with a mains plug that needs to be connected to this box. The other wire – that is permanently attached to box # 1– has a round plug on the other side.That plug goes into box #2 (the one without fixed wire). It’s about the size of an overly thick Mars bar. Now we have one wire unaccounted for – one with a weird squarish plug on one side, and a USB-3 plug on the other side. The squarish part <i>also</i> goes into box #2, next to the round plug coming from the power supply. Now there’s only one hole unaccounted for - on the other side box #1 is another hole – that’s where you need to connect the actual Kinect 2.  <p>Plug in the mains connected to box #1, and connect the USB plug coming from box #2 to your computer’s USB3.0 port. This will start the installation of a couple of drivers, and I seem to recall it also automatically installed the 3D Scan app that you also can find in the store here. </p> <h2>Downloading additional software</h2> <p>If the 3D scan app did not install automatically, you will need to install it from the Windows Store. Also, download and install <a href="http://cloudcompare.org/release/CloudCompareStereo_v2.8_setup_x64.exe" target="_blank">CloudCompare</a>. Finally download the <a href="https://forum.unity3d.com/attachments/unityvc-zip.213471/" target="_blank">shader</a>. That’s a zip file – we will need that later in the process. So store that in your downloads folder and unblock it. </p> <h2>The actual scanning</h2> <p>The 3D Scanning app is actually rather straightforward. You can set a few options, and I noticed that you have to fiddle a lot with the settings to get the effect you want. A higher scan resolution give a lower depth, for instance. Also, Kinect sometimes just loses track of the object it tries to track. What you do have to make sure is that there is plenty of light and prevent shadows, because although the actual object <i>tracking</i> is done via Kinect’s magic sensors, the overlaying of <i>color</i> is using the <i>camera</i> and that just needs light. And move slowly. <em>Very</em> slowly.</p> <p>I scanned myself sitting on a rotating chair and a 120 seconds settings, rotating very very slowly. For this I used the “Kinect Sensor-stationary” setting. When it’s done, it will open the 3D builder app. That usually complains about invalid geometries that need to be fixed. Click the popup, prepare to wait for quite a while, and then finally the 3D object will be ready for the next step </p> <h2>Converting to a format usable for Unity</h2> <p>The annoying thing is that although the 3D builder can save the scanned object as a WaveFront Object (obj) file – that is readable by Unity -&nbsp; it will strip any color from it. So we will need to take an in-between step. To that effect, don’t save the file in OBJ but in PLY format. Then start CloudCompare, and open the PLY file in that you just created. Hit file/save as and save the file now as an FBX file. That gives you a number of options – I usually just use FBX binary. </p> <h2><a href="https://lh3.googleusercontent.com/-0L4RlvRG7Xo/WJB0u9sCvdI/AAAAAAAAOnY/Fm6FyxvCgKU/s1600-h/image%25255B31%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: right; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="https://lh3.googleusercontent.com/-mDxJpsQp62U/WJB0vUiUgPI/AAAAAAAAOnc/8ACNYNTYVkQ/image_thumb%25255B21%25255D.png?imgmax=800" width="244" align="right" height="188"></a>Importing in Unity <i>and showing the colors</i></h2> <p>When you import this into Unity and drag the scanned object on the canvas, you will soon notice a few things about me </p> <ul> <li>I’m rather large – like statue-of-Roman-emperor-with-overly-inflated-ego large  <li>I seem to hang at a random place at a random angle in the sky, even if position and rotation are 0,0,0  <li>I am … rather pale.</li></ul> <p>Getting to let me look less like a roman statue uses requires the special shader. Using my standard folder structure, I added a folder “Shaders” and copied the contents of the UnityVC zip file into it. Net result: </p> <p><a href="https://lh3.googleusercontent.com/-ki0Jl1Z5lvM/WJB0v-EM6iI/AAAAAAAAOng/mDOx2hM-oJs/s1600-h/image%25255B7%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="https://lh3.googleusercontent.com/-IHBjrgWOmiY/WJB0waW4SII/AAAAAAAAOnk/n-scE6cJzG0/image_thumb%25255B3%25255D.png?imgmax=800" width="304" height="184"></a>&nbsp;</p> <p>Then in your assets folder, go to the folder where you have imported the scanned model into. In my case that’s App/Models:</p> <p><a href="https://lh3.googleusercontent.com/-ZGiZVWbCQ3o/WJB0w-tbe9I/AAAAAAAAOno/_wdub_b4Kog/s1600-h/image%25255B11%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="https://lh3.googleusercontent.com/-OO5RH0wU90o/WJB0xWE79II/AAAAAAAAOns/nMUFHt8ajhk/image_thumb%25255B5%25255D.png?imgmax=800" width="304" height="196"></a></p> <p>In that you will find a Material ColorMaterial</p> <p><a href="https://lh3.googleusercontent.com/-VBiSf1LbT6o/WJB0x1N2KYI/AAAAAAAAOnw/aXqHpUhwkTM/s1600-h/image%25255B35%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="https://lh3.googleusercontent.com/-PmvkukeEpgo/WJB0yf2QSmI/AAAAAAAAOn0/naes1ZHMwUA/image_thumb%25255B23%25255D.png?imgmax=800" width="354" height="199"></a></p> <p>Select that Material, go into it’s properties in the Inspector over on the right and select either “Standard (Vertex Color)” or “Standard Specular (Vertex Color)”</p> <p><a href="https://lh3.googleusercontent.com/-mqVLKf01TjY/WJB0yz_vYdI/AAAAAAAAOn4/LBZltwl__Lk/s1600-h/image%25255B39%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="https://lh3.googleusercontent.com/-pK5zBYk-Q9I/WJB0zfba9jI/AAAAAAAAOn8/kp-ThVOgaf8/image_thumb%25255B25%25255D.png?imgmax=800" width="404" height="174"></a></p> <p>And boom. There I am, in full color color <strike>and glory</strike>&nbsp;<strike>looking like a zombie</strike>.</p> <p><a href="https://lh3.googleusercontent.com/-l5zwL0OSqMQ/WJB0z3lLH4I/AAAAAAAAOoA/DkoItuhsBe0/s1600-h/image%25255B43%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="https://lh3.googleusercontent.com/-dOtcnByqWZo/WJB00RfBqhI/AAAAAAAAOoE/ACwpZC6697A/image_thumb%25255B27%25255D.png?imgmax=800" width="354" height="320"></a></p> <p>Now to make me appear in front of the HoloLens view and not seem like some giant ancient, balding and grey god of… whatever descending from Heaven, I used the following settings on the scanned Hologram:</p> <p><a href="https://lh3.googleusercontent.com/-JVxSIj6AFZY/WJB018qKQHI/AAAAAAAAOoI/P5-luO4lWRA/s1600-h/image%25255B51%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="https://lh3.googleusercontent.com/-bHulTi0mYkE/WJB02Qbd0sI/AAAAAAAAOoM/QmCiWGyVCOo/image_thumb%25255B31%25255D.png?imgmax=800" width="354" height="129"></a></p> <p>And then you get a more or less life-sized floating ghost/zombie/Borg me-like appearance</p> <p><a href="https://lh3.googleusercontent.com/-GM9up6ydS6s/WJB026PaXfI/AAAAAAAAOoQ/OOK47oIwzqE/s1600-h/image%25255B52%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="https://lh3.googleusercontent.com/-B83Yh1jr_P4/WJB03cyRGnI/AAAAAAAAOoU/02Mm_zGE3mE/image_thumb%25255B32%25255D.png?imgmax=800" width="304" height="337"></a></p> <p>I had the dubious pleasure of walking around myself, noticing the back part was missing. </p><iframe height="365" src="https://www.youtube.com/embed/CjIPBTlSc_o" frameborder="0" width="650" allowfullscreen=""></iframe> <h2>Lessons learned</h2> <ul> <li>First of all – already mentioned in passing, <em>make sure there is enough light, and prevent shadows</em>. This is harder than it sounds. You will notice scanned Holograms tend to look rather pale when created with insufficient light.  <li>The handheld setting is way harder to use than the stationary setting. Consider placing objects on a rotary platform rather than moving around it with the Kinect  <li>Move or rotate the object you want to scan <em>slowly</em> (or move the Kinect slowly)  <li>You will have to fiddle a lot with settings before you get the result you want  <li>Larger objects (like humans) are way easier to scan than small objects  <li>Make anything you don’t want on the scan as black as and non-reflective as possible</li></ul> <h2>Concluding remarks</h2> <p>Unity will complain regularly about an error in the shader in the editor, but it still seems to work fine. Having no clue about shaders and how to write them yet, I tend to ignore it. The resulting project, although containing no code written by me at all, <a href="https://github.com/LocalJoost/KinectScanDemo" target="_blank">can be found here</a>.</p>
