---
layout: post
title: x86/ARM configuration gotcha in Windows Phone 8 projects when adding unit test projects
date: '2013-06-28T22:27:00.001+02:00'
orgauthor: Joost van Schaik
tags:
- Windows Phone 8
- wpnl
- wpdev
- dotnetmag
- Unit Test
modified_time: '2013-07-01T08:53:25.934+02:00'
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-4397533285804103736
blogger_orig_url: https://dotnetbyexample.blogspot.com/2013/06/x86arm-configuration-gotcha-in-windows.html
comment_issue_id: 142
---

<p>BUILD 2013 may be all the rage at this moment, but between watching sessions online this here die-hard still is doing some <a href="http://www.microsoft.com/windowsphone/?ocid=aff-n-we-loc--ITPRO40939&amp;WT.mc_id=aff-n-we-loc--ITPRO40939" target="_blank">Windows Phone</a> development. Doing so, I ran into a particular side effect that occurs when including a unit test project – something I had not noticed before. But if you read my articles about unit testing, got inspired by it and want to try something - you might get confused, run into weird looking errors, or even submit an incorrect XAP, so I thought it best to make a short writeup.</p> <p>Create a single Windows Phone app, select your solution in the Solution Explorer and then right-click “Properties”, you will see the following dialog:</p> <p><a href="http://www.schaikweb.net/dotnetbyexample/5e30c614e89e_1291C/image.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/5e30c614e89e_1291C/image_thumb.png" width="455" height="360"></a><br>Nothing spectacular. But now add a unit test project, add a reference in the unit test project to the app, and get the solution properties again.</p> <p><a href="http://www.schaikweb.net/dotnetbyexample/5e30c614e89e_1291C/image_3.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/5e30c614e89e_1291C/image_thumb_3.png" width="462" height="365"></a></p> <p>The unit test runner apparently is a program that does not so much run on the emulator as on your PC, and therefore is an x86 program. No sweat. Since the phone emulators run on your PC as well, they will run this flawlessly. But there are some potential issues you now have to take into account. Because if you compile your app now, in stead of ConfigGotcha.xap Visual Studio now makes <strong>ConfigGotcha_Debug_x86.xap</strong>. <em>Which will not run on your phone because that hasn't got an x86 processor. </em>You will see the following error:<br><strong>”Deployment failed because an app with target platform x86 cannot be deployed to Device. If the target platform is win32/ x86, select an emulator. If the target platform is ARM, select Device.”</strong></p> <p>I don’t even want to contemplate what happens when you try to submit this XAP ;-)</p> <p>But anyway, if you try to be smart like me and change the ConfigGotcha app to Any CPU again – it will run now on both your Windows Phone <em>and</em> the emulator, but when you try to run the tests you will get this error:</p> <p><strong>“Target platform x86 is incompatible with the selected device type. Make sure that they are compatible with each other and try again. Example: - X86 or Win32 platform is compatible with emulator and not compatible with arm device.&nbsp; Similarly arm platform is compatible with arm device and not compatible with emulator.<br>Unit tests in source C:\projects\ConfigGotcha\ConfigGotcha.Test\Bin\x86\Debug\ConfigGotcha.Test.dll cannot be run. Please create a Windows Store or Windows Phone Unit Test project.”</strong></p> <p>So, the story is this:</p> <ul> <li>When you want to unit test your app, both the tested and the test project apparently must have platform “x86”. The resulting XAP will be unit testable, and run on the emulator – but not on your phone.  <li>When you want to deploy or submit an app, set the configuration to “Any CPU”. The resulting XAP will run on your emulator <em>and</em> your phone, and can be submitted.</li></ul> <p>The gotcha of course is that you fix an error, run the tests, forget to set “x86” back to “Any CPU”, select release configuration, build the app – which will not create a XAP in “release” but in x86, and you submit the release XAP, which is not recompiled and still contains the error.</p> <p>This <em>will</em> of course happen – at 3am after a long debugging session - and to prevent that, I recommend the following: select the solution properties again, select “Release” from the configuration dropdown, set the platform of all your projects <em>but the unit test projects</em> to Any CPU, and disable Build and Deploy for the unit test projects, like this:</p> <p><a href="http://www.schaikweb.net/dotnetbyexample/5e30c614e89e_1291C/image_4.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/5e30c614e89e_1291C/image_thumb_4.png" width="491" height="421"></a></p> <p>Net result: when you select release, Visual Studio will automatically build a XAP for Any CPU and app that runs both on the phone and your emulator, and can be submitted.</p> <p>If you want have all debug functionality of the debug mode but still want to be able to run on the phone you can <em>add</em> a configuration, like this:</p> <ul> <li>Hit the “Configuration Manager” button top-right of the dialog,  <li>Select “New” under “Active solution configuration”,  <li>Select “Debug” under “Copy settings from”  <li>Enter some suitable name (I chose DebugAnyCpu)  <li>Hit OK</li></ul> <p><a href="http://www.schaikweb.net/dotnetbyexample/5e30c614e89e_1291C/image_5.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/5e30c614e89e_1291C/image_thumb_5.png" width="437" height="351"></a></p> <p><a href="http://www.schaikweb.net/dotnetbyexample/5e30c614e89e_1291C/image_6.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: right; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" align="right" src="http://www.schaikweb.net/dotnetbyexample/5e30c614e89e_1291C/image_thumb_6.png" width="244" height="151"></a>Now make sure the other settings of the new DebugAnyCPU configuration are the same as the <em>release</em> settings (so, everything Any CPU and make the unit tests not compile or deploy). If you now look in Visual Studio and click the configuration manager, you will see you have an extra configuration as displayed to the right.</p> <ul> <li>Selecting Debug will make now a unit testable application that will run on your emulator, but not on your phone  <li>Selecting DebugAnyCpu will make a debug application that can run on your phone and your emulator – but you cannot unit test  <li>Selecting “Release” will make a proper release app that can run on emulator, device – and the resulting XAP can be submitted.</li></ul> <p>By creating this configuration you can have all the options you need, and protect yourself from accidentally uploading the wrong XAP after pushing through into the wee hours of the night finding a bug in your app.</p> <p>Happy unit testing!</p>  
