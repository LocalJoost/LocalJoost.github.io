---

title: Shared code development and easy unit testing with Compact Framework
date: '2008-07-25T18:44:00.018+02:00'
orgauthor: Joost van Schaik
tags:
- Compact Framework
- Shared Code
- C#
- Unit Test
- Windows Mobile
modified_time: '2008-12-18T09:53:57.558+01:00'
thumbnail: http://3.bp.blogspot.com/_QXPoKuE9q6k/SIoHROpui7I/AAAAAAAACL0/f2MS94STM2s/s72-c/addaslink.gif
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-891720375826208260
blogger_orig_url: https://dotnetbyexample.blogspot.com/2008/07/shared-code-development-and-easy-unit.html
---

Microsoft made developing for the Compact Framework relatively easy. Everyone with experience in .NET development can easily take the plunge into mobile development by downloading the Windows Mobile SDK 6.x and go on as if you are just working in the full framework. You will notice some restrictions, not everything you might want to use is available, programs running on mobile device face some very specific challenges, but then again, the development experience is quite seamless.<br /><br />Some things remain a bit cumbersome. Unit testing can be a real PITA, and you cannot binary reuse code, so if your shop (like mine) uses some utilities that are distributed as binary components, they will have to be recompiled specifically for the Compact Framework and someone has to keep the CF and Full version in sync.<br /><br />Fortunately Visual Studio sports an almost hidden feature that can make life a lot easier for Mobile developers. The following procedure assumes that you have Visual Studio 2008 professional edition and the Windows mobile 6 SDK installed. For unit testing I use NUnit and Testdriven.NET to launch it from Visual Studio, but you can of course use anything you like<br /><br /><span style="font-size:130%;">1. Make a new empty solution</span><br />Let's call it "SharedCode"<br /><br /><span style="font-size:130%;">2. Add a new Smart Device application</span><br />Select Add/new project/Smart Device<br />Use "MyMobileApp" as name<br />Select Smart Device, Windows Mobile 6.0 professional SDK, and Compact Framework 3.5 although for this sample only the first option is really important.<br /><br /><span style="font-size:130%;">3. Add another Smart Device application</span><br />Select Add/new project/Smart Device<br />Use "MyMobileLib" as name<br />Select Class Library, Windows Mobile 6.0 professional SDK, and Compact Framework 3.5<br /><br /><span style="font-size:130%;">4. Add two Windows Class library projects</span><br />These must be <i>full</i> framework projects, not mobile projects.<br />Call the first one "MyLib" and the second one "MyLib.Test". Select .NET framework 3.5 as target framework<br /><br /><span style="font-size:130%;">5. Add a new class to the MyMobileLib assembly</span><br />For this example, we will use a trivial calculator class:<pre>namespace MyMobileLib<br />{<br />    public class Calculator<br />    {<br />        private int Num1;<br />        private int Num2;<br /><br />        public Calculator(int num1, int num2)<br />        {<br />            Num1 = num1;<br />            Num2 = num2;<br />        }<br /><br />        public int Add()<br />        {<br />            return Num1 + Num2;<br />        }<br /><br />        public int Subtract()<br />        {<br />            return Num1 - Num2;<br />        }<br />    }<br />}</pre><br /><span style="font-size:130%;">6. Add as link to the MyLib library</span><br />Go to the MyLib library and remove the default generated "Class1.cs" file.<br />Then right-click the project and select "Add/Existing Item".<br />And now for the piece the resistance:<br />Browse one directory up, then down into the MyMobileLib directory, and select the Calculator.cs file.<br />Now look carefully to the "Add" button down right. It will sport a hard-to-spot small arrow pointing downwards:<br /><a href="http://3.bp.blogspot.com/_QXPoKuE9q6k/SIoHROpui7I/AAAAAAAACL0/f2MS94STM2s/s1600-h/addaslink.gif"><img id="BLOGGER_PHOTO_ID_5226998310089165746" style="FLOAT: left; MARGIN: 0px 10px 10px 0px; CURSOR: hand" alt="" src="http://3.bp.blogspot.com/_QXPoKuE9q6k/SIoHROpui7I/AAAAAAAACL0/f2MS94STM2s/s320/addaslink.gif" border="0" /></a>If you click that, you will get two options: Add and <i>Add as link</i>. That is what I mean by "an almost hidden feature". Select "Add as link" and you will see that "Calculator.cs" is added to the MyLib project, but that the document icon has a shortcut arrow overlay:<br /><a href="http://2.bp.blogspot.com/_QXPoKuE9q6k/SIoNnu_HYlI/AAAAAAAACL8/jeeuSUMK_iI/s1600-h/addedaslink.gif"><img style="float:left; margin:0 10px 10px 0;cursor:pointer; cursor:hand;" src="http://2.bp.blogspot.com/_QXPoKuE9q6k/SIoNnu_HYlI/AAAAAAAACL8/jeeuSUMK_iI/s400/addedaslink.gif" border="0" alt=""id="BLOGGER_PHOTO_ID_5227005293795697234" /></a><br /><br /><br/><br/><br/><br/><br/><span style="font-size:130%;">7. Add references</span><br />Right-click the MyMobileApp project<br />Select "Add Reference", click Tab "projects" and select the "MyMobileLib" project<br /><br />Right-click the MyLib.Test project<br />Select "Add Reference", click Tab "projects" and select the "MyLib" project<br /><br /><span style="font-size:130%;">8. Define unit test in de MyLib.Test project</span><br />Rename the default Class.cs file in MyLib.Test to "TestCalculator.cs".<br />Since I use NUnit, I have to make a reference to the nunit.framework.dll which sits somewhere on my system. Then I can create the world shocking ;-) test<pre>using MyMobileLib;<br />using NUnit.Framework;<br /><br />namespace MyLib.Test<br />{<br />    [TestFixture]<br />    public class TestCalculator<br />    {<br />        [Test]<br />        public void TestCalc1()<br />        {<br />            Calculator c = new Calculator(3,2);<br />            Assert.AreEqual(5, c.Add());<br />            Assert.AreEqual(1, c.Subtract());<br />        }<br />    }<br />}</pre>which will undoubtly work. But my point is: you can simply run units tests out of the Windows Mobile scope, inside Visual Studio<br /><br /><span style="font-size:130%;">9. Test the library on the mobile device</span><br />For the sake of brevity: drag a label onto the form.<br />Open the Form1.cs, and add to the code on the form:<pre>using System.Windows.Forms;<br /><b>using MyMobileLib</b>;<br /><br />namespace MyMobileApp<br />{<br />    public partial class Form1 : Form<br />    {<br />        public Form1()<br />        {<br />            InitializeComponent();<br />            <b>Calculator c = new Calculator(3, 2);<br />            label1.Text = "3 + 2 = " + c.Add()</b>;<br />        }<br />    }<br />}</pre>If you run this, open pops the Windows Mobile emulator and the form will show the 'surprising' message "3 + 2 = 5". <br /><br /><span style="font-size:130%;">Conclusion</span><br />While the sample was trivial, it showed two things:<br /><ul><li>For general purpose classes, you can develop code and generate binaries for both Compact and full framework using <i>a single code file</i></li><br /><li>Unit testing of general purposes classes can be done outside a Windows Mobile emulator and becomes a lot easier this way</li><br /></ul><br /><br />Complete code downloadable <a href="http://www.schaikweb.net/dotnetbyexample/SharedCode.zip">here</a>.