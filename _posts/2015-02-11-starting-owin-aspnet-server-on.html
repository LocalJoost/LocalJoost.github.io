---

title: Starting an OWIN ASP.NET server on Raspberry PI 2 automatically at boot up
date: '2015-02-11T17:47:00.001+01:00'
orgauthor: Joost van Schaik
tags:
- ASP.NET
- IoT
- C#
- OWIN
- Raspberry PI2
- Mono
modified_time: '2015-02-11T19:03:41.692+01:00'
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-6731368304666446285
blogger_orig_url: https://dotnetbyexample.blogspot.com/2015/02/starting-owin-aspnet-server-on.html
---

<p>Inspired by the buzz that engulfed the Microsoft community when it was announced the new <a href="https://dev.windows.com/en-us/featured/raspberrypi2support" target="_blank">Raspberry PI 2 was going to support Windows 10</a> I actually got myself one too, with the aid of community member <a href="http://twitter.com/mspronkers" target="_blank">Maurice Spronkers</a> (thank bro!)</p> <p><a href="http://www.schaikweb.net/dotnetbyexample/Running-basis_EECB/image.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/Running-basis_EECB/image_thumb.png" width="644" height="380"></a></p> <p>Windows 10 for devices is not yet out for release, so here I was, being a bit impatient to apply my .NET skills, looking at a device that, at the time of this writing, only can be powered by Linux. I have extensive UNIX experience, but after the GIS world largely moved to Windows NT in 1997(!) my command line skills had gotten a <em>little</em> rusty. Fortunately, there are this great tutorial by <a href="http://twitter.com/jantielens" target="_blank">this awesome Belgian guy named Jan Tielens</a>, who describes <a href="http://j.tlns.be/2015/02/getting-started-with-the-raspberry-pi-2-for-net-developers/" target="_blank">setting up the device for .NET developers</a> and <a href="http://j.tlns.be/2014/11/running-asp-net-on-a-raspberry-pi-with-mono-and-owin/" target="_blank">running an ASP.NET OWIN server on it</a>. </p> <p>The only thing I could not get to work, is to get the darn OWIN server to start <em>at boot time</em>. I found out, eventually. The problem did not so much in the configuration, as well in the default OWIN stand alone server code. Now Linux fans all over the world will probably ridicule me for this total lack of understanding of their system, let alone at how I arrived at the solution, but what the heck. Only a few learn without falling on their face first.</p> <p>So after a lot of looking around of various sites, muttering on Twitter, and getting some help from various people, I arrived <a href="http://www.raspberry-projects.com/pi/pi-operating-systems/raspbian/auto-running-programs" target="_blank">at this page</a> that tells you to need edit a file named <strong>/etc/rc.local</strong>. Think of it as ye olde autoexec.bat. That, of course, you can only do as root. So you have to start that from the command line [insert muttering here]. The purists may use Nano or even VI (I still know some keystrokes if I go on automatic) but I found out that you can get a nice notepad like editor by typing<br><strong>sudo leafpad /etc/rc.local</strong></p> <p>And then you add a line<br><strong>su - pi -c "mono /home/pi/Desktop/OwinDemo/OwinTest.exe " &amp;</strong> </p> <p>and that should work (yeah I put my demo on the desktop. I like a GUI. Sue me). Trouble is, after rebooting, it does not. Remembering ye olde days of shell script development, I changed the line to:<br><strong>su - pi -c "mono /home/pi/Desktop/OwinDemo/OwinTest.exe 2&gt;/home/pi/Desktop/error.txt &gt;/home/pi/Desktop/log.txt" &amp;</strong> </p> <p>Mind you, this should all be on one line! It should dump all the output of the process itself in log.txt, and possible errors in error.txt. I booted up the PI2 – nothing. But lo and behold, two files popped onto the desktop, error.txt and log.txt. So at least <em>something</em> did run. The first one was empty (yay, no errors!) and the second one contained just the expected text: “Press Enter to quit.” So why did I get “This page cannot be displayed”</p> <p>It turns out, my friends, that what works when you start it as a user, apparently does not work when you run it it the background. Apparently, although the Console.ReadLine should stop it – it doesn’t do that.</p> <p>The only thing I had to change was the .NET code.</p> <p>In stead of this piece of code, that everyone writes in the OWIN examples, </p><pre>static void Main(string[] args)
{
  const string baseUrl = "http://*:5000";
  using (WebApp.Start&lt;Startup&gt;(baseUrl))
  {
    Console.WriteLine("Press Enter to quit.");
    Console.ReadKey();
  }
}</pre>
<p>I wrote this very naïve piece of code</p><pre>static void Main(string[] args)
{
  const string baseUrl = "http://*:5000";
  using (WebApp.Start<startup>(baseUrl))
  {
    while(true)
    {
      Console.WriteLine("Waiting...");
      Thread.Sleep(2000);
    }
  }
}</pre>
<p>And verily, verily, now every two seconds my file “log.txt” got a new line and I actually could access the web site running on my PI. </p>
<p><a href="http://www.schaikweb.net/dotnetbyexample/Running-basis_EECB/image_3.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/Running-basis_EECB/image_thumb_3.png" width="644" height="477"></a></p>
<p>I assume I am a very big dumbass for not understanding this and my logging method is very primitive, but I could not find a decent resource telling me <em>why</em> I was stupid and how to solve this, so I thought I’d share this with you. </p>
<p>AS <a href="http://j.tlns.be/2014/11/running-asp-net-on-a-raspberry-pi-with-mono-and-owin/" target="_blank">Jan in his original article</a> shares most of the code I forego my trademark sample solution this time, as I expect my readers at least to be capable to delete two lines of code and replace them by four. </p>
<p>Final thought: if you deploy this, you might want to delete the logging redirects (as you won’t like having a very big file on you desktop just saying “Waiting…” umpteen times), and you might want to set the Thread.Sleep to a higher value so save (a minute bit of) CPU cycles.</p>
<p>Disclaimers: no PI2’s were harmed for this article, or being forced to reboot by the flash where it’s picture was taken with ;)</p>  