---

title: Build for both from one source–Hololens and Immersive Apps
date: '2017-11-04T18:22:00.001+01:00'
orgauthor: Joost van Schaik
tags:
- UWP
- HoloLens
- Windows Mixed Reality
- Unity3D
- Immersive apps
modified_time: '2017-11-07T08:54:11.515+01:00'
thumbnail: https://lh3.googleusercontent.com/-UaCpGyVDk64/WfzmRoyj83I/AAAAAAAAPSA/nHkClHEuU28mvxg3sCJFrx60Fi-FQ1eEQCHMYCw/s72-c/image_thumb%255B4%255D?imgmax=800
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-9087452064362491760
blogger_orig_url: https://dotnetbyexample.blogspot.com/2017/11/build-for-both-form-one-sourcehololens.html
---

<h2>Intro</h2><p>The time has come. As I predicted in <a href="http://localjoost.github.io/2017/10/14/lessons-learned-from-adapting-walk.html" target="_blank">my previous blog post</a>, it’s now possible to build a <a href="https://www.microsoft.com/en-us/hololens" target="_blank">HoloLens</a> app and an Immersive Apps (targeted toward the new immersive headsets) from <em>once source</em>, thanks to the awesome work done by the folks working on the <a href="https://github.com/Microsoft/MixedRealityToolkit-Unity" target="_blank">Mixed Reality Toolkit</a>. No need to keep two branches anymore. There is still some fiddling to do, but that is merely following a script when you create and submit the final apps. And script - that is exactly what I am going to describe.</p><h2>Stuff you will need</h2><ul><li>Visual Studio 2017</li><li><a href="http://beta.unity3d.com/download/00283454d7e3/download.html" target="_blank">Unity 2017.2.0f3-MRTP3</a> for building the Immersive app</li><li>Unity&nbsp; <a href="https://unity3d.com/get-unity/download/archive" target="_blank">2017.1.x (I used 2017.1.2f1)</a>&nbsp; for building the HoloLens app</li><li>Windows SDK 15063</li><li>Windows SDK 16299</li><li>The latest <a href="https://github.com/Microsoft/MixedRealityToolkit-Unity" target="_blank">Mixed Reality Toolkit</a></li></ul><h2>Build the HoloLens app</h2><ul><li>Open the project in Unity 2017.1.x</li><li>You may get the following popup if the project was last opened in Unit 2017.2.x:</li></ul><p><a href="https://lh3.googleusercontent.com/-8nNbS0lpc9Q/WfzmRC2XLBI/AAAAAAAAPR8/S7MVO6l2HCkK9DHPLUyd4i0z18HYhbSAACHMYCw/s1600-h/image%255B6%255D"><img width="300" height="201" title="image" style="margin: 0px 0px 0px 22px; border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-UaCpGyVDk64/WfzmRoyj83I/AAAAAAAAPSA/nHkClHEuU28mvxg3sCJFrx60Fi-FQ1eEQCHMYCw/image_thumb%255B4%255D?imgmax=800" border="0"></a></p><ul><li>Just click “Continue”</li><li>You may get a popup like this:</li></ul><p><a href="https://lh3.googleusercontent.com/-irtMWrR0vZ4/WfzmSScOhaI/AAAAAAAAPSE/5FonfTBuBfw7B0IXPVp1iSge7xFQ-wSAwCHMYCw/s1600-h/image%255B15%255D"><img width="450" height="122" title="image" style="margin: 0px 0px 0px 22px; border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-XrzC105_mK0/WfzmTU86e_I/AAAAAAAAPSI/ieXDppSQyhQFZVoRIlO4aK_suOANPNZpACHMYCw/image_thumb%255B9%255D?imgmax=800" border="0"></a></p><ul><li>Click “Cancel”</li><li>Open the Build Settings (File/Build settings)</li><li>Select SDK 15063</li></ul><p><a href="https://lh3.googleusercontent.com/-U7iNg_5eDyc/WfzmTxEJhKI/AAAAAAAAPSM/yWo8B9iKBoMWud4tjSLIXKX5kbI-t2_zwCHMYCw/s1600-h/image%255B21%255D"><img width="500" height="485" title="image" style="margin: 0px 0px 0px 22px; border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-NZLej1H5CKU/WfzmVMYdXJI/AAAAAAAAPSQ/GvRqCqgIVRkcsy0Gzv9EMVC_p810S9hAQCHMYCw/image_thumb%255B13%255D?imgmax=800" border="0"></a></p><ul><li>I always create Unity C# projects, but that checkbox is not mandatory</li><li>Click “Player Settings”</li><li>Expand Panel “Other settings”</li></ul><p><a href="https://lh3.googleusercontent.com/-zoWlHt2HY2Y/WfzmVt_cDWI/AAAAAAAAPSU/-bK3XWYNdhoGV0PNARJXynX7nwLsYSvQgCHMYCw/s1600-h/image%255B33%255D"><img width="300" height="270" title="image" style="margin: 0px 0px 0px 22px; border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-4OIbQbCs3hg/WfzmWfR8dDI/AAAAAAAAPSY/p6L7MQsdx0o8yFtjq5ehwKyyC0hiXojPgCHMYCw/image_thumb%255B21%255D?imgmax=800" border="0"></a></p><ul><li>Make sure Windows Holographic is available. I always remove the “WindowsMR (missing from build)” if it says so. You will only see this if you previously have built a Immersive app using Unity 2017.2.x</li><li>Build the Visual Studio solution by clicking the Build button on the Build settings Window</li><li>Open the resulting solution</li><li>Open the Package.appmanifest in an XML editor (<em>not </em>the default editor – you will have to make manual changes). </li><li>Find the text “TargetDeviceFamily Name="Windows.Universal"&nbsp; and change that to TargetDeviceFamily Name="Windows.<strong>Holographic</strong>" </li><li>While you are at it, check if MinVersion in that line is set to 10240 and MaxVersionTested is set to 10586</li><li>Build the store packages as usual. Don’t forget to set the configuration to Master and build only x86 packages, as those are the only one required (and supported) by HoloLens.</li><li>Run the WACK to see if nothing odd has happened. </li><li>Upload the packages to the store. The store should automatically select Holographic as only target. Don’t submit it yet. There’s more to add to it.</li></ul><h2>Build the Immersive App</h2><ul><li>Open the Unity project with Unity 2017.2.0f3-MRTP3</li><li>You might once again get a popup complaining about the non-matching editor. Just click “Continue” again</li><li>Likewise, press “Cancel” again if the editor complains about not being able to open library files</li><!--StartFragment-->
<li>Open the Build Settings (File/Build settings)</li>
<li>Select SDK 16299</li></ul><p><a href="https://lh3.googleusercontent.com/-GIVHJGmGpPk/WfzmXfNShUI/AAAAAAAAPSc/mXU38Lg573gWVpJ9hEXDGLbPUzrZq4PfgCHMYCw/s1600-h/image%255B43%255D"><img width="500" height="488" title="image" style="margin: 0px 0px 0px 22px; border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-bvKakmOQTas/WfzmYSWXgOI/AAAAAAAAPSg/-h0ei6anIsUbEp3X01g9wW5gCKl6XyW5wCHMYCw/image_thumb%255B27%255D?imgmax=800" border="0"></a></p><ul><li>Click “Player Settings”</li><li>Expand the bottom panel,<strong> XR Settings</strong></li><li>Verify Windows Mixed Reality is selected.</li></ul><p><a href="https://lh3.googleusercontent.com/-vwgzBiTFrkQ/WfzmYy8nERI/AAAAAAAAPSk/kKOOY4DBW5YB1fOzjTMJBdTTw6lpQWb7QCHMYCw/s1600-h/image%255B48%255D"><img width="300" height="120" title="image" style="margin: 0px 0px 0px 22px; border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-7tJ7jQuwOeg/WfzmZjE3dnI/AAAAAAAAPSo/iyau-52j0GcB-YF4Da0yddfcscayx_vyQCHMYCw/image_thumb%255B30%255D?imgmax=800" border="0"></a></p><ul><ul><!--StartFragment-->
</ul><li>Build the Visual Studio solution by clicking the Build button on the Build 
settings Window</li><li>Open the resulting solution</li><li>Open the Package.appmanifest in an XML editor again</li><li>Find the text “TargetDeviceFamily Name="Windows.Universal"&nbsp; and change that to&nbsp; “TargetDeviceFamily Name="Windows.<strong>Desktop</strong>"</li><li>While you are at it, check if MinVersion and MaxVersionTested in that line are both set to 16299 </li><li>For all projects in the solution, change the Min version to 16299. We don’t want this app to land on anything older than the Fall Creators Update, since only the FCU supports Windows Mixed Reality</li></ul><p><a href="https://lh3.googleusercontent.com/-CCHP7QXBxNQ/WfzmaTrGPDI/AAAAAAAAPSs/DtPa16SxlHgVo-C6GXCKVK__LJrDicRSwCHMYCw/s1600-h/image%255B54%255D"><img width="400" height="210" title="image" style="margin: 0px 0px 0px 22px; border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-Lkjv72mBdwo/WfzmbHnhZ3I/AAAAAAAAPSw/FqOLVwYjjF0jedcMrDt3v3cVUsNkLH_fACHMYCw/image_thumb%255B34%255D?imgmax=800" border="0"></a>&nbsp;</p><ul><li>Build the store packages (configuration Master again).</li><ul><li>Don’t forget to set the configuration to Master but this time build x86 and x64 packages, as those are the platforms supported for desktop PCs (although in reality, I think most if not all Mixed Reality capable PCs will be x64)</li><li>Make sure you don’t overwrite the HoloLens app you created earlier – choose a different folder or copy the generated packages. </li><li>Make sure – and this is important – the version numbers of both app are different. The store won’t accept two packages with the same number. As you can see I have created the HoloLens app with version 3.2.8.0 and the Immerse app with 3.2.9.0</li></ul></ul><p><a href="https://lh3.googleusercontent.com/-l5lNMhvMlmA/Wf3-gN958CI/AAAAAAAAPTs/dD_vI7nyoq8RXDETISLFPAIzv5p_LAIqgCHMYCw/s1600-h/image1%255B1%255D"><img width="500" height="94" title="image" style="margin: 0px 0px 0px 22px; border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-Jzi5VC4MNyA/Wf3-hC3qovI/AAAAAAAAPTw/He5S5pjU-ZAdaud7pCSNpnSG6YyUGosNgCHMYCw/image1_thumb?imgmax=800" border="0"></a></p><ul><li>Upload the package to the same submission.</li></ul><p>If you have done everything right, it should kind of look like this, as I <a href="http://localjoost.github.io/2017/10/14/lessons-learned-from-adapting-walk.html" target="_blank">showed in my previous post</a>:</p><p><a href="https://lh3.googleusercontent.com/-e0NcYJoUt78/Wf2MqQbM7sI/AAAAAAAAPTM/tJgb-Ja4s3QoQHpUy5v_QbSK3RxB6YfOACHMYCw/s1600-h/image%255B9%255D"><img width="596" height="484" title="image" style="display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-BnkLAPQNGFA/Wf2MrTDU5lI/AAAAAAAAPTQ/5yZnDKuETA4ev3d1RQ342qyXEf4SnbBSwCHMYCw/image_thumb%255B4%255D?imgmax=800" border="0"></a></p><p>This is an actual screenshot from the version I submitted successfully to the store last week and has just been rolled out (I got it on my HoloLens and my MR PC yesterday,and just got the mail processing has been completed). Make sure to check out all the other checkmarks you need to check – see once again <a href="http://localjoost.github.io/2017/10/14/lessons-learned-from-adapting-walk.html" target="_blank">my previous post</a> - to prevent from disappointing your users.</p><h1>Some little tricks I used</h1><p>The Mixed Reality Toolkit has now reached a maturity level that you don’t have to do much in your app to support both scenarios. The most dramatic change is using a Mixed Reality Camera in stead of the good old HoloLensCamera. The new camera has separate quality settings for HoloLens and Immersive apps. For HoloLens, this is default set to fastest, the “Opaque Display Settings” (those are for Immersive apps) is set to “Fantastic”. I tend to crank up the HoloLens setting notch one or two (in this case one)</p><p><a href="https://lh3.googleusercontent.com/-Mpn8TYtbrxI/Wf2MscsNcAI/AAAAAAAAPTU/mnVWnsG-_JMs5wcpxlBEOUgSFIgWw6jmwCHMYCw/s1600-h/image%255B13%255D"><img width="304" height="222" title="image" style="display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-7K6RWlvztHo/Wf2MtRL5oVI/AAAAAAAAPTY/jx-iGB4xRPILNp-J10-hUGaDgdsq0-N5wCHMYCw/image_thumb%255B6%255D?imgmax=800" border="0"></a></p><p>This results in considerably better graphics, but be very careful with that – you might hose your HoloLens app’s performance. So test thoroughly before messing with this setting.</p><p>Some little piece of code I use, <strike>stolen from</strike> <a href="https://mtaulty.com/2017/04/16/baby-steps-with-the-mixed-reality-portal-simulator-on-windows-10-creators-update/" target="_blank">inspired</a> by <a href="https://twitter.com/mtaulty/" target="_blank">Mike Taulty</a>, to check if I am on a HoloLens or not:</p><pre style="font-size: 11px;">public static class OpaqueDetector
{
    public static bool IsOpaque
    {
        get
        {
#if !UNITY_EDITOR
            if (Windows.Foundation.Metadata.ApiInformation.IsTypePresent(
                "Windows.Graphics.Holographic.HolographicDisplay"))
            {
               return Windows.Graphics.Holographic.HolographicDisplay.GetDefault()?.IsOpaque == true;
            }
#endif
            return false;
        }
    }
}
</pre><p>Turns out I could call HolographicDisplay in the newest SDK, but not in the old one. Using Mike’s trick allowed it to work. Which allows me do to do simple things as</p><pre style="font-size: 11px;">SomeObject.SetActive(OpaqueDetector.IsOpaque)
</pre><p>This, for instance, I use to disable the MotionControllers prefab inside the MixedRealityCameraParent because I don’t want all that stuff to be initialized. I</p><p><a href="https://lh3.googleusercontent.com/-Bj86C9ydHas/Wf3-hutt75I/AAAAAAAAPT0/ne3wvlEuqRkXCrEXBGHhMsrO0qqqSRj7ACHMYCw/s1600-h/image%255B4%255D"><img width="240" height="163" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-nP-tn1pnUfg/Wf3-iURN7BI/AAAAAAAAPT4/yLkm55szo70lMz3dWrpF5P0UoGLZhphhACHMYCw/image_thumb%255B1%255D?imgmax=800" border="0"></a></p><p>I also use it to skip the first phase of the HoloLens app – where the user has to detect the floor. </p><h2>Conclusion</h2><p>If you are writing a HoloLens app now, especially if you think general market, it’s almost a no-brainer to support Immersive headsets now as well. Although HoloLens seems to do pretty well worldwide judging from my download numbers, adding an Immersive app has added a serious spike to those download numbers, and opened my app to a considerable wider audience. </p><p>Disclaimer: as with everything in this super fast moving space, this is how it works <em>now</em>. I think the plan is for Unity to release a unified editor that can generate both apps in the near future. But it’s now already so easy that you would be crazy not to go forward already.</p><p>One final tip: be sure to regularly test on <em>both</em> types of devices if you are serious about expanding to Immersive. A bit of code that works fine on one type may not work so hot on another – or sometimes not even compile. You still have to watch your step, but it’s magnitudes easier now than it was in era running up to the Fall Creators Update release. </p><p>Enjoy! I hope you build something awesome!</p>