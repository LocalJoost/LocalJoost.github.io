---

title: My first Azure build & deploy pipelines for an Azure Function V2
date: '2018-10-18T12:17:00.000+02:00'
orgauthor: Joost van Schaik
tags:
- Continuous Deployment
- Azure DevOps
modified_time: '2018-10-25T13:49:03.217+02:00'
thumbnail: https://lh3.googleusercontent.com/-k840GPicN2U/W8hdmOpmjgI/AAAAAAAAQH0/OlZ7YCoK8l0e5xZnWsyeRiQmdD0D7l4NgCHMYCw/s72-c/1-make%2Bfunction_thumb%255B2%255D?imgmax=800
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-5680558700196135110
blogger_orig_url: https://dotnetbyexample.blogspot.com/2018/10/my-first-azure-build-deploy-pipelines.html
---

<h2>Intro</h2><p>For those who think I am breaking rank and suddenly move away from <a href="https://www.microsoft.com/en-us/hololens" target="_blank">HoloLens</a> and <a href="https://www.microsoft.com/en-us/windows/windows-mixed-reality" target="_blank">Mixed Reality</a> to <a href="http://azure.microsoft.com/" target="_blank">Microsoft Azure</a> (like some *cough* these days) - don't worry. I am still Windows Development MVP with every intention to stay within the Mixed Reality area. But every Mixed Reality app - like basically every app these days that's more than a simple toy needs a backend - mobile apps in general, but Mixed Reality apps just as well. <a href="https://www.microsoft.com/store/productid/9P6SVQQCP2SQ" target="_blank">Walk the World</a> uses an Azure V1 function and a Redis cache to validate and cache request, and <a href="https://www.microsoft.com/store/productId/9nblggh52szp" target="_blank">AMS HoloATC</a> uses an app service to do a lot of calculations in the cloud and share selected airplanes. The new version, almost finished, uses two V2 functions. So basically, there's always an Azure component. And I used AMS HoloATC's new backend as a guinea pig for the pipelines because it's better to try something new on private projects first than to experimentally blow a customer's deployment smithereens, right?</p><p>RIGHT?</p><h2>Caveat emptor</h2><p>Anyway, in this post I wrote down my experiences - simply 'how I did it', how I used <a href="https://azure.microsoft.com/en-us/services/devops/pipelines/" target="_blank">Azure pipelines</a>. This may not be the best way to do it. I don't doubt some real DevOps heroes will have better ideas. But potentially making a fool out of myself never stopped me blogging.</p><h2>Function first</h2><p>To be able to build an deploy a function, we of course first need one. So I made this little demo project "MyFunctionV2"</p><p><a href="https://lh3.googleusercontent.com/-iHbdFulXQNw/W8hdjM-xcAI/AAAAAAAAQHw/lhpL5RmPnDM8cwa-CFtmsNHHC-iZfoIRgCHMYCw/s1600-h/1-make%2Bfunction%255B4%255D"><img width="640" height="444" title="1-make function" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="1-make function" src="https://lh3.googleusercontent.com/-k840GPicN2U/W8hdmOpmjgI/AAAAAAAAQH0/OlZ7YCoK8l0e5xZnWsyeRiQmdD0D7l4NgCHMYCw/1-make%2Bfunction_thumb%255B2%255D?imgmax=800" border="0"></a></p><p>I created a simple HTTP trigger with anonymous access rights, which I think in any serious scenario you should <em>never</em> do, but this a demo, so here goes:</p><p><a href="https://lh3.googleusercontent.com/-NfOiGtLefxg/W8hdm-rsb4I/AAAAAAAAQH4/yislw1BJ4vElEVB51I1Qqul7FAJ1SsyuwCHMYCw/s1600-h/2-httptrigger%255B4%255D"><img width="400" height="230" title="2-httptrigger" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="2-httptrigger" src="https://lh3.googleusercontent.com/-_hXKTl2Gx2Y/W8hdnnlNbNI/AAAAAAAAQH8/wchBIVCv6w4Sxy46b78-ZKjYaqIOVHhpQCHMYCw/2-httptrigger_thumb%255B2%255D?imgmax=800" border="0"></a></p><p>And then I simplified the already simple code in it even more so that resulted in this:</p><pre style="font-size: 10px;">using System.Threading.Tasks;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Azure.WebJobs;
using Microsoft.Azure.WebJobs.Extensions.Http;
using Microsoft.AspNetCore.Http;
using Microsoft.Extensions.Logging;

namespace MyFunctionV2
{
    public static class HelloWorld
    {
        [FunctionName("HelloWorld")]
        public static async Task&lt;IActionResult&gt; Run(
            [HttpTrigger(AuthorizationLevel.Anonymous, "get", "post", Route = null)] HttpRequest req,
            ILogger log)
        {
            log.LogInformation("C# HTTP trigger function processed a request.");

            return new OkObjectResult("Hello, world");
        }
    }
}
</pre><p>I stuck the sources in GitHub. Now we are ready to publish.</p><h2>First publish</h2><p>Publish? Weren't you going to use the Azure pipelines? Yes - but only to deploy. And since I am a lazy ******* I do the first publish just like in the old days (that is, up to last week) from Visual Studio. Although things have improved considerably - I used to make a function in the portal first, delete everything and then start to publish, because that was the only way to get it into a consumption plan. This way is quick and easy But I digress.</p><p>I publish a new "App Service", still apparently</p><p><a href="https://lh3.googleusercontent.com/-bBJTCZuHjGM/W8h3hwcQkCI/AAAAAAAAQIU/ADuShgYBBUU1Y6eWEUgtNaICd7ciX4sYgCHMYCw/s1600-h/4-publish1%255B9%255D"><img width="400" height="300" title="4-publish1" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="4-publish1" src="https://lh3.googleusercontent.com/-bQxytPm7C_k/W8h3i2lzczI/AAAAAAAAQIY/vixOTCJmhOE4Edfllv40h2TJjhBxYs1SwCHMYCw/4-publish1_thumb%255B4%255D?imgmax=800" border="0"></a></p><p>Visual Studio selects all kinds of defaults that are not quite desirable:&nbsp; </p><p><a href="https://lh3.googleusercontent.com/-cCgom7O7xs0/W8h3j_4J6NI/AAAAAAAAQIc/kAN1b0iVcI87gfc8XCtwVK6QlG7rXgXfwCHMYCw/s1600-h/5-publish2%255B3%255D"><img width="404" height="304" title="5-publish2" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="5-publish2" src="https://lh3.googleusercontent.com/-kgjI9Bqq88Q/W8h3k8nM8jI/AAAAAAAAQIg/Nm0fx6H3RP8J5ywLvIsB7tH8UT5e3QFwgCHMYCw/5-publish2_thumb%255B1%255D?imgmax=800" border="0"></a></p><p>I want at least a new consumption based plan, and while I am at it, a separate storage account as well - although I am not going to use that in this sample (my AMS HoloATC functions does, for sure).</p><a href="https://lh3.googleusercontent.com/-6a9xzSnhKvU/W8h3md497pI/AAAAAAAAQIk/MAVERGui28gj32MxCydX6g-U8u-HB5ApwCHMYCw/s1600-h/7-publish%255B5%255D"><img width="250" height="282" title="7-publish" align="right" style="border: 0px currentcolor; border-image: none; float: right; display: inline; background-image: none;" alt="7-publish" src="https://lh3.googleusercontent.com/-BGpornxpL5g/W8h3nVV30zI/AAAAAAAAQIo/pLA9SD_FxIgNX9KLzSpSfKMHUzPRcb23QCHMYCw/7-publish_thumb%255B3%255D?imgmax=800" border="0"></a><p><a href="https://lh3.googleusercontent.com/--YZRRpWfT18/W8h3oKHvIaI/AAAAAAAAQIs/HnBAYXlACyQ6x5AZtkOFqegPtHR4hEeJQCHMYCw/s1600-h/image%255B4%255D"><img width="250" height="282" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-pogU48su5jo/W8h3o6wo35I/AAAAAAAAQIw/vlTToFjiLpgK7sIRzIpSruC6vsOBCunDQCHMYCw/image_thumb%255B2%255D?imgmax=800" border="0"></a></p><p>When you have set everything to your liking, it should look like this:</p><p><a href="https://lh3.googleusercontent.com/-IGrBo699HJU/W8h3pl8TEoI/AAAAAAAAQI0/bGFmg7-CsCw_mW7JAPqxQ9Dq7baW_kRAACHMYCw/s1600-h/8-publish%255B8%255D"><img width="400" height="300" title="8-publish" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="8-publish" src="https://lh3.googleusercontent.com/-k4tHiuWwnv0/W8h3qYV3FJI/AAAAAAAAQI4/8Rs414k5B3kJSZr4KRWq2Zect6X1buDkQCHMYCw/8-publish_thumb%255B3%255D?imgmax=800" border="0"></a></p><p>Notice the Export button. This allows you to export the whole created configuration in the form of a JSON document. This you can use to completely automate the creation of this as well in a release pipeline, as this 'script' contains a number of variables you can set (like names for the service, storage, the plan, etc.). This is a bit more complicated and I haven't gotten to that part yet, but I know it's possible.</p><p>And if you click create, you might possible get this:</p><p><a href="https://lh3.googleusercontent.com/-IGMjGBdr4Nk/W8h67zWEacI/AAAAAAAAQJU/tUP2bGJeKNI4Yy4K9NXPON8Q9ewXPM1qACHMYCw/s1600-h/9-publish%255B4%255D"><img width="300" height="184" title="9-publish" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="9-publish" src="https://lh3.googleusercontent.com/-q529Zo9Ay2Q/W8h68jTq3fI/AAAAAAAAQJY/vT1YmieHM2AepamhlsMq2KfHKN8pDL82QCHMYCw/9-publish_thumb%255B2%255D?imgmax=800" border="0"></a></p><p>Click yes, and we are done with this part.</p><h2><a href="https://lh3.googleusercontent.com/-VUcTvaWbYF4/W8mpRWxx05I/AAAAAAAAQJ0/D8R9Li0RdvckaY4IyR1qDd8XG0LbkXqMACHMYCw/s1600-h/image%255B57%255D"><img width="169" height="240" title="image" align="right" style="margin: 0px 0px 0px 8px; border: 0px currentcolor; border-image: none; float: right; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-R1i_3sMT910/W8mpSVyvm8I/AAAAAAAAQJ4/1dVt5dar9ts9mQVg6fDE_QMQvECByU2LACHMYCw/image_thumb%255B31%255D?imgmax=800" border="0"></a>Create a Build pipeline</h2><p>This requires a project to be present in . If you have opted to store the source in&nbsp; <a href="https://azure.microsoft.com/en-us/solutions/devops/" target="_blank">Azure DevOps</a> (or Visualstudio.com) there's already a project of course, but since I put the source in GitHub I need to create it myself. I took "TestProject" (I am not very gifted in the creative naming department, I know). </p><p>The following screenshots are made with the preview settings for Azure DevOps, so things may look a bit different still if your UI settings are still for the 'old' VisualStudio.com settings. You can force the move forward to click your profile picture right top and select "Preview features" and go from there. You might as well get used to it as the new look &amp; feel is rolling out as I type.</p><p><a href="https://lh3.googleusercontent.com/-pqW9-Z-bQqI/W8mpTP9FS5I/AAAAAAAAQJ8/FcHF13nFGDk5YezMYggShidEDl_Em_78ACHMYCw/s1600-h/image%255B13%255D"><img width="240" height="100" title="image" align="left" style="margin: 1px 7px 0px 0px; border: 0px currentcolor; border-image: none; float: left; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-CHoKkQOnDZQ/W8mpT7EPekI/AAAAAAAAQKA/HIKerP3Z91oQ3UaboSGHqMXHCGuFI3hiQCHMYCw/image_thumb%255B5%255D?imgmax=800" border="0"><br></a></p><p>Okay, so let's click Pipelines/Builds and continue</p><p><br></p><p><br></p><p>If this is your first pipeline, it will show the picture on the left, by the second and following pipelines you will see a list of pipelines with this on top, but chances are as you are reading this, it will be your first pipeline ;)</p><p><a href="https://lh3.googleusercontent.com/-LVOz9FQX7TM/W8mpUlcZj3I/AAAAAAAAQKE/arwd108rpkkdmElJJ7WIFlwVIci3natPgCHMYCw/s1600-h/image%255B17%255D"><img width="240" height="72" title="image" align="right" style="border: 0px currentcolor; border-image: none; float: right; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-lROIzQ7yYbQ/W8mpVOqegkI/AAAAAAAAQKI/gZ3f1hGRjBAZtR3g-vjkB7lQsd6TcqInwCHMYCw/image_thumb%255B7%255D?imgmax=800" border="0"></a><a href="https://lh3.googleusercontent.com/-RB7O89VFZNY/W8mpV8LNm4I/AAAAAAAAQKM/trryBGhemmIBiPeU7BHJ_NKD8K9QsVvaACHMYCw/s1600-h/image%255B56%255D"><img width="240" height="177" title="image" align="left" style="border: 0px currentcolor; border-image: none; float: left; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-ph1eJWgWo2M/W8mpWUN1dKI/AAAAAAAAQKQ/w58pmkfbbxEvg4gt1SYTEewyImYBvPWcACHMYCw/image_thumb%255B30%255D?imgmax=800" border="0"><br></a></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p>After that, it's just following the steps:</p><p><a href="https://lh3.googleusercontent.com/-e6k4wU_AFZY/W8mpXCJQV1I/AAAAAAAAQKU/QY_7GTwVi7w20536XcFren5J47XBSPM_QCHMYCw/s1600-h/image%255B26%255D"><img width="640" height="250" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-urNIMLgYE9c/W8mpX5V8dcI/AAAAAAAAQKY/14955cwQH4kraSYpdiz9jj1ZxJ-z8ilyACHMYCw/image_thumb%255B12%255D?imgmax=800" border="0"></a></p><p>I am not a XAML typist nor very versed in YAML, so I click "Use the visual designer" </p><p><a href="https://lh3.googleusercontent.com/-TqI3vWOKZ48/W8nhAD3lBrI/AAAAAAAAQMk/yjA7iVCs-N8hvIIDwZ_YWunBQaL4VdfPwCHMYCw/s1600-h/image%255B188%255D"><img width="400" height="382" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-9SsjYFMP_JU/W8nhA9bRKqI/AAAAAAAAQMo/E4QM3DLu7IAab53V6FyNft4W1SGVmc9HACHMYCw/image_thumb%255B108%255D?imgmax=800" border="0"></a></p><p>Since we are using GitHub, you might need to make a connection first. </p><p><a href="https://lh3.googleusercontent.com/-PkVPvJvgBNo/W8nhBsuP_BI/AAAAAAAAQMs/xkNsHlMEotsEfcDmzPy7lzJCXL0onPtpQCHMYCw/s1600-h/image%255B189%255D"><img width="400" height="353" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-9DZA4QrYNKM/W8nhCc9Vl7I/AAAAAAAAQMw/sX5Vjmt7mcEgX8uVVPiD7SSW6xs-f9iIACHMYCw/image_thumb%255B109%255D?imgmax=800" border="0"></a></p><p>I will call mine "LocalJoost" - click "Authorize using oAuth". That will show a GitHub popup authorizing Azure Pipelines. Then select your repository:</p><p><a href="https://lh3.googleusercontent.com/-zSlKOYDAF1Y/W8nhDKX310I/AAAAAAAAQM0/CLKqAC085Z0F5mek_IvEcO36ZurJS7_nACHMYCw/s1600-h/image%255B193%255D"><img width="404" height="386" title="image" style="display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-o1QaeDWVBeY/W8nhD7hqHsI/AAAAAAAAQM4/yL3sARgyb-cf2TaHkPULpkqynY1Q6KaQQCHMYCw/image_thumb%255B111%255D?imgmax=800" border="0"></a></p><p>Hit select</p><p><a href="https://lh3.googleusercontent.com/-eboAW5-AMoM/W8nhE10N1HI/AAAAAAAAQM8/ErkQi0NUYDAguc6w6iNyY2FoZXxwnNI9QCHMYCw/s1600-h/image%255B198%255D"><img width="400" height="367" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-TvfZ8zJKIJ0/W8nhFtP8OkI/AAAAAAAAQNA/Zg32IFmw7QwsqOcPWL4cAEglqZ-BMHa8wCHMYCw/image_thumb%255B114%255D?imgmax=800" border="0"></a></p><p>And then continue. You will then need to select a template, and need to scroll down quite a bit</p><p><a href="https://lh3.googleusercontent.com/-f0Kq34096Yc/W8nhGfebY6I/AAAAAAAAQNE/Yz2HlX2Vp60OFQBif50SWredkrAcZF4oACHMYCw/s1600-h/image%255B224%255D"><img width="400" height="210" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-iUDHqSARFjE/W8nhHLEgHxI/AAAAAAAAQNI/TqI4EvT8rqE0FjNiI79tdYSF0DkSvpXlgCHMYCw/image_thumb%255B128%255D?imgmax=800" border="0"></a></p><p>Select C# function and hit apply</p><p><a href="https://lh3.googleusercontent.com/-4eWCRqjRBi4/W8nhH7KL3FI/AAAAAAAAQNM/K9Wuv1BscPExFS_1L6gb8GJDeZpnKlGeQCHMYCw/s1600-h/image%255B229%255D"><img width="640" height="361" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-Gy7AtLcle00/W8nhI8hKWgI/AAAAAAAAQNQ/FDgelyihKAoNlxLzwGzhRRjRbwQLboCdQCHMYCw/image_thumb%255B131%255D?imgmax=800" border="0"></a></p><p>Now let's be bold and hit "Save &amp; queue". This will save <em>nor</em> queue, but give you a three-option drop-down in which "Save &amp; queue" is one of the options. Click that option, and it will <em>still</em> not save, nor queue, but you will get yet another popup:</p><p><a href="https://lh3.googleusercontent.com/-gPKSxYXx2ZQ/W8nhJoJfZQI/AAAAAAAAQNU/i2Q28GTwXyMwbTIlWqd5iBAzVJNhC_2kwCHMYCw/s1600-h/image%255B234%255D"><img width="492" height="484" title="image" style="display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/--O8UHcXJ6QM/W8nhKSu2W-I/AAAAAAAAQNY/vijNOMq8NqAaendSvhv0glOEBRf2iGAggCHMYCw/image_thumb%255B134%255D?imgmax=800" border="0"></a></p><p>Hit "Save &amp; queue" <em>- </em>third time's a charm, you will see </p><p><a href="https://lh3.googleusercontent.com/-99ET4OMIw-c/W8nhLKwussI/AAAAAAAAQNc/tnYW_GiAqNMXxzMXGXov6OVDpvqdNO9NQCHMYCw/s1600-h/image%255B219%255D"><img width="240" height="71" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-PizHiw6F_Jk/W8nhLqP8AgI/AAAAAAAAQNg/pc88EgdxpAE8zXzpt2AmEyUGmNWcnRqtACHMYCw/image_thumb%255B125%255D?imgmax=800" border="0"></a></p><p>on top of your screen. If you click the build number, it will take you to a page where you can follow the sausage being made, and when it's done you should see about this:</p><p><a href="https://lh3.googleusercontent.com/-Jl5yD22XsgU/W8nhMZ_zTyI/AAAAAAAAQNk/gp4JuM-GwaIB0PqZzj3iScQ9SuD_mlaQgCHMYCw/s1600-h/image%255B239%255D"><img width="640" height="451" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-yFbwoh92JCs/W8nhNH0BqfI/AAAAAAAAQNo/AN5V_vPQnbAksMjYH5WTHAGX54WnFoEhgCHMYCw/image_thumb%255B137%255D?imgmax=800" border="0"></a></p><p>So far so good. We have a build and it's working! And you should get an e-mail for confirmation as well. </p><h2>Defining a build trigger</h2><p>You might want to have a look at when and how a build is kicked off, because we don't want to do this manually every time something changes. A good developer is still a lazy developer. So click Edit in the screen above</p><p><a href="https://lh3.googleusercontent.com/-TtgXBcmjkC4/W8mpj40zDaI/AAAAAAAAQLc/A-0oBo_lAuIpJPc6gqFSTwKJYmIl5Hn9gCHMYCw/s1600-h/image%255B79%255D"><img width="300" height="125" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-xT2qIykoVH0/W8mpkqo4BnI/AAAAAAAAQLg/S-2hI70P17I_8Rrrpsdk75nfRCr2sLRLQCHMYCw/image_thumb%255B45%255D?imgmax=800" border="0"></a></p><p>And then click "Triggers"</p><p><a href="https://lh3.googleusercontent.com/-PIJjD3IfwXY/W8nhNxhJvFI/AAAAAAAAQNs/pKp3i_cHW7cxBOmoZjP7CjKbR__A71ncACHMYCw/s1600-h/image%255B289%255D"><img width="400" height="200" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-_Fo8ncGyxWc/W8nhOloMdwI/AAAAAAAAQNw/ZEUjwaNU91o2HgorbrIuG_jOx1G3rLZfwCHMYCw/image_thumb%255B181%255D?imgmax=800" border="0"></a></p><p>We select the continuous trigger checkbox and select the proper values, although the defaults will probably be ok right away:</p><p><a href="https://lh3.googleusercontent.com/-q6rx0-8wZZA/W8nhPt0smkI/AAAAAAAAQN0/dFlBImHCZX0QOyx5-HTWGmzd8iI2hOT1wCHMYCw/s1600-h/image%255B288%255D"><img width="400" height="170" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-7ZU5VZfJr5A/W8nhQGTHaKI/AAAAAAAAQN4/dFGL9qDq4KQ2z5m7PCJ7jaXZ3cJ3hjLnQCHMYCw/image_thumb%255B180%255D?imgmax=800" border="0"></a></p><p>Hit "Save and queue" once again, but this time only select "Save" from the pop-out menu.</p><p>So, for fun, let's change the Readme.md, push a commit to the master and have a look at the builds again. And sure enough, a built is started immediately by the CI trigger.</p><p><a href="https://lh3.googleusercontent.com/-dss30U7Ihi8/W8mpmxGTjyI/AAAAAAAAQLs/rnXZrsrJO5EUei09Fa_nlsF8HCdsB6lOQCHMYCw/s1600-h/image%255B90%255D"><img width="640" height="161" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-OMIW-SjjxM0/W8mpnhMIcmI/AAAAAAAAQLw/2v2CDBJ3mq8jhKoSejD1K3SZiXmmuQm_gCHMYCw/image_thumb%255B52%255D?imgmax=800" border="0"></a></p><p>And this, my friends, is all it takes to set up a build pipeline for a V2 function with sources hosted in GitHub.&nbsp; Now for the final part - I want automated deploy as well.</p><h2>Create a Release pipeline</h2><p>Starts easy again:</p><p><a href="https://lh3.googleusercontent.com/-WW7zakPySzQ/W8mpodiFEGI/AAAAAAAAQL0/_IJ_CcNEVG0uliM8Y9H1_rmV2sJ0px83gCHMYCw/s1600-h/image%255B95%255D"><img width="500" height="388" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-2LN7ni3Gqrc/W8mppAxQ9FI/AAAAAAAAQL4/CYFLkCCl9FwhYxg5rIlmheMm59F-txg4wCHMYCw/image_thumb%255B55%255D?imgmax=800" border="0"></a></p><p>This time it does a better suggestion:</p><p><a href="https://lh3.googleusercontent.com/-D1Lk7JDHFrQ/W8mppyju8SI/AAAAAAAAQL8/jIeFepVNTOw-tANVUrz7ibWoo_bvyy32ACHMYCw/s1600-h/image%255B105%255D"><img width="400" height="205" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-Iu_0HKvI5-g/W8mpqXF0zQI/AAAAAAAAQMA/m1fKvxetbBwWotoz6qRwDJ93ENofVTXUgCHMYCw/image_thumb%255B61%255D?imgmax=800" border="0"></a></p><p>Hit apply. That gives you this screen which I find a wee bit confusing:</p><p><a href="https://lh3.googleusercontent.com/-4O5dvCxokqs/W8nhQzGcUxI/AAAAAAAAQN8/IWYDF2fI0ewYyIjrx1QvEH8cH0_b7TtxQCHMYCw/s1600-h/image%255B306%255D"><img width="404" height="266" title="image" style="display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-XswNhLQO-Dg/W8nhR4tKZnI/AAAAAAAAQOA/mzIqCYbCbvQtHog9-rtDWIr0f_D9yUcegCHMYCw/image_thumb%255B188%255D?imgmax=800" border="0"></a></p><p>Let's click "Add an artifact". That creates a kind of pop-over on the right side:</p><p><a href="https://lh3.googleusercontent.com/-M_Dd7IcSYf0/W8nhSdxfyjI/AAAAAAAAQOE/uE-JQ6u_3xgkQ_hTAlmsgR2dtkSj14cdACHMYCw/s1600-h/image%255B307%255D"><img width="400" height="228" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-8ClGepXpUME/W8nhTXZSenI/AAAAAAAAQOI/A3fbym_RWMgxK6Du6a2NzrrGiQ6ELlrMQCHMYCw/image_thumb%255B189%255D?imgmax=800" border="0"></a></p><p>Select "Build" for source type, then set the Source Build pipeline to be the build pipeline we just created, and the Default Version to "Latest". Then we hit add. Then click the red exclamation mark on "Stage 1", to view the build tasks:</p><p><a href="https://lh3.googleusercontent.com/-TFpKSheUWkI/W8nhT0mE0FI/AAAAAAAAQOM/SGS1T_aw-TQCbjpPMJ2cPq6hnIJxFLVRACHMYCw/s1600-h/image%255B120%255D"><img width="640" height="222" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-vOM9Ysy4g1Y/W8nhUyr1SvI/AAAAAAAAQOQ/7ba_mXWTrlYmNRzEfMzClikFlMgfJH0XQCHMYCw/image_thumb%255B70%255D?imgmax=800" border="0"></a></p><p>You will have to select the Azure subscription used (I have two) plus the App Service where you want to deployment to happen. To be able to use the subscription you will have to click the Authorize button first:</p><p><a href="https://lh3.googleusercontent.com/-kY_c0WWUwgQ/W8nhf8LinsI/AAAAAAAAQOg/Ss1x5POBqI8uK15kxuJwa4XB0XbNaSEnQCHMYCw/s1600-h/image%255B125%255D"><img width="400" height="57" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-QjgpoGY3YHQ/W8nhgqRqZJI/AAAAAAAAQOk/szKgJDD17cM-HkO9zNPIZ0XlyBTDr_gOACHMYCw/image_thumb%255B73%255D?imgmax=800" border="0"></a></p><p>And you might want to disable your popup blocker for this site to expedite that process:)</p><p><a href="https://lh3.googleusercontent.com/-FlAkd67MEbI/W8nhhV0JqnI/AAAAAAAAQOs/AMmu12O95VscBqDuVzkmu6Ivq6XPCvFPwCHMYCw/s1600-h/image%255B130%255D"><img width="640" height="163" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-hDWr3H0hSXY/W8nhiE4qnmI/AAAAAAAAQOw/R53hJs7-HJ4dnv5YJBx6cZ7Kf1-v8tz2ACHMYCw/image_thumb%255B76%255D?imgmax=800" border="0"></a></p><p>Once this is done, you can select "Function App" (don't let it sit at "Web App") and select the actual function app you want to deploy to</p><p><a href="https://lh3.googleusercontent.com/-JdWlrj4bQAo/W8nhi2I2iXI/AAAAAAAAQO0/gaNRVPYfWsYKIse0xSku1Hkp4EGF9fRIgCHMYCw/s1600-h/image%255B135%255D"><img width="640" height="272" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-kU_y-guMbXY/W8nhjrGgOVI/AAAAAAAAQO4/4jK254qvg_c8rWCf1qm6deFzu2NF0R5NACHMYCw/image_thumb%255B79%255D?imgmax=800" border="0"></a></p><p>And then you click "Save". </p><p><a href="https://lh3.googleusercontent.com/-AbMuJPKcqFs/W8nhkRpOZGI/AAAAAAAAQPA/WQPwwn9CeugpaCZ4IUiuwO-d-QbotwtBwCHMYCw/s1600-h/image%255B139%255D"><img width="240" height="148" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-lYtNiiv_BRw/W8nhlD3N0SI/AAAAAAAAQPE/cg6bG4Fx7VUJWLiviBWdgjdHte41ORZVACHMYCw/image_thumb%255B81%255D?imgmax=800" border="0"></a></p><p>Uhm, yeah, click OK I guess ;) .This will give you this screen</p><p><a href="https://lh3.googleusercontent.com/-NfqTf05nvaU/W8nhmNtrvXI/AAAAAAAAQPI/Y_ghD-O1phgMXIi2fNZ8d-LSd_B9oMjQQCHMYCw/s1600-h/image%255B144%255D"><img width="640" height="239" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-tjhCVhmA61g/W8nhnEMS4OI/AAAAAAAAQPM/_KGydR1KH5YGqp52iJZfoJRKBILAthlogCHMYCw/image_thumb%255B84%255D?imgmax=800" border="0"></a></p><p>So let's create a release, manually, to see if things are working</p><p><a href="https://lh3.googleusercontent.com/-K2eHka3wjCM/W8nhnvv3wOI/AAAAAAAAQPQ/5QsEx_DRYJktv8r-3eZh09y_ImOo7IW_wCHMYCw/s1600-h/image%255B313%255D"><img width="235" height="244" title="image" style="margin: 0px; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-uq60rQnqLWo/W8nhoSBkD3I/AAAAAAAAQPU/Nh8_u1HP71glo3obYm6tTfv4vdDhbnFhACHMYCw/image_thumb%255B191%255D?imgmax=800" border="0"></a></p><p>Click "Create" (don't change anything). You will go back to this screen, but you will see a yellow-greenish banner indicating a release has been started indeed:</p><p><a href="https://lh3.googleusercontent.com/-RSCRDArPFa8/W8nhpJHaZ9I/AAAAAAAAQPY/ssFRs7e_f-o43XcbGjnSN8PqkZs57FYcwCHMYCw/s1600-h/image%255B168%255D"><img width="640" height="278" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-miPq-KKRd54/W8nhp-zCNYI/AAAAAAAAQPc/eiUS4xUZuicTXpgAie627Z5m9e5NSjsJACHMYCw/image_thumb%255B96%255D?imgmax=800" border="0"></a></p><p>Click the release name in that banner, that will take you to this progress screen:</p><p><a href="https://lh3.googleusercontent.com/-Wev5XSiXheU/W8nhqRLIY7I/AAAAAAAAQPg/CE46FPMbx0A3lTfU2Y5ECDD7E0uU-OYGwCHMYCw/s1600-h/image%255B322%255D"><img width="404" height="316" title="image" style="display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-ewOJnxd9XfQ/W8nhrMREWxI/AAAAAAAAQPk/OjLe5PRzR8sA_BldF8ferOndJ2mFf9O_QCHMYCw/image_thumb%255B196%255D?imgmax=800" border="0"></a></p><p>If you click "In progress" you will once again see the sausage being made in more detail:</p><p><a href="https://lh3.googleusercontent.com/-w1hU0mq9-x0/W8nhsI0-z_I/AAAAAAAAQPo/1pcJxe5H-fAXWVtlukgYaQdKu5shlp9PgCHMYCw/s1600-h/image%255B327%255D"><img width="640" height="198" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-tTuJfcM6USM/W8nhsymBNeI/AAAAAAAAQPs/9RwKHftzw08mryL66B5Y2TdW7mp_SX30ACHMYCw/image_thumb%255B199%255D?imgmax=800" border="0"></a></p><p>And it should finish with the "Deploy Azure App Services - succeeded". </p><h2>For some final automation</h2><p>We want this of course to kick off automatically. To that extent, we have to click "Edit pipeline" again. If find this screen not very intuitive, but it's not rocket science to find out what's the idea with some clicking around</p><p><a href="https://lh3.googleusercontent.com/-2Y6BtIqiURE/W8nhtotqYgI/AAAAAAAAQPw/ekIjet44S8YeqAtYos2IFKG6tVhNVISgACHMYCw/s1600-h/image%255B152%255D"><img width="400" height="257" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-K4UbOyYT7c4/W8nhubzggEI/AAAAAAAAQP0/0IFyPxB9FrwIns_eG9IGX5TbcvQpuR21gCHMYCw/image_thumb%255B88%255D?imgmax=800" border="0"></a></p><p>We seem to have to click the lightning bolt icon - the left one - to set the "Continuous deployment trigger". </p><p><a href="https://lh3.googleusercontent.com/-yTQrczfDoE4/W8nhvNvtByI/AAAAAAAAQP4/1rnP_qBfZtsvOEFxcx6_KmwN3nmeZaNbACHMYCw/s1600-h/image%255B335%255D"><img width="400" height="221" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-qD1edV5lViE/W8nhv0VWt3I/AAAAAAAAQP8/19NYS6S20VsT8TZr4AmnzdtjOvdgChJ_wCHMYCw/image_thumb%255B205%255D?imgmax=800" border="0"></a></p><p>Flip the toggle to to Enabled, hit save, and then the final test.</p><h2>So does it work?</h2><p>I have published to app MyFunctionV2, so the URL to the site should be <a href="https://myfunctionv2.azurewebsites.net">https://myfunctionv2.azurewebsites.net</a> and to the specific function <a title="https://myfunctionv2.azurewebsites.net/api/HelloWorld" href="https://myfunctionv2.azurewebsites.net/api/HelloWorld">https://myfunctionv2.azurewebsites.net/api/HelloWorld</a></p><p>Hitting that link gives, as expected, "Hello World". Now let's change the HttpTrigger function we made all the way at the beginning to return the text "Hello again, World". We then commit and push the code to GitHub, and now we wait...</p><p>We are off to a promising start.</p><p><a href="https://lh3.googleusercontent.com/-cFMLwrvHtME/W8nhwlfzqWI/AAAAAAAAQQA/3RZfdU6IXWsnrOhNb1KIChSB88vyktWiwCHMYCw/s1600-h/image%255B339%255D"><img width="644" height="211" title="image" style="display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-ZOq6zCkhaC8/W8nhxds9NsI/AAAAAAAAQQE/xJzcwE0xmlk4t_eJuP9ys6E4Mxb1NdrNgCHMYCw/image_thumb%255B207%255D?imgmax=800" border="0"><br><br></a>And then we see a release being triggered automatically </p><p><a href="https://lh3.googleusercontent.com/-G-KRCEOvVC8/W8nhyLQ5xuI/AAAAAAAAQQI/oTZB2OUDlWAi7eYe-7gbkBQvlqq3D6YVgCHMYCw/s1600-h/image%255B344%255D"><img width="640" height="146" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-3Vg9xfuhddY/W8nhy3CtxZI/AAAAAAAAQQM/c4hFND5eoBIin_JH5sXZQaVmgHsRB9SVACHMYCw/image_thumb%255B210%255D?imgmax=800" border="0"></a></p><p>And when that's done, we hit the URL again and sure enough:</p><p><a href="https://lh3.googleusercontent.com/-ifGdnWtoaFc/W8nhzQuKsvI/AAAAAAAAQQQ/K7F5lgc9j5s0Af1yAOznB_ttt2BYRtR0ACHMYCw/s1600-h/image%255B349%255D"><img width="300" height="45" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-lvJivneR0MQ/W8nh0N5jXXI/AAAAAAAAQQU/iYwFYabxL04nlRG40HVOBYYZ0lf7eGoDwCHMYCw/image_thumb%255B213%255D?imgmax=800" border="0"></a></p><p>Mission accomplished. </p><h2>Conclusion</h2><p>So even an complete n00b like me can create a fully featured continuous build-and-deploy pipeline, in a manner of a few minutes. I can tell you that retracing my steps and actually writing it down actually took a lot more time than the actual creation of the pipeline itself. I think Azure pipelines makes DevOps a lot easier, and the new UI is a lot more intuitive that the old VisualStudio.com. There are still a few places where there's room for improvement, but this is <em>very</em> usable.</p><p>Anyone wanting to have a look at the completely uninteresting test function can do so <a href="https://github.com/LocalJoost/MyFunctionV2" target="_blank">here</a>. I would not bother, to be honest ;)</p>