---

title: Migrating to MRTK2 - looking a bit closer at tapping, and trapping 'duplicate'
  events
date: '2019-05-29T13:30:00.000+02:00'
orgauthor: Joost van Schaik
tags:
- HoloLens
- Unity
- Windows Mixed Reality
- MRTK2
- HoloLens2
modified_time: '2019-05-29T13:30:37.301+02:00'
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-6656709867011580476
blogger_orig_url: https://dotnetbyexample.blogspot.com/2019/05/migrating-to-mrtk2-looking-bit-closer.html
---

<h2>Intro</h2><p>In my <a href="https://localjoost.github.io/2019/05/22/migrating-to-mrtk2-iinputclickhandler.html" target="_blank">previous post</a> I wrote about how game objects can be made clickable (or 'tappable') using the <a href="https://www.microsoft.com/en-us/windows/windows-mixed-reality" target="_blank"><a href="https://github.com/Microsoft/MixedRealityToolkit-Unity" target="_blank">Mixed Reality Toolkit</a> 2, and how things changed from MRTK1. And in fact, when you deploy the app to a HoloLens 1, my demo actually works as intended. But then I noticed something odd in the editor, and made a variant of the app that went with the previous blog post to see how things work- or might work- in <a href="https://www.microsoft.com/en-us/hololens" target="_blank">HoloLens</a> 2.</p><h2>Debugging ClickyThingy ye olde way</h2><p>Like I wrote before, it's possible to <a href="https://localjoost.github.io/2019/03/11/debugging-c-code-with-unity-il2cpp.html" target="_blank">debug the C# code of a running IL2CPP C++ app running on a HoloLens</a>. To debug using breakpoints is a bit tricky when you are dealing with rapidly firing event - stopping through the debugger might actually have some influence on the order events play out. So I resorted to the good old "Console.WriteLine-style" of debugging, and added a floating text in the app that shows what's going on.</p><p>The ClickableThingy behaviour I made in the previous post then looks like this:</p><pre style="font-size: 12px;">using Microsoft.MixedReality.Toolkit.Input;
using System;
using TMPro;
using UnityEngine;

public class ClickableThingyGlobal : BaseInputHandler, IMixedRealityInputHandler
{
    [SerializeField]
    private TextMeshPro _debugText;

    public void OnInputUp(InputEventData eventData)
    {
        GetComponent&lt;MeshRenderer&gt;().material.color = Color.white;
        AddDebugText("up", eventData);
    }

    public void OnInputDown(InputEventData eventData)
    {
        GetComponent&lt;MeshRenderer&gt;().material.color = Color.red;
        AddDebugText("down", eventData);
    }

    private void AddDebugText( string eventPrefix, InputEventData eventData)
    {
        if( _debugText == null)
        {
            return;
        }
        var description = eventData.MixedRealityInputAction.Description;
        _debugText.text += 
            $"{eventPrefix} {gameObject.name} : {description}{Environment.NewLine}";
    }
}



</pre><p>Now in the HoloLens 1, things are exactly like you expect. Air tapping the sphere activates Up and Down events exactly once for every tap (because the Cube gets every tap, even when you don't gaze at it - see my <a href="https://localjoost.github.io/2019/05/22/migrating-to-mrtk2-iinputclickhandler.html" target="_blank">previous post</a> for an explanation)</p><p><img width="546" height="435" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190529/ClickOnHoloLens.jpg" border="0"></p><p>When you run the same code in the editor, though, you get a different result:</p><p><img width="546" height="456" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190529/ClickInEditor.png" border="0"></p><h2>Tap versus Grip - and CustomPropertyDrawers</h2><p>The interesting thing is, when you 'air tap' in the editor (using the space bar and the left mouse button), thumb and index finger of the simulated hand come together. This, now, is recognized as a tap followed by a grip, apparently. </p><p><img width="546" height="362" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190529/ClickinEditor2.png" border="0"></p><p>So we need to filter the events coming in through OnInputUp and OnInputDown to respond to the actual events we want. This is where things get a little bit unusual - there is no enumeration of sorts that you can use to compare you actual event against. The available events are all in the configuration, so they are dynamically created. </p><p>The way to do some actual filtering is to add a property of type MixedRealityInputAction to your behaviour (I used _desiredInputAction). Then the MRTK2 automatically creates a drop down with possible to events to select from:</p><p><img style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190529/DropdownInputAction.png" border="0"></p><p>How does this magic work? Well, the MRTK2 contains a <a href="https://docs.unity3d.com/ScriptReference/CustomPropertyDrawer.html" target="_blank">CustomPropertyDrawer</a> called <a href="https://github.com/microsoft/MixedRealityToolkit-Unity/blob/9ab0e9b69afe45f7856b5731436ae427c3fe7cc4/Assets/MixedRealityToolkit/Inspectors/PropertyDrawers/InputActionPropertyDrawer.cs" target="_blank">InputActionPropertyDrawer</a> that automatically creates this drop down whenever you add a property of type MixedRealityInputAction to your behaviour. The values in this list are pulled from the configuration. This fits with the idea of the MRTK2 that everything must be configurable ad infinitum. Which is cool but sometimes it makes things confusing.</p><p>Anyway, you select the event you want to test for in the UI, in this case "Select":</p><p><img width="546" height="100" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190529/Selected.png" border="0"></p><p>And then you have to check if the event methods if the event matches your desired event. </p><pre style="font-size: 12px;">if (eventData.MixedRealityInputAction != _desiredInputAction)
{
    return;
}</pre><p>And then everything works as you expect: only the select event results in an action by the app.</p><p><img width="546" height="414" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190529/ClickInEditor3.png" border="0"></p><h2>How about HoloLens 2?</h2><p>I could only test this in the emulator. The odd things is, even without the check on the input action, only the select action was fired, even when I pinched the hand using the control pane:</p><p><img width="640" height="418" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190529/ClickInHL2emulator.png" border="0"></p><p>So I have no idea if this is actually necessary on a real live HoloLens 2, but my friends and fellow MVPs <a href="https://twitter.com/stephenhodgson_" target="_blank">Stephen Hodgson</a> and <a href="https://twitter.com/SimonDarksideJ" target="_blank">Simon 'Darkside' Jackson</a> have both mentioned this kind of event type check as being necessary in a few on line conversations (although I then did not understand why). So I suppose it is :)</p><h2>Conclusion</h2><p>Common wisdom has it that the best thing about teaching is that you learn a lot <em>yourself</em>. This post is excellent proof of that wisdom. If you think this here old MVP is the end-all and know-all of this kind of stuff, think again. I knew of customer editors, but I literally just learned the concept of CustomPropertyDrawer while I was writing this post. I had no idea it existed, but I found it&nbsp; because I wanted to know how the heck the editor got all the possible MixedRealityInputAction from the configuration and show that in such a neat list. Took me quite some searching, actually - which is logical, if you don't know what exactly you are looking for ;).</p><p>I hope this benefits you as well. <a href="https://github.com/LocalJoost/MRTK2Tap/tree/TapCloseLook" target="_blank">Demo project here</a> (branch TapCloseLook).</p>