---
layout: post
title: Showing Open Source maps on Windows Phone 7 with the Bing Maps Control
date: '2010-10-21T20:56:00.001+02:00'
author: Joost van Schaik
tags:
- Mapping
- dotnetmag
- WP7NL
- Windows Phone 7
- Silverlight
- Bing Map Control
- XAML
- WP7
modified_time: '2011-04-20T11:34:57.125+02:00'
thumbnail: http://lh3.ggpht.com/_QXPoKuE9q6k/TMCMuS1ptuI/AAAAAAAAF3c/m9zuA2pm3Rc/s72-c/Mapnik_thumb%5B2%5D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-2538516352953157496
blogger_orig_url: https://dotnetbyexample.blogspot.com/2010/10/showing-open-source-maps-on-windows.html
---

<p>My <a href="http://localjoost.github.io/2010/10/19/google-maps-for-windows-phone-7.html" target="_blank">previous post</a>, which caused <a href="http://wpcentral.com/microsoft-developer-throws-down-gauntlet-google-shows-how-code-google-maps-wp7" target="_blank">a bit of a stirrup</a> and got me over 1000 page hits on that one page alone in less than 46 hours, led to the question if I could provide an example of how to use data from Open Source map servers on the web in Bing Maps. This is more useful than Google Maps, since Google’s TOS most likely does not allow accessing their data they way I showed, and an application doing so violates section 3.1 of the <a href="http://www.microsoft.com/windowsphone/en-us/default.aspx" target="_blank">Windows Phone 7</a> Application Certification Requirements, which clearly state that allowed content includes “Copyrighted content that is used with permission”, which I obviously do not have and most likely never will. Unless Google wants to code me a Windows Phone 7 app for them. Hello? Anyone reading along there at Mountain View? ;-)</p>  <p>So anyway, as long as my personal Google Maps for Windows Phone 7 is not going to hit the Marketplace, the Bing Maps MercatorMode can very well be used to show other tile maps, and by popular request I show you how to use data from Mapnik and Osmarender:</p>  <p><a href="http://lh3.ggpht.com/_QXPoKuE9q6k/TMCMtZ85-cI/AAAAAAAAF3Y/MlH31PYyUok/s1600-h/Mapnik%5B4%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Mapnik" border="0" alt="Mapnik" src="http://lh3.ggpht.com/_QXPoKuE9q6k/TMCMuS1ptuI/AAAAAAAAF3c/m9zuA2pm3Rc/Mapnik_thumb%5B2%5D.png?imgmax=800" width="200" height="392" /></a><a href="http://lh6.ggpht.com/_QXPoKuE9q6k/TMCMv26mRpI/AAAAAAAAF3o/kTcEWPJYpfk/s1600-h/Osmarender%5B8%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Osmarender" border="0" alt="Osmarender" src="http://lh5.ggpht.com/_QXPoKuE9q6k/TMCMw89tIUI/AAAAAAAAF3s/kDxzv34yYXE/Osmarender_thumb%5B4%5D.png?imgmax=800" width="196" height="394" /></a></p>  <p>The possibility should come as no surprise, <a href="http://localjoost.github.io/2010/10/06/using-mvvmlight-messenger-and-behaviors.html" target="_blank">since I showed something like this earlier</a>, only then with a plain ole’ MultiScaleImage. All you need to do is, once again, write a class again that descends from Microsoft.Phone.Controls.Maps.TileSource and overrides </p>  <pre>Uri GetUri(int x, int y, int zoomLevel)<br /></pre>

<p>like I showed in my previous post. And these are even simpler than the Google Maps tilesource. First, Mapnik:</p>

<pre>using System;<br /> <br />namespace LocalJoost.TileSource<br />{<br />&#160; public class MapnikTileSource : Microsoft.Phone.Controls.Maps.TileSource<br />&#160; {<br />&#160;&#160;&#160; public MapnikTileSource()<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160; UriFormat = &quot;http://{0}.tile.openstreetmap.org/{1}/{2}/{3}.png&quot;;<br />&#160;&#160;&#160;&#160;&#160; _rand = new Random();<br />&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160; private readonly Random _rand;<br />&#160;&#160;&#160; private readonly static string[] TilePathPrefixes = <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; new[] { &quot;a&quot;, &quot;b&quot;, &quot;c&quot; };<br /> <br />&#160;&#160;&#160; private string Server<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160; get<br />&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; return TilePathPrefixes[_rand.Next(3)];<br />&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160; }<br />&#160;&#160;&#160; <br />&#160;&#160;&#160; public override Uri GetUri(int x, int y, int zoomLevel)<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160; if (zoomLevel &gt; 0)<br />&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; var url = string.Format(UriFormat, Server, zoomLevel, x, y);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; return new Uri(url);<br />&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160;&#160;&#160; return null;<br />&#160;&#160;&#160; }<br />&#160; }<br />}</pre>

<p>and second, Osmarender</p>

<pre>using System;<br /> <br />namespace LocalJoost.TileSource<br />{<br />&#160; public class OsmaRenderTileSource : Microsoft.Phone.Controls.Maps.TileSource<br />&#160; {<br />&#160;&#160;&#160; public OsmaRenderTileSource()<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160; UriFormat = &quot;http://{0}.tah.openstreetmap.org/Tiles/tile/{1}/{2}/{3}.png&quot;;<br />&#160;&#160;&#160;&#160;&#160; _rand = new Random();<br />&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160; private readonly Random _rand;<br />&#160;&#160;&#160; private readonly static string[] TilePathPrefixes = <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; new[] { &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot; };<br /> <br />&#160;&#160;&#160; private string Server<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160; get<br />&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; return TilePathPrefixes[_rand.Next(6)];<br />&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160; }<br /> <br />&#160;&#160;&#160; public override Uri GetUri(int x, int y, int zoomLevel)<br />&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160; if (zoomLevel &gt; 0)<br />&#160;&#160;&#160;&#160;&#160; {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; var url = string.Format(UriFormat, Server, zoomLevel, x, y);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; return new Uri(url);<br />&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160;&#160;&#160; return null;<br />&#160;&#160;&#160; }<br />&#160; }<br />}<br /></pre>

<p>As you see, no rocket science. How to use this classes in XAML is explained in <a href="http://localjoost.github.io/2010/10/19/google-maps-for-windows-phone-7.html" target="_blank">my previous post</a>, and I am not going to repeat that here..</p>

<p>The odd thing is that the Bing Maps logo stays visible, although no Bing Maps data is being used. Notice that the open source maps are displayed in design mode too. So, use any tile server out there that you can legally access and have fun mapping…. although I must admit that is most likely interesting for hardcore GIS fans only, since both servers are considerably slower than Bing – especially OsmaRender, which does some odd things cutting the Netherlands in half, as you see. But still, if not anything else, it shows off the power and versatility of the Bing Maps control pretty well.</p>

<p>For the lazy people, a complete solution – including the Google stuff – can be downloaded <a href="http://www.schaikweb.net/dotnetbyexample/bingtest.zip" target="_blank">here</a>.</p>  