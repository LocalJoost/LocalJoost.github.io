---

title: For crying out loud, compile for native ARM!
date: '2018-04-04T21:10:00.000+02:00'
orgauthor: Joost van Schaik
tags:
- ARM
- UWP
- Windows 10
modified_time: '2018-04-04T22:10:38.607+02:00'
thumbnail: https://i.ytimg.com/vi/QN7sDo9G8rc/default.jpg
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-1308996985711286413
blogger_orig_url: https://dotnetbyexample.blogspot.com/2018/04/for-crying-out-loud-compile-for-native.html
---

<h2>CHPE works its magic…</h2><p>Let me get this straight first: Microsoft did and amazing job with <a href="https://channel9.msdn.com/Events/Build/2017/P4171?ocid=player" target="_blank">CHPE</a> and x86 emulation, that allows x86 to run without any conversion on the new Windows 10 on ARM PCs. Considering what happens under the hood, the performance and reliability x86 apps get is nothing short of stunning. And you still get the amazing battery life we are used to from ARM – but now on full fledged PCs. </p><p>Yet, there are still some things to consider. If you are an UWP developer, you by now probably have stopped providing ARM packages for your UWP apps. After all, Windows 10 Mobile is, alas, fading away, and these ARM PCs run x86 apps, so why bother?</p><h2>… but magic comes at a price</h2><p>Well this is why. UWP can compile to <em>native</em> ARM code, and now we have these ARM based PCs. Native ARM code can run on the Windows 10 on ARM PCs <em>without</em> using CHPE. Although CHPE is awesome, it still comes at a price – it uses CPU cycles to convert x86 instructions to ARM instructions and <em>then</em> executes those. Skip one step, you gain performance. And depending on what you do, you can gain <em>a lot</em> of performance. </p><p>To show you I am not talking nonsense, I actually compiled my <a href="https://www.microsoft.com/en-us/hololens" target="_blank">HoloLens</a>/<a href="https://www.microsoft.com/en-us/windows/windows-mixed-reality" target="_blank">Mixed Reality</a> app “Walk the World” not only for x86 (which I need to do for HoloLens anyway) but <em>also</em> for native ARM. I made two videos, of the app running as x86 UWP, and native ARM UWP. Since I don’t use a head set in this demo, I created a special Unity behaviour to control the viewpoint using an Xbox One Controller. I keep the actual PC out of the videos again, but you can clearly see the Continuum dock I wrote about before – I connected the Dell monitor using a DisplayPort, the Xbox One controller using USB, and a USB-to-ethernet dongle to rule out any variations in Wi-Fi signal.</p><p>First, watch the x86 version</p><p><iframe width="650" height="365" src="https://www.youtube.com/embed/QN7sDo9G8rc" frameborder="0" allowfullscreen="" allow="autoplay; encrypted-media"></iframe></p><p>Then, the ARM version.</p><p><iframe width="650" height="365" src="https://www.youtube.com/embed/siX8vKTwK1o" frameborder="0" allowfullscreen="" allow="autoplay; encrypted-media"></iframe></p><p>You can clearly see: although the x86 version works really well, the native ARM version starts faster, and also downloads the map faster – considerably so. Still, CHPE amazed me again by the fact that the <em>graphics</em> performance was nearly identical – once the map was loaded, panning over it happened at nearly identical speeds. But apparently startup and network code take more time. So there’s your win!</p><p>Note: any flickering or artifact you see are the results of the external camera I used, to prevent any suggestion of this being faked. I also did not want to use a screen capture program as this might interfere with the app’s performance.</p><p>Message clear? CHPE is to be used for either x86 apps from the Store that are converted using the <a href="https://docs.microsoft.com/en-us/windows/uwp/porting/desktop-to-uwp-root" target="_blank">Desktop Bridge</a>, or none-Store apps that are downloaded ‘elsewhere’ – think of Chrome, Notepad++ – anything that has not been converted yet to UWP or processed via the Desktop Bridge.</p><h2>One extra checkbox to rule them all</h2><p>I did not have to change anything to my code just to add the native ARM version. Basically all I had to do was tick a check box:</p><p><a href="https://lh3.googleusercontent.com/-spyLq6j2qPY/WsUjKjNqLAI/AAAAAAAAPq8/LAQZGb2jDPcdjXdcJ7juk4t_50lNX1bzQCHMYCw/s1600-h/image%255B5%255D"><img width="304" height="148" title="image" style="display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-V6ao39Ki-cQ/WsUjLWf2WUI/AAAAAAAAPrA/Qbjxig4g0_AfR7MgF6lOfW7ISzWg8tpmQCHMYCw/image_thumb%255B3%255D?imgmax=800" border="0"></a></p><p>…and the store will do the rest, selecting the optimal package for you user. That one little checkbox gives your app a significant performance boost on these Windows 10 on ARM PCs.</p><p>Now one might wonder – why on Earth would you convert an app that started on <em>HoloLens</em> to an UWP desktop app to run on an Windows 10 on ARM PC and how you make it work? Well, stay tuned. </p><p>And incidentally, this was the 300th post on this blog since I started in October 2007. And rest assured – I am <em>far</em> from done ;) </p>