---
layout: post
title: Preparing and uploading Holograms into Azure for use in Mixed Reality apps
date: '2018-04-18T15:49:00.001+02:00'
orgauthor: Joost van Schaik
tags:
- HoloLens
- Windows Mixed Reality
- Unity3D
- Azure
modified_time: '2018-04-18T16:08:14.597+02:00'
thumbnail: https://lh3.googleusercontent.com/-BzHRUjI_63E/WtdMp5X-YPI/AAAAAAAAPrw/wGgoBYMAAoA6RJ_BpmQDU5zpJLCndijHQCHMYCw/s72-c/image_thumb%255B5%255D?imgmax=800
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-429165920335639845
blogger_orig_url: https://dotnetbyexample.blogspot.com/2018/04/preparing-and-uploading-holograms-into.html
comment_issue_id: 301
---

<h2>Intro</h2><p>In my series about remote assets, there’s one major thing left: how to use remote assets that can be used as Holograms in your <a href="https://www.microsoft.com/en-us/windows/windows-mixed-reality" target="_blank">Mixed Reality</a> app. I will do this in two post: </p><ol><li>Prepare for usage and actual upload</li><li>Use and download.</li></ol><p>And this is, as you guessed, the first post.</p><h2>Asset bundles</h2><p>A Unity asset bundle is basically a package that can almost any piece of a Unity app. It’s usually used to create downloadable content for games, or assets that are specific for a platform or game level, so the user does not have to download everything at once. This enhances startup time, but also saves on (initial) bandwidth and local storage. Also, you can <em>update</em> part of the app without actually requiring the user to download a complete new app. There are some limitations, but we will get to that.</p><h2>General set up</h2><p>We want to create an app that downloads assets, that it does not have initially included in it. But a Unity project is what we need to actually <em>build</em> the asset bundles. So we need <em>two </em>projects: the actual app that will run, and a ‘builder’ project. That project – which I not completely correctly called “SceneBuilder: – <a href="https://github.com/LocalJoost/RemoteAssetsMixUg/tree/master/SceneBuilder" target="_blank">you can find here.</a> I will show you how to prepare an asset bundle that contains a complete scene, and one that only contains a single prefab.</p><p>The SceneBuilder contains everything a normal Unity app does: scenes, assets, scripts, the works. And something extra. But first, our runtime app is going to use the <a href="https://github.com/Microsoft/MixedRealityToolkit-Unity" target="_blank">Mixed Reality Toolkit</a>, some stuff from the <a href="http://localjoost.github.io/short-tip-using-ui-components-from" target="_blank">Mixed Reality Toolkit Samples</a>, <a href="http://dentedpixel.com/LeanTweenDocumentation/classes/LeanTween.html" target="_blank">LeanTween</a>, and <a href="https://github.com/LocalJoost/RemoteAssetsMixUg/tree/master/SceneBuilder/Assets/HoloToolkitExtensions" target="_blank">my own extensions</a>. I kind of all threw it in because why not. It also contains three scenes in the root.</p><ul><li>Main (which is empty and not used)</li><li>BuildScene (a rather darks scene which contains a house from the <a href="https://www.assetstore.unity3d.com/en/#!/content/98836" target="_blank">Low Poly Buildings Lite</a> package, and nothing else)</li><li>PrefabScene (which contains what seems to be a normal Mixed Reality app, as well an airplane called “<a href="https://archive3d.net/?a=download&amp;id=9d519310" target="_blank">Nathalie aguilera Boing 747</a>” (I assume “Boing” should be “Boeing”, and the model is actually a Boeing 7<strong><u>3</u></strong>7 but whatever – it’s a nice low poly model)</li></ul><p><a href="https://lh3.googleusercontent.com/-lFsazFWpT9c/WtdMpNTMSaI/AAAAAAAAPrs/EDB1d43wHI463DBGCJsm6TUlHHUi__e_gCHMYCw/s1600-h/image%255B11%255D"><img width="240" height="233" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-BzHRUjI_63E/WtdMp5X-YPI/AAAAAAAAPrw/wGgoBYMAAoA6RJ_BpmQDU5zpJLCndijHQCHMYCw/image_thumb%255B5%255D?imgmax=800" border="0"></a><a href="https://lh3.googleusercontent.com/-F3kgwFjlr2c/WtdMqRPzfjI/AAAAAAAAPr0/tuBJl_o8iqwMxwMiOLX-SjsFZf6zmH8egCHMYCw/s1600-h/image%255B16%255D"><img width="253" height="233" title="image" align="right" style="border: 0px currentcolor; border-image: none; float: right; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-8Kc78X80h3Y/WtdMqy3tMII/AAAAAAAAPr4/smvjXcBSFZUPdDkEM_SVHoUAeoKwvDTagCHMYCw/image_thumb%255B7%255D?imgmax=800" border="0"></a></p><p>The most important thing is the AssetBundle Browser. This is a piece of code provided by Unity to make building asset bundles a <em>lot</em> easier. You can find the AssetBundle Browser in folder “UnityEngine.AssetBundles” under “Assets. You can download the latest version <a href="https://github.com/Unity-Technologies/AssetBundles-Browser" target="_blank">from Unity’s Github repo</a>. It comes with a whole load, but basically you only need everything that’s under UnityEngine.AssetBundles/Editor/AssetBundleBrowser. This you plonk in your Scen eBuilder project’s Asset folder. </p><h2><a href="https://lh3.googleusercontent.com/-YRu3VMs1NzU/WtdMrkZgo3I/AAAAAAAAPr8/sRljNNrLUmsqfy22PMJRHh7uq1808MFLQCHMYCw/s1600-h/image%255B20%255D"><img width="240" height="162" title="image" align="right" style="margin: 0px 0px 0px 5px; border-image: none; float: right; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-B2EQxc1cFHk/WtdMsYW1G4I/AAAAAAAAPsA/gG9O4N_0dnsPoNadsj_EJNlBTDsfgvv0QCHMYCw/image_thumb%255B9%255D?imgmax=800" border="0"></a>The BuildScene</h2><p>If you open the BuildScene first, you will see there’s actually very little in it. An empty ‘SceneHolder’ object, and a “Suburb House 1” prefab in it. The lack of lighting also makes the scene rather dark. This has a reason: we are going to <em>add</em> this scene to another scene later, and we don’t want all kinds of duplicate stuff like lighting, Mixed Reality toolkit managers, etc. – coming into our existing app. So almost everything is deleted. But to that Prefab, one thing is added: the Horizontal Animator behavior (that debuted in <a href="http://dotnetbyexample.blogspot.nl/2017/10/finding-floor-and-displaying-holograms.html" target="_blank">this article</a>). T<a href="https://lh3.googleusercontent.com/-FotWgwn44D0/WtdMs__j2wI/AAAAAAAAPsE/xInkQWbiiGcf8ikbNAU66oujZ2MSZyCOACHMYCw/s1600-h/image%255B24%255D"><img width="240" height="57" title="image" align="right" style="margin: 0px 0px 0px 5px; border-image: none; float: right; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-EdGR1ivdv10/WtdMtmlI_4I/AAAAAAAAPsI/qaP3Y7dh6oINTr0U0F8iGoklG_HvGatZQCHMYCw/image_thumb%255B11%255D?imgmax=800" border="0"></a>his is a very simple behavior that will make the house spin round every five seconds. Nothing special – this is to prove a point later.</p><p>If you play the scene, you will actually see the house spinning in the scene. The Game window will be black, only saying “Display 1 No cameras rendering”, which is correct, as I deleted everything but the asset we are going to build and upload, so there’s even no camera to show anything.</p><h2>Build the buildscene asset bundle</h2><p>First order of business – build the UWP app, as if you are going to create an actual Mixed Reality app for <a href="https://www.microsoft.com/en-us/hololens" target="_blank">HoloLens</a> and/or immersive head set out of the SceneBuilder. For if you don’t, the AssetBundle browser will kick off that process, and if there’s a syntax error or whatever – it’s modal build window will get stuck, blocking Unity – and the only way out is killing it in the Task manager. </p><p>Click Window/AssetBundle Browser and you will see this:</p><p><a href="https://lh3.googleusercontent.com/-vLSaEMH_Ty4/WtdMufD_y7I/AAAAAAAAPsM/mAViNMFq37I5tgCWyX7ARfR6GTLDZInjgCHMYCw/s1600-h/image%255B47%255D"><img width="640" height="369" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-nBd34MhjyOY/WtdMu1gZ7KI/AAAAAAAAPsQ/GtSLIe601Sk_7Ivy_HeEoIgdgjWlPvtmACHMYCw/image_thumb%255B24%255D?imgmax=800" border="0"></a></p><p>I already pre-defined some stuff for you. What I basically did was, in an emtpy AssetBundle browser, drag the BuildScene into the empty screen:</p><p><a href="https://lh3.googleusercontent.com/-Ju25ytC-Xhs/WtdMvmNJUII/AAAAAAAAPsU/03u496W05-I9thzj9CNIhjnqrA2aEGubACHMYCw/s1600-h/Untitled%255B26%255D"><img width="644" height="230" title="Untitled" style="display: inline; background-image: none;" alt="Untitled" src="https://lh3.googleusercontent.com/-UiECwEKMXOU/WtdMwXdso7I/AAAAAAAAPsY/e8fpGiEQAfUl41JxsgowGpTx1ribu3xzgCHMYCw/Untitled_thumb%255B14%255D?imgmax=800" border="0"></a></p><p>and the AssetBundle Browser then adds everything it needs automatically. Click the tab “Build” and make sure the settings are the same as what you see here. Pay particular attention to the build target. That should be WSAPlayer, because that’s the target we use in the app that will <em>download</em> the assets.<br></p><p><a href="https://lh3.googleusercontent.com/-FyYV9ADC-8Y/WtdMxFS4U9I/AAAAAAAAPsc/8H85b-8PerQODCAjcQlVrI7-2QwcqMrdACHMYCw/s1600-h/Untitled%255B9%255D"><img width="640" height="374" title="Untitled" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="Untitled" src="https://lh3.googleusercontent.com/-_xnDtpdJIsg/WtdMx-Bns_I/AAAAAAAAPsg/emBoRGMDGf45FQKYMVhJ1H6KCksylMj5wCHMYCw/Untitled_thumb%255B5%255D?imgmax=800" border="0"></a></p><p>Hit the ugly wide “Build” button and wait till the build completes. If all works out, you will see four files in SceneBuilder\AssetBundles\WSAPlayer:</p><ul><li>buildscene</li><li>buildscene.manifest</li><li>WSAPlayer</li><li>WSAPlayer.manifest</li></ul><p>Only those where there all along, as I checked the folder with these files in GitHub. But go ahead, delete the files manually, you will see they are re-created. You will see they are all only 1 KB, except for buildscene – that’s 59 KB.</p><h2>The PrefabScene</h2><p>This looks more like a normal scene: it has everything in it you would expect in , <em>and</em> the airplane. </p><p><a href="https://lh3.googleusercontent.com/-mO29yJhA7-g/WtdMyXfIIkI/AAAAAAAAPsk/DebjKN3H2E41Uvn5cAz8LQBvsBGSQmVwACHMYCw/s1600-h/image%255B52%255D"><img width="640" height="200" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-5rIyM8TFmfw/WtdMzQszCPI/AAAAAAAAPso/CGOAsl2UWtULCbbTPScc-4S8WjXDc73SwCHMYCw/image_thumb%255B27%255D?imgmax=800" border="0"></a></p><p><a href="https://lh3.googleusercontent.com/-BJqBHQiwvto/WtdMz8PGJ1I/AAAAAAAAPss/3hBrlKDJkU0RLRbk5-NyJOC-ox10T1ZPwCHMYCw/s1600-h/image%255B61%255D"><img width="300" height="35" title="image" align="left" style="border: 0px currentcolor; border-image: none; float: left; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-8GKtjj-W_o0/WtdM0REChkI/AAAAAAAAPsw/_V8IFYpbeLEY8ngaVdAjnZJp9ksO_WTbwCHMYCw/image_thumb%255B32%255D?imgmax=800" border="0"></a>If you hit the play button in this scene, the airplane will move around in a way that makes you happy you are not aboard it, due to a behaviour called “Move Around”. This script sits in “Assets/App/Scripts” and is nothing more than an start method that creates a group of point relative to the start position and moves it around using LeanTween</p><pre style="font-size: 12px;">void Start()
{
    var points = new List&lt;Vector3&gt;();
    points.Add(gameObject.transform.position);
    points.Add(gameObject.transform.position);
    points.Add(gameObject.transform.position + new Vector3(0,0,1));
    points.Add(gameObject.transform.position + new Vector3(1,0,1));
    points.Add(gameObject.transform.position + new Vector3(-1,0,1));
    points.Add(gameObject.transform.position + new Vector3(-1,1,1));
    points.Add(gameObject.transform.position);
    points.Add(gameObject.transform.position);

    LeanTween.moveSpline(gameObject, points.ToArray(), 3).setLoopClamp();
}
</pre><p>But this script will later cause us some trouble as we will see in the next post (also to prove a point). I created a prefab of this airplane with it’s attached behaviour in Assets/App/Prefabs. Open the AssetBundle Brower again, drag this prefab onto the left pane of the dialog like this:</p><p><a href="https://lh3.googleusercontent.com/-Q1N9qDBCb1k/WtdM1PBzGVI/AAAAAAAAPs0/jtQ2bJxUvpsr_odUI394UjFqoy879QFuQCHMYCw/s1600-h/Untitled%255B14%255D"><img width="640" height="232" title="Untitled" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="Untitled" src="https://lh3.googleusercontent.com/--MFO21oXBdU/WtdM1qQrnsI/AAAAAAAAPs4/hy9vYav2cnwCzrujvVNowZzJjx4_ZqVrgCHMYCw/Untitled_thumb%255B8%255D?imgmax=800" border="0"></a></p><p><a href="https://lh3.googleusercontent.com/-rHu_3vpyvTY/WtdM2YcF2-I/AAAAAAAAPs8/RaxSB7tZtVIHGiZ-gnzH778N4Qu-OSprQCHMYCw/s1600-h/Untitled%255B18%255D"><img width="240" height="110" title="Untitled" align="left" style="margin: 0px 5px 0px 0px; border: 0px currentcolor; border-image: none; float: left; display: inline; background-image: none;" alt="Untitled" src="https://lh3.googleusercontent.com/-TzQ9jtDXrBA/WtdM2-9KNyI/AAAAAAAAPtA/SMYZjiGW0_QePisEoDQKzNUTN0G6eQUeACHMYCw/Untitled_thumb%255B10%255D?imgmax=800" border="0"></a>Only this creates an impossible long name, so simply right-click on the name and rename it to “airplane”. Select the “Build” tab again, hit the wide Build button again, wait a while.</p><p> If everything went according to plan, SceneBuilder\AssetBundles\WSAPlayer should now contain two extra files:</p><ul><li>airplane</li><li>airplane.manfest</li></ul><p>The manifest file is once again 1 KB, airplane itself should be 87 KB</p><h2>Uploading to Azure</h2><p>This is the easiest part. Use the <a href="https://azure.microsoft.com/en-us/features/storage-explorer/" target="_blank">Azure Storage Explorer</a>:</p><p><a href="https://lh3.googleusercontent.com/-WhsjsWKV_9w/WtdM3eYrezI/AAAAAAAAPtE/ecMW_WpsPL0YXF85JQn3a6i9iLU877W7QCHMYCw/s1600-h/Untitled%255B22%255D"><img width="644" height="305" title="Untitled" style="display: inline; background-image: none;" alt="Untitled" src="https://lh3.googleusercontent.com/-kby9ZLXVs0g/WtdM4EW1mUI/AAAAAAAAPtI/DtHIfONUCPoB9HzBexmnAp1w70CqXVqPACHMYCw/Untitled_thumb%255B12%255D?imgmax=800" border="0"></a></p><p>Simply drag your the airplaine and buildscene (you don’t need anything else) into a blob container of any old storage account. The right-click on a file, select “Get Shared Access Signature” and click “Create”, <em>but not before paying close attention to the date/time range, <u>particularly the start date and time</u></em></p><p><a href="https://lh3.googleusercontent.com/-lWLtk8dYOvs/WtdM4wqescI/AAAAAAAAPtM/NQq6n1EzPpMffHMd8CWqIDtZb7Aa-YAPgCHMYCw/s1600-h/image%255B72%255D"><img width="400" height="444" title="image" style="border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-Axkqe5y2jO8/WtdM5cMP_eI/AAAAAAAAPtQ/vjcz8ZVTQKg4zCfFxItLwmEc3nvIAd4tgCHMYCw/image_thumb%255B37%255D?imgmax=800" border="0"></a></p><p>The Azure Storage explorer tends to generate a start time some time (1.5 hours or so) <em>in the future</em>, and if you use the resulting url <em>right away</em>, it won’t work. Believe me – been there, done that, and I am glad no-one can could hear me ;). So dial back the start time to the present or a little bit in the past, then create the url, and save it. Do this for both the airplane and the buildscene file. We will need them in the next post to actually download and use them.</p><h2>Conclusion</h2><p>We have built two assets and uploaded them to Azure without writing any code – only a little code to make the airplane move, but that was not part of the build/upload procedure. Of course, sou can write the code to build asset bundles yourself, but I am <strike>lazy</strike> smart and tend to use what I can <strike>steal</strike> borrow from the internet. This was almost all point-and-click, next time we will see more code. For the impatient, the whole finished project <a href="https://github.com/LocalJoost/RemoteAssetsMixUg" target="_blank">can be found here</a>. </p>
