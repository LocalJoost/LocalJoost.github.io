---

title: Debugging C# code with Unity IL2CPP projects running on HoloLens or immersive
  headsets
date: '2019-03-11T12:59:00.000+01:00'
orgauthor: Joost van Schaik
tags:
- UWP
- HoloLens
- Windows Mixed Reality
- MRTK2
- Unity3D
- IL2CPP
modified_time: '2019-03-11T18:56:15.374+01:00'
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-25111262285339618
blogger_orig_url: https://dotnetbyexample.blogspot.com/2019/03/debugging-c-code-with-unity-il2cpp.html
---

<h2>Intro</h2><p>My relation with Unity is a complex one. I adore the development environment. It allows me to weave magic and create awesome <a href="https://www.microsoft.com/en-us/hololens" target="_blank">HoloLens</a> and Windows <a href="https://www.microsoft.com/en-us/windows/windows-mixed-reality" target="_blank">Mixed Reality</a> apps with it with an ease that defies imagination for someone who never tried it. I also have cursed them to the seventh ring of hell for the way the move (too) fast and break things. Some time ago Unity announced they would do away with the .NET backend. This does not mean you can't develop in C# anymore - you still do, but <em>debugging</em> becomes quite a bit more complicated. You can find how you can do it in various articles, forum posts, etc. They all have part of the story but not everything. I hope this fills the gap and shows the whole road to IL2CPP debugging in an easy to find article.</p><h2>Context </h2><p>Typically, when you build an app for Mixed Reality, you have a solution with C# code that you use while working inside the Unity Editor. You use this for typing code and trying things out. I tend to call this "the Unity solution" or "the editor solution". It is <em>not</em> a runnable or deployable app, but you can attach the Visual Studio debugger to the Unity editor by pressing Start in Visual Studio, and the the play button in Unity. Breakpoints will be hit, you can set watches, all of it. Very neat.</p><p>When you are done or want to test with a device, you <em>build</em> the app. This generates <em>another </em>solution (I call that the deployment solution) that actually is an UWP app. You can deploy <em>that</em> to a HoloLens or to your PC with Mixed Reality headset attached. This is essentially the same code but in a <em>different</em> solution. The nice part of that is that if you compile it for debug, you can <em>also </em>put in breakpoints and analyze code on a running device. Bonus: if you change just some code you don't have to rebuild the deployment solution over and over again to do another test on the device.</p><h2>Enter IL2CPP (and bit of a rant, feel free to skip)</h2><p>Unity, in their wisdom, have decided the deployment solutions in C# are too slow, they have deprecated the .NET 'backend', and so in stead of generating a C# UWP solution, they generate a <strong>C++</strong> UWP solution. If you build, your C# code <em>will be rewritten in C++,</em> you will need to compile that C++ and deploy the resulting app to your device. Compilation takes a whole lot longer, if you change as much as a comma you need to build the whole deployment solution again, and the actual running code (C++) no longer resembles any code you have written yourself. And when they released this, you could also forget about debugging your C# code in a running app. Unity did not only move the cheese, they actually blew up part of the whole cheese storehouse. </p><p>With Unity 2018.2.x - they've basically sent over some carpenters to cover up the hole with plywood at plaster. And now you can sort-of debug your C# code again. But it's a complicated and rather cumbersome process. </p><h2>Brave new world - requirements</h2><p>I installed all of Desktop and UWP C++ development bits, probably a bit over the top. </p><p><img width="640" height="309" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20191103/Installecplusplus.png" border="0"></p><p>At one point I got complaints about the "VC++ 2015 (140) toolset" missing while compiling so I added that too. This is apparently something the Unity toolchain needs. Maybe this can be more efficient, needing less of this stuff, but this works on my machine. I really don't know anything about C++ development. I tried somewhere in the mid 90s and failed miserably. </p><p>Also crucial: install the Visual Studio tools for Unity, but chances are you already have, because we needed this too met .NET backends:</p><p><img style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20191103/gamedev.png" border="0"></p><p>I did uncheck the Unity Editor option, as I used Unity 2018.3.6f1 in stead of the one Visual Studio tries to install. I tend to manage my Unity installs via the Unity Hub.</p><h2>Build settings</h2><p>In Unity, I use this settings for building the debuggable C++ app</p><p><img width="427" height="414" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20191103/Buildsettings.png" border="0"></p><p>I am not entirely sure if the "Copy References" is really necessary but I have added it anyway. The warning about missing components is another nice Unity touch - apparently something is missing, but they don't tell you what. My app is building, so I suppose it's not that important for my setup. </p><h2>App capability settings</h2><p>Now this one is crucial. To enable debugging, Unity builds a specialized player with some kind of little server in it that enables debuggers to attach to it. This means, it needs to have network access. The resulting app is still a UWP app, so it's <em>network capabilities </em>need to be set. You can do that in either the resulting C++ solution's manifest or in the Unity editor, using the "Player Settings" button. Under "Publishing Settings" you will find this box where you can set capabilities</p><p><img style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20191103/capabilities.png" border="0"></p><p>I just added all network related stuff for good measure. The advantage of doing it here is that it will be added back even if you need to rebuild the deployment solution from scratch. The drawback is that you might forget to remove capabilities you don't need and you will end up with an app asking for a lot of capabilities it doesn't use. For you to decide what works best.</p><h2>Selecting the IL2CPP backend</h2><p>In case Unity or the MRTK2 does not do this for you automatically, you can find this setting by pressing the Player Settings button as well. In "Other settings" you can find the "Scripting Backend". Set this to IL2CPP.</p><p><img width="366" height="272" src="https://www.schaikweb.net/blog/20191103/IL2cpp2.png"></p><h2>Building and deploying the UWP C++ app.</h2><p>A C++ UWP app generated by Unity looks like this:</p><p><img style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20191103/Solution.png" border="0"></p><p>Now maybe this is obvious for C++ developers but make sure the app that is labeled "Universal Windows" is the startup project. I was initially thrown off kilter by the "Windows Store 10.0" link and assumed <em>that</em> was the startup project.</p><p>Important is to build and deploy the app for <em>Debug</em>, that has not changed since the .NET backend days. Choose target and processor architecture as required by your device or PC</p><p><img width="261" height="23" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20191103/debug.png" border="0"></p><p>Make sure the app actually gets deployed to wherever you want to debug it. Use deploy, not build (from the Build menu in Visual Studio)</p><h2>And now for the actual debugging</h2><p>First, start the app on the machine - be it a PC or a HoloLens, that does not matter - where it needs to be debugged</p><p>Go back to your Unity C# ('editor' ) solution. Set breakpoints as desired. And now comes the part that really confused me for quite some time. I am used to debug targets showing up <em>here.</em></p><p><img width="205" height="69" src="https://www.schaikweb.net/blog/20191103/BuildTarget.png"></p><p>But they never do. So don't go there. This is only useful when you are debugging <em>inside the Unity Editor</em>. In stead, what you need to do is go to the Debug menu of the main Visual Studio Window and select "Attach Unity Debugger" </p><p><img width="397" height="295" src="https://www.schaikweb.net/blog/20191103/unitydebugger.png"></p><p>I've started the app on both my HoloLens and as a Mixed Reality app on my PC, and I can choose of no less than three debug targets now: the Unity editor on my PC, the app running on the HoloLens and the app running on the PC</p><p><img width="334" height="184" src="https://www.schaikweb.net/blog/20191103/Debugtargets.png"></p><p>"Fudge" is the name of the gaming quality rig kindly built by a colleague a bit over a year ago, "HoloJoost" is my HoloLens. I selected the "Fudge" player. If you select a player, you will get an UAC prompt for the "AppContainer Network Isolation Diagnostics Tool". Accept that, and then this pops open:</p><p><img width="640" height="335" src="https://www.schaikweb.net/blog/20191103/debuggerconsolde.png"></p><p><em>Leave this alone. </em>Don't close it, don't press CTRL-C. </p><p>Now just go over to your Mixed Reality app, be it on your HoloLens or your Immersive Headset, and trigger an action that will touch code with a breakpoint in it. In my case, that happens when I tap the asteroid</p><p><img width="640" height="386" src="https://www.schaikweb.net/blog/20191103/astroidhit.png"></p><p>And then finally, Hopper be praised:</p><p><img src="https://www.schaikweb.net/blog/20191103/breakpointhit2.png"></p><p>The debugger is back in da house.</p><h2>Conclusions</h2><p>This is not something I get overly happy about, but at least we are about three-quarters of where we were before. We can again debug C# code in a running app, but with a more convoluted build process, less development flexibility, and the need to install the whole C++ toolchain. But as usual, in IT, the only way is forward. The <a href="https://github.com/Microsoft/MixedRealityToolkit-Unity/blob/mrtk_release/Documentation/GettingStartedWithTheMRTK.md" target="_blank">Mixed Reality Toolkit 2</a>, that is used to built this asteroid project, requires Unity 2018.2.x. HoloLens 2 apps will be built with MRTK2 and thus we will have deal with it, move forward and say goodbye to the .NET backend. Unless we don't want to build for HoloLens 2 - which is <em>no option at all</em> for me ;)</p><p>No test project this time, as this is not about code but mere configuration. I will start blogging MRTK2 tidbits soon, though.</p><h2>Credits</h2><p>There is a host of people who gave me pieces of the puzzle that made it possible for to piece the whole thing together. In order of appearance:</p><ul><li><a href="https://twitter.com/SimonDarksideJ" target="_blank">Simon 'Darkside' Jackson</a> (fellow MVP who helped me to get to grips with MRTK2)</li><li><a href="https://twitter.com/stephenhodgson_" target="_blank">Stephen Hodgson</a> (fellow MVP, ditto above)</li><li><a href="https://twitter.com/@TautvydasZilys" target="_blank">Tautvydas Å½ilys</a> of Unity itself who pointed me to <a href="https://forum.unity.com/threads/hololens-uwp-w-il2cpp-backend-no-debug-targets-in-visual-studio-2017.548734/" target="_blank">this post</a> in the forums</li><li><a href="http://twitter.com/@tamezsoftware" target="_blank">Chris Tamez</a> who pointed me to <a href="https://docs.unity3d.com/Manual/ManagedCodeDebugging.html" target="_blank">this manual</a> for debugging in the Unity doc</li><li>And last but certainly not least, my longtime good Microsoft friend from Italy <a href="https://twitter.com/qmatteoq" target="_blank">Matteo Pagani</a> who pointed me to <a href="https://techcommunity.microsoft.com/t5/Windows-Dev-AppConsult/How-to-debug-Unity-projects-with-IL2CPP-backends-on-the-Hololens/ba-p/317998" target="_blank">this post</a> by one <a href="https://techcommunity.microsoft.com/t5/user/viewprofilepage/user-id/145981" target="_blank">Mark Plogas</a> that showed me the final crucial missing piece about the Unity debugger entry in the Debug menu&nbsp; .</li></ul>