---

title: Making internals unit testable
date: '2010-06-11T08:51:00.001+02:00'
orgauthor: Joost van Schaik
tags:
- dotnetmag
- C#
- Unit Test
modified_time: '2010-10-04T21:05:57.588+02:00'
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-3279193479211585215
blogger_orig_url: https://dotnetbyexample.blogspot.com/2010/06/making-internals-testable.html
---

<p>When creating - or attempting to create ;-) - reusable components, it’s common practice to hide the gory details of your implementation – not only on class level, but also on assembly level. The drawback of this approach is that you cannot write unit tests to test low-level operations of your component – invisible to the world means invisible to your assembly with unit tests as well.</p>  <p>One approach is to make the component that is to be tested public after all – I admit I did it a couple of times in my wee days before I learned of this trick that actually dates back to .NET 2.0 if I am correct.</p>  <p>Let us assume you have a library <strong>MyCompany.GreatObjects.dll</strong>, in which you have a component <strong>MyCompany.GreatObjects.Internals.MyInternalComponent</strong>, and a test library in <strong>MyCompany.GreatObjects.Test.dll</strong>.</p>  <p><span style="font-size: 130%">1. Strongly name your <em>test</em> project</span></p>  <p>Say what? No, I am getting older but<em>&#160;</em>I am still not senile (or at least no-one dared to tell me yet). If you don’t know what I mean with strong naming, follow the procedure described <a href="http://msdn.microsoft.com/en-us/library/xc31ft41.aspx" target="_blank">here</a>. You might want to strongly name your project to be tested as well, when you are at it ;-) And then build your solution again.</p>  <p><span style="font-size: 130%">2. Open a Visual Studio Command Prompt</span></p>  <p>Open the command prompt belonging to the version of Visual Studio you are currently using to develop and test your components. Navigate to the bin/debug subdirectory of your MyCompany.GreatObjects project.</p>  <p><span style="font-size: 130%">3. Retrieve the public key of your component</span></p>  <p>Enter the following command:    <br /><strong>sn –Tp MyCompany.GreatObjects.dll</strong></p>  <p>This will give two answers – the first one, preceded by the text “Public key is” is the one you are after. It will span something like four and a bit lines and look like this:    <br /><em>0024000004800000940000000602000000240000525341310004000001000100dfb0f05568ca56      <br />3e3ae7449a48d8060be86bc091a88e915a29270a43417aa82c73dea3184beab7e4dfdfca865380       <br />dcda1d8ca2c472b5bd7f889a0f5e77d5ec0b9990a4ca03fb71c881a51585416b1e58be6da0875b       <br />42a2d754911fbfa1daa60884c6a6ff14f636530e197c61310f622794b0f4fbd36ade16b9ea6fa3       <br />b850febd</em></p>  <p>Copy that code into a text file and carefully remove all line breaks, so that all these characters end up in one line. Take care not to remove any other character or your name is mud.</p>  <p><span style="font-size: 130%">4. Edit the AssemblyInfo.cs of the component project</span></p>  <p>This file sits in the “Properties” application folder of your MyCompany.GreatObjects project.&#160; Add the following line (where does not matter, but the end is a logical place):    <br /><strong>[assembly: InternalsVisibleTo(&quot;MyCompany.GreatObjects.Test, PublicKey=****&quot;)]      <br /></strong>replace the **** by the actual value for the public key you retrieved – <em>on one line</em>.     <br />Rebuild the MyCompany.GreatObjects project, and you are done. You can now test MyCompany.GreatObjects.Internals.MyInternalComponent<strong> –</strong> and other objects marked as internal, of course - from MyCompany.GreatObjects.Test. <em>But only from MyCompany.GreatObjects.Test</em>. For the rest of the world the internals are still safely invisible.</p>  <p>Purists might say that you only need to test external behavior of your component, but I can think of plenty of scenarios in which you want to change the working of an internal piece of code and still want to be able to verify its behavior – internal or not.    <br />    <br />Credits go to my colleague <a href="http://nl.linkedin.com/in/vmakkenz" target="_blank">Valentijn Makkenze</a> for pointing this out to me first</p>  