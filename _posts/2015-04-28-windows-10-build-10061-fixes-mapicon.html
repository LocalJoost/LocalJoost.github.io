---
layout: post
title: Windows 10 build 10061 fixes MapIcon woes!
date: '2015-04-28T12:53:00.001+02:00'
orgauthor: Joost van Schaik
tags:
- UWP
- Mapping
- Windows 10
modified_time: '2015-05-18T08:09:01.157+02:00'
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-4249903074750517805
blogger_orig_url: https://dotnetbyexample.blogspot.com/2015/04/windows-10-build-10061-fixes-mapicon.html
comment_issue_id: 205
---

<p>I discovered this while preparing for my Techdays 2015 talk and you probably have to be a mapping nut like me to appreciate this fully, but some things cannot wait until my session itself, so here’s this thing I found out while pressed a dot after a <a href="https://msdn.microsoft.com/en-us/library/windows.ui.xaml.controls.maps.mapicon.aspx" target="_blank">MapIcon</a> type variable after having upgraded to <a href="http://windows.microsoft.com/en-us/windows-10/about" target="_blank">Windows 10</a> build 10061.</p> <p><a href="http://windowsphone.com" target="_blank">Windows Phone</a> 8.1 brought an awesome new map control that introduced the concept of MapIcon. Previously, if you had to draw point objects on a map depicted by an image, you had to resort to drawing XAML elements on top of the map. While the map itself took care of the position of the icon, behind the scenes it was not the map, but the UI thread taking care of drawing the icons, which is quite resource-heavy as anyone who has tried to draw a lot of points on a Windows Phone map will acknowledge. This resulted also in the icons lagging visibly behind when you change position, something you (unfortunately) can see very good when you use my <a href="http://lumiaconversations.microsoft.com/2014/04/04/tapping-into-your-phones-sensors-nokia-sensorcore/" target="_blank">Sensorcore</a> app <a href="http://www.windowsphone.com/en-us/store/app/travalyzer/4314b3ed-8d77-4297-9f9e-ed576d8990b0" target="_blank">Travalyzer</a>.</p> <p>Enter Windows Phone 8.1, that as I said introduced the MapIcon – an icon with optional label type of object that is drawn by the map, that does not lag behind…. and was, for all but a few limited scenarios, not really useful for real world use, for two reasons,</p> <p>First of all, it sported a bug, making it ignore the Z-index.If you used any other shapes on the same map (lines or polygons) they <em>always</em> appear <em>over</em> the icons, effectively blocking them from view. This is not what you want in a GIS application.</p> <p>What was even worse was the ‘best effort drawing feature’. To optimize performance, the map component opted to omit drawing MapIcons on ‘collision’, that is, when a lot of them were drawn too close together. This had the unfortunate side effect of icons popping in and out of existence when you zoomed or panned, you had no control which icons appeared (or not) and to make matters worse, if you checked for the presence of a MapIcon by using FindMapElementsAtOffset it returned nothing, even if you actually had put the icon on the map.</p> <p>Both of these issues have been fixed.The most major fix is the addition of the property <strong>CollisionBehaviorDesired</strong> property to the MapIcon, which is an enumeration:</p><pre>namespace Windows.UI.Xaml.Controls.Maps
{
  [ContractVersion(typeof(UniversalApiContract), 65536)]
  [WebHostHidden]
  public enum MapElementCollisionBehavior
  {
    HideOnCollision = 0,

    ShowOnCollision = 1
  }
}</pre>
<p>By simply setting the CollisionBehaviorDesired property of every icon MapElementCollisionBehavior.ShowOnCollision the icon is always displayed.</p>
<p>The difference is quite clear:</p>
<p><a href="http://www.schaikweb.net/dotnetbyexample/Windows-10-build-10061-fixes-MapIcon-woe_AA79/map1.png"><img title="map1" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="map1" src="http://www.schaikweb.net/dotnetbyexample/Windows-10-build-10061-fixes-MapIcon-woe_AA79/map1_thumb.png" width="284" height="284"></a><a href="http://www.schaikweb.net/dotnetbyexample/Windows-10-build-10061-fixes-MapIcon-woe_AA79/Map-2.png"><img title="Map-2" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; margin: 0px 0px 0px 10px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="Map-2" src="http://www.schaikweb.net/dotnetbyexample/Windows-10-build-10061-fixes-MapIcon-woe_AA79/Map-2_thumb.png" width="284" height="284"></a></p>
<p>Then I wondered “well have they maybe fixed the Z-index issue too?”, and lo and behold the icon is clearly drawn on top of the fat bluish line:</p>
<p><a href="http://www.schaikweb.net/dotnetbyexample/Windows-10-build-10061-fixes-MapIcon-woe_AA79/map-3.png"><img title="map-3" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="map-3" src="http://www.schaikweb.net/dotnetbyexample/Windows-10-build-10061-fixes-MapIcon-woe_AA79/map-3_thumb.png" width="284" height="123"></a></p>
<p>The CollisionBehaviorDesired property will probably come with a performance hit, but mapping fans will most likely agree these changes make MapIcon now very much usable in broader scenarios.</p>
<p><strong>Update May 1st, 2015</strong>: the enumeration has been slightly changed as of build 10074. Now it's</p><pre>namespace Windows.UI.Xaml.Controls.Maps
{
  [ContractVersion(typeof(UniversalApiContract), 65536)]
  [WebHostHidden]
  public enum MapElementCollisionBehavior
  {
    Hide = 0,
    RemainVisible = 1
  }
}</pre>  
