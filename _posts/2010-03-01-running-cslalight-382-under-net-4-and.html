---

title: Running CSLALight 3.8.2 under .NET 4 and Silverlight 4
date: '2010-03-01T21:09:00.000+01:00'
orgauthor: Joost van Schaik
tags:
- ".NET 4.0"
- CSLA
- dotnetmag
- C#
- Silverlight 4.0
- Visual Studio 2010
modified_time: '2013-12-23T08:20:29.905+01:00'
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-3100119799386849003
blogger_orig_url: https://dotnetbyexample.blogspot.com/2010/03/running-cslalight-382-under-net-4-and.html
---

<b>Update December 23, 2013: this is article is pretty much outdated. Currently it gets a lot of traffic. I hope some people reading it would like to leave a comment and tell me WHY the are reading it</b>

<p><a href="http://www.lhotka.net/cslanet/" target="_blank">CSLA .NET</a> by <a href="http://twitter.com/RockyLhotka" target="_blank">Rockford Lhotka</a> is a business layer framework, but it does not run under .NET4 and Silverlight 4 yet. Fortunately this framework comes with sources, and I set out to get a simple sample application to run under Silverlight 4. As always, it is a lot more work to find out what to do than to actually do it, but eventually I was successful. To make life for those who want to follow me a little harder: I am using Visual Studio 2010RC and the Silverlight 4 tools beta. I know those are not supposed to work together, but if you follow <a href="http://translate.google.com/translate?hl=en&amp;sl=auto&amp;tl=en&amp;u=http://sorokoletov.com/2010/02/hate-2-wait-silverlight-4-beta-2-vs-2010-rc/" target="_blank">this procedure</a> you actually can run Silverlight 4 tools inside the RC. This procedure, however, included hacking an installer and then editing some registry keys. Follow this procedure at your own risk. It worked for me, but maybe the procedure for getting CSLA to run under .NET 4 and Silverlight 4 may work under VS2010 B2 as well. </p> <span style="font-size: 130%">1. Download these files</span>   <ul>   <li>cslalightcs-3.8.2-100201.zip </li>    <li>lightsamples-3.8.2-100201.zip </li> </ul>  <p>Which can all be found on the CSLA.NET site.</p> <span style="font-size: 130%">2. Unzip the files in working directories</span>   <p>The net result should be something like this    <br />CSLA     <br />&#160; - clsacs     <br />&#160; - clsalightcs     <br />&#160; - Dependencies     <br />&#160; - README.txt     <br />LightSamples     <br />&#160; - cslalight     <br />&#160; - readme.txt</p> <span style="font-size: 130%">3. Compile clsacs.sln for .NET 4.0</span>   <ul>   <li>Start Visual Studio 2010, and open the solution clsacs.sln in CSLA\cslacs. </li>    <li>Let Visual Studio 2010 convert the project </li>    <li>right-click the csla project, select properties and change the target framework to .NET 4.0 </li>    <li>Change the active solution configuration to “Release” </li>    <li>Rebuild the solution. This will give some errors. If you check the clsa project’s references, you will see warning signs indicating missing assemblies, which are:      <ul>       <li>PresentationCore </li>        <li>PresentationFramework </li>        <li>System.Printing </li>        <li>System.Runtime.Serialization </li>        <li>System.ServiceModel </li>        <li>System.Workflow.Runtime </li>        <li>WindowsBase </li>     </ul>   </li>    <li>Remove these references and replace them by their .NET 4.0 brethren. </li>    <li>Add a reference to System.Xaml </li>    <li>Rebuild the solution. You will get a whole lot of warnings but CSLA will compile. </li> </ul> <span style="font-size: 130%">4. Compile cslalightcs.sln for Silverlight 4</span>   <ul>   <li>Start Visual Studio 2010, and open the solution clsalightcs.sln in CSLA\cslalightcs. </li>    <li>Let VS2010 convert the project </li>    <li>right-click the Cslalight project, select properties and change the Target Silverlight Version to 4.0 </li>    <li>Add a reference to System.Net </li>    <li>Change the active solution configuration to “Release” </li>    <li>Rebuild the solution. Once again, a whole lot of warnings but CSLAlight will compile </li> </ul>  <p><span style="font-size: 130%">5. Convert and compile the SimpleApp sample</span> </p>  <p>If you browse into LightSamples\cslalight\cs\SimpleApp with the Windows Explorer you will find a simple CSLA/CSLA light solution that demonstrates the basic setup of the CSLA data portal for Silverlight. We will convert this application to work under our freshly created CSLA and CSLALight libraries. </p>  <ul>   <li>Open the SampleApp.sln solution with Visual Studio 2010 </li>    <li>Let Visual Studio 2010 convert the solution </li>    <li>Click “Yes” to upgrade to .NET 4.0 and ignore further errors </li>    <li>The solution contains 4 projects.      <ul>       <li>Set the Target Silverlight Version of Library.Client and SimpleApp to Silverlight 4 </li>        <li>Set the target framework for Library.Server to .NET 4.0. No need to change SimpleApp.Web, Visual Studio has already done that </li>     </ul>   </li>    <li>In project Library.Client:      <ul>       <li>Check the references. You will find “Csla” missing. </li>        <li>Remove the reference </li>        <li>Click Add Reference/Browse </li>        <li>Browse to CSLA\cslalightcs\Csla\ClientBin. </li>        <li>Add References to Csla.dll and System.Windows.Interactivity.dll </li>     </ul>   </li>    <li>Repeat the procedure for SimpleApp </li>    <li>In project Library.Server:      <ul>       <li>Check the references. You will find “Csla” missing. </li>        <li>Remove the reference </li>        <li>Click Add Reference/Browse </li>        <li>Browse to CSLA\cslacs\Csla\bin\Release </li>        <li>Add a Reference to Csla.dll </li>     </ul>   </li>    <li>Repeat the procedure for SimpleApp.Web. </li> </ul>  <p><span style="font-size: 130%">6. Change the ServiceReferences.ClientConfig</span> </p>  <p>This actually took me the longest, because I did not understand the problem. If you run the application (right click SimpleApp.Web/SimpleAppTestPage.aspx and click “View in Browser”), enter some values “for “Name” and “City” and hit “Save” you get an error indicating that there is no endpoint for contract “WcfPortal.IWcfPortal”.</p>  <p>Apparently <em>something</em> has changed in how Service Contracts are referenced in Silverlight 4. The solution turns out to be this: </p>  <ul>   <li>open the ServiceReferences.ClientConfig file in the SimpleApp project </li>    <li>Locate the text <font color="#ff0000">contract</font><font color="#0000ff">=&quot;Csla.WcfPortal.IWcfPortal&quot;</font>&#160; </li>    <li>Remove the “Csla.” prefix, including the dot, so that only <font color="#ff0000">contract</font><font color="#0000ff">=&quot;WcfPortal.IWcfPortal&quot;</font> remains </li>    <li>Run SimpleApp.Web/SimpleAppTestPage.aspx again </li> </ul>  <p>Hit some values for “Name” and “City” again, hit “Save” and the text “Inserted Client” appears. You can set some breakpoints to see CSLA actually goes back to the server for that. And, of course, you can right-click on the Silverlight application, click “Silverlight” on the ‘context menu’ and see that actually runs under Silverlight 4</p>  <p>This of course guarantees by <em>no</em> means that <em>all</em> the features of Csla will work under Silverlight 4 but at least we can go forward playing around in this new environment.</p>  