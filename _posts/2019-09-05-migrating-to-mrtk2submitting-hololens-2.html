---
layout: post
title: Migrating to MRTK2–submitting a HoloLens 2 app to the Microsoft Store
date: '2019-09-05T20:58:00.000+02:00'
author: Joost van Schaik
tags:
- HoloLens
- Unity
- Windows Mixed Reality
- MRTK2
- HoloLens2
- Microsoft Store
modified_time: '2019-09-05T20:59:28.526+02:00'
thumbnail: https://i.ytimg.com/vi/pwE3SPLB8Ko/default.jpg
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-8306438080166903768
blogger_orig_url: https://dotnetbyexample.blogspot.com/2019/09/migrating-to-mrtk2submitting-hololens-2.html
---

<h2>Intro</h2><p>On Monday September 2 version 4.0.19 of my first <a href="https://www.microsoft.com/en-us/hololens" target="_blank">HoloLens</a> Store app, <a href="https://www.microsoft.com/store/productId/9P6SVQQCP2SQ" target="_blank">AMS HoloATC</a>, became available in the Microsoft Store. This version has been completely rebuilt using the <a href="https://github.com/microsoft/MixedRealityToolkit-Unity" target="_blank">Mixed Reality Toolkit 2</a>, and includes some HoloLens 2–only functionality: you can actually touch the airplanes now, and using gaze tracking it will show you a picture of the actual aircraft, if available. </p><iframe width="650" height="365" src="https://www.youtube.com/embed/pwE3SPLB8Ko" frameborder="0" allowfullscreen="" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"></iframe><h2>Hoops to jump</h2><p>As you might recall from earlier posts, things have changed quite a bit when it comes to actually deploying apps on HoloLens. Now, we will need compiling and submitting a Unity-generated C++ solution to the store. Although the process looks very much like we used to do for Unity apps running on the .NET backend, there are three things you might run into:</p><ol><li>Your WACK test will most likely fail</li><li>If you have submitted your app as a bundle before, make sure you submit it as a bundle again. A Unity generated C++ solution does not have this as a default setting</li><li>If you create (like me) an app that is supposed to run on Desktop (in immersive head sets), HoloLens 1 <em>and</em> HoloLens 2 you may find out your app cannot be downloaded by a HoloLens 1 anymore – or the HoloLens 2 emulator, for what matters</li></ol><h2>Fixing the WACK fail</h2><p>Before you actually submit an app to the Store, you do the Windows Application Certification test first, to prevent embarrassing easy-to-prevent fails, right. (<em>right?). </em>And if you do so, you will see it fail. It will spout quite some errors at you.</p><ul><li>The Windows security features test will complain about:</li><ul><li>HolographicAppRemoting.dll has failed the AppContainerCheck check.</li><li>
PerceptionDevice.dll has failed the AppContainerCheck check.<br></li><li>UnityRemotingWMR.dll has failed the AppContainerCheck check.</li></ul><li>The Supported API test will list 10 errors concerning UnityRemotingWMR calling unsupported APIs</li><li>The Debug configuration test will tell youUnity RemotingWMR is only built in debug mode</li><li>And if you try to build for x86 or ARM, the Package sanity test will tell you HolographicAppRemoting.dll, PerceptionDevice.dll and UnityRemotingWMR.dll are only available for x64.</li></ul><p>The solution is bit weird, but can be found <a href="https://forum.unity.com/threads/hololens-appx-built-with-2018-4-3f1-fails-store-submission.706994/" target="_blank">in this Unity forum post</a>, and involves manually hacking the “Unity Data.vcxitems” file that is inside your store projects. Open in it in a text editor, and search for “HolographicAppRemoting”. This will show this piece of XML:</p><pre>&lt;None Include="$(MSBuildThisFileDirectory)HolographicAppRemoting.dll"&gt;
  &lt;DeploymentContent&gt;true&lt;/DeploymentContent&gt;
  &lt;ExcludeFromResourceIndex&gt;true&lt;/ExcludeFromResourceIndex&gt;
&lt;/None&gt;</pre><p>Now simply change the value “true” inside the DeploymentContent to false:</p><pre>&lt;None Include="$(MSBuildThisFileDirectory)HolographicAppRemoting.dll"&gt;
  &lt;DeploymentContent&gt;<font color="#ff0000"><strong>false</strong></font>&lt;/DeploymentContent&gt;
  &lt;ExcludeFromResourceIndex&gt;true&lt;/ExcludeFromResourceIndex&gt;
&lt;/None&gt;</pre><p>Repeat this for PerceptionDevice and UnityRemotingWMR. Rebuild your app, generated packages again and presto, your WACK test will pass. That is literally all that’s needed to get rid of this multitude of errors. </p><h2>Bundling your app</h2><p>I don’t know exactly what changed, but all my HoloLens apps that I created with previous Unity versions were uploaded as bundles. To be honest, I never did pay much attention to it. But the default setting of the generated C++ setting is this:</p><p><img width="562" height="480" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190905/Bundle.PNG" border="0"></p><p>which generates an appx per platform (in my case three: one for x64, one for x86 and one for ARM for, in the same order, WMR immersive headsets, HoloLens 1 and HoloLens 2). If you try to upload those files as updates to an app that was previously submitted as a bundle you will be greeted with:</p><p><font color="#ff0000"><img width="562" height="139" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190905/Error.png" border="0"></font></p><p>And this can simply be fixed by changing the setting “Generate app bundle” from “If needed” to “Always”</p><p><font color="#ff0000"><img width="122" height="50" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190905/Bundle2.png" border="0"></font></p><h2>Make your app (still) downloadable for HoloLens 1</h2><p>To be honest, 4.0.19 was not the first HoloLens 2 enabled version I submitted. That was 4.0.17. It got certified – as one of the first if not the very first indie HoloLens 2 app. I was very happy about this – for about 25 seconds. And then I got a very unpleasant surprise: I could not download it anymore on a HoloLens 1. Sure enough, you could find it in the store, but the “Install” button was greyed out (well, light blue in stead of dark blue, but in any case unoperational). Curiously enough, a HoloLens that had it already installed did get the updated version though. </p><p>The reason for this behavior can be found down in <a href="https://forum.unity.com/threads/unable-to-download-hololens-app-from-microsoft-store-possible-unity-version-connection.640720/" target="_blank">this post in the Unity forums</a>. Basically, Unity dropped support for anything lower than DirectX 10 and this is listed now in the app’s store manifest. Unfortunately, when the Store on the HoloLens 1 (and the HoloLens 2 emulator, incidentally) checks for DirectX 10, the device apparently reports “don’t have that” and the Store consequently blocks download.</p><p>Now I think this will be fixed shortly, but in the mean time here’s a workaround for if you need do to a submission right now:</p><p>First, open the Package.AppManifest.xml file in a text editor. Find these lines:</p><pre style="font-size: 10px;">&lt;TargetDeviceFamily Name="Windows.Desktop" MinVersion="10.0.16299.0" MaxVersionTested="10.0.18362.0" /&gt;
&lt;TargetDeviceFamily Name="Windows.Holographic" MinVersion="10.0.16299.0" MaxVersionTested="10.0.18362.0" /</pre><p>Comment out the <em>second</em> line. Then proceed to build a bundle, but for x64 <em>only</em>.</p><p>Go back to Package.AppManifest.xml, uncomment the <em>first</em> line, and re-activate the second. Now find the StoreManifest.xml file – open it in a text editor. It should look like this:</p><pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;StoreManifest xmlns="http://schemas.microsoft.com/appx/2015/StoreManifest"&gt;
    &lt;Dependencies&gt;
        &lt;DirectXDependency Name="D3D11_HWFL_10_0" /&gt;
    &lt;/Dependencies&gt;
&lt;/StoreManifest&gt;</pre><p>Simply remove the line &lt;DirectXDependency Name="D3D11_HWFL_10_0" /&gt;
</p><p>Now build a package for x86 and ARM. I am not sure if this is essential, but I made sure the x86/ARM bundle was had a one release number one point higher than the x64. </p><p>Now proceed to upload both bundles into a submission and set check boxes as needed. In my store submissions it looks like this:</p><p><img width="640" height="284" style="border: 0px currentcolor; border-image: none; background-image: none;" src="https://www.schaikweb.net/blog/20190905/StoreView.png" border="0"></p><p>Now as you can see version 4.0.17 still contains <em>all</em> platforms, but that is not necessary. But because the 4.0.19 has a higher version number, it will be offered first to HoloLens 1 and 2.</p><p>Anyway, now your app, once certified, should be downloadable for all devices. On x64 the DirectX 10 check will be still in place, for other devices it’s disabled. </p><h2>Conclusion</h2><p>It’s early days for HoloLens 2 (I built my app without having direct access to it) but I think it’s pretty cool to have an app armed and ready for it. It takes some fiddling around with xml files to get it right, but I am sure things will be better soon and these work arounds won’t be necessary anymore. </p><p>Enjoy building the next generation Mixed Reality apps!</p>