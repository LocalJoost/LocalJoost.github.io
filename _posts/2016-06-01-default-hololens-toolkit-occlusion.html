---
layout: post
title: Default HoloLens Toolkit occlusion script turns magenta
date: '2016-06-01T18:23:00.001+02:00'
author: Joost van Schaik
tags:
- HoloLens
- Unity3D
- Augmented Reality
modified_time: '2016-06-01T18:23:49.142+02:00'
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-1028984021281229300
blogger_orig_url: https://dotnetbyexample.blogspot.com/2016/06/default-hololens-toolkit-occlusion.html
---

<p>After following some on-line video’s and snooping through some other’s people code I felt I had to start bottom-up to get at least a feeling for how you setup a <a href="https://www.microsoft.com/microsoft-hololens" target="_blank">HoloLens</a> app – even though I don’t have a HoloLens. Call it my natural curiosity. So I followed my fellow MVP <a href="http://sharpgis.net/" target="_blank">Morten Nielsen’s blog</a> – highly recommended – as he starts with the real basics. Very good if you hardly have a clue what you are doing ;)</p> <p>In his <a href="http://sharpgis.net/post/2016/04/10/Using-HoloLens-Spatial-Mapping-to-occlude-objects" target="_blank">third post</a>, I ran into a snag. According to his <a href="http://sharpgis.net/post/2016/04/10/Installing-HoloLens-HoloToolkit-into-your-Unity-Project" target="_blank">second</a> post, I had unzipped the <a href="https://github.com/microsoft/HoloToolkit-Unity" target="_blank">HoloLens toolkit</a> into the assets folder as instructed, and started to add occlusion to my project. Morten explains in detail what this is – it makes holograms disappear behind physical objects like a wall when they are ‘in front’ of the holograms (which, in reality, they never can be as they are projected on a screen not 2 inch from your eyes, but that is the magic of HoloLens).</p> <p>So I added a rectangular box as a Hologram, having it stick out of a wall like halfway, so I was supposed only to see the front part. That I did, but I did also see something else:</p> <p><a href="http://www.schaikweb.net/dotnetbyexample/Default-HoloLens-Toolkit-occlusion-scrip_F912/image.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/Default-HoloLens-Toolkit-occlusion-scrip_F912/image_thumb.png" width="644" height="367"></a></p> <p>Yikes – that is my box all right, but where did that horrible magenta color come from? To this moment, I still don’t know, but I found out how to fix it.</p> <p>First of all, it really helps if, in addition to making the settings to your project that Morten describes in his <a href="http://sharpgis.net/post/2016/04/10/Creating-your-very-first-holographic-app-in-Unity" target="_blank">first post</a>, you tick at least “Unity C# project” as well in Build Settings:</p> <p><a href="http://www.schaikweb.net/dotnetbyexample/Default-HoloLens-Toolkit-occlusion-scrip_F912/image_3.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/Default-HoloLens-Toolkit-occlusion-scrip_F912/image_thumb_3.png" width="498" height="484"></a></p> <p>I do the “Development Build” as well, although I don’t really know if this is neccesary).</p> <p>This makes all the scripts end up in your Visual Studio solution as well, and what is more, <em>you can debug them</em>. Thus I learned that the script “SpatialMappingRenderer.cs” (in folder Assets\HoloToolkit\SpatialMapping\Scripts\SpatialMappingComponent) looks for materials “Occlusion” and “WireFrame” that are clearly not there.</p> <p><a href="http://www.schaikweb.net/dotnetbyexample/Default-HoloLens-Toolkit-occlusion-scrip_F912/image_4.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/Default-HoloLens-Toolkit-occlusion-scrip_F912/image_thumb_4.png" width="644" height="187"></a></p> <p>If you debug this script (you can now thanks to the setting above) you will see both OcclusionMaterial and RenderingMaterial end up as null. The materials are in HoloToolkit/SpatialMapping/Materials but changing “HoloToolkit” to “HoloToolkit/SpatialMapping/Materials” does not have any effect. </p> <p>So I went back to the Unity editor, selected the Spatial Mapping Renderer script again, changed the dropdown “Render mode” from “Occlusion” to “Material”, and that made the property “Render Material” pop up. I found the Occlusion Material on top of it, and it was accepted.</p> <p><a href="http://www.schaikweb.net/dotnetbyexample/Default-HoloLens-Toolkit-occlusion-scrip_F912/image_5.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/Default-HoloLens-Toolkit-occlusion-scrip_F912/image_thumb_5.png" width="607" height="484"></a></p>    <p>If I <em>now</em> debug the code, the Occlusion material is still null, but RenderingMaterial is set, and lo and behold:</p> <p><a href="http://www.schaikweb.net/dotnetbyexample/Default-HoloLens-Toolkit-occlusion-scrip_F912/image_6.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="http://www.schaikweb.net/dotnetbyexample/Default-HoloLens-Toolkit-occlusion-scrip_F912/image_thumb_6.png" width="644" height="367"></a></p> <p>Now I am seeing what I expect to see – a box sticking out of a wall. </p> <p>Disclaimer – I am just happily stumbling along trough Unity3D and HoloLens, not hampered by much knowledge of either. I found a problem (that I maybe caused myself) and I fixed it. I hope it helps someone. If I messed up, maybe someone can enlighten me. Unlike some other people, I am not afraid to look a n00b because in this case, that’s just what I am.</p> <p>The project itself can be found <a href="http://www.schaikweb.net/dotnetbyexample/gazer.zip" target="_blank">in a good old-fashioned ZIP file</a> as I don’t want to clutter up my GitHub account with every little thing I try at this stage. I am still in the stage of ‘programming by changing things and observing their effects’, so I hope you will humor me. And maybe this will help someone, who knows.</p>