---
layout: post
title: Messaging class for detecting and broadcasting that your Universal app is running
  in the background
date: '2014-06-24T21:27:00.001+02:00'
orgauthor: Joost van Schaik
tags:
- Windows phone 8.1
- windev
- wpdev
- Windows 8
modified_time: '2014-06-24T21:27:43.345+02:00'
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-7940576129440201351
blogger_orig_url: https://dotnetbyexample.blogspot.com/2014/06/messaging-class-for-detecting-and.html
---

<p>Some time ago I discovered that <a href="http://dotnetbyexample.blogspot.nl/2012/06/detecting-your-windows-8-app-is-running.html" target="_blank">you can trap Window.Current.VisibilityChanged</a> in a Windows 8 app to check if the app was running in the background, and that you can use that moment to pause a game and/or save the state to storage. The fun thing is, this now works in Universal apps too, that is – and thus, also on <a href="http://www.microsoft.com/windowsphone/?ocid=aff-n-we-loc--ITPRO40939&amp;WT.mc_id=aff-n-we-loc--ITPRO40939" target="_blank">Windows Phone</a> 8.1.Although we can discuss if&nbsp; the app is really running in the background or that is actually being suspended when it runs on Windows Phone – the mechanism is the same and it can be used to the same end.</p> <p>So make this more easy to use, I made this very simple class, based upon the MVVMLight MessageBase class:</p><pre>using Windows.UI.Xaml;
using GalaSoft.MvvmLight.Messaging;

namespace WpWinNl.Messages
{
  public class WindowVisibilityMessage : MessageBase
  {
    public WindowVisibilityMessage(bool visible, object sender = null, <br>                                   object target = null) :base(sender, target)
    {
      Visible = visible;
    }
    public bool Visible { get; protected set; }

    public static void Setup()
    {
      Window.Current.VisibilityChanged += 
      (s, f) =&gt; Messenger.Default.Send(new WindowVisibilityMessage(f.Visible));
    }
  }
}</pre>
<p>and all you have to use it, is to simply put</p><pre>protected override void OnLaunched(LaunchActivatedEventArgs e)
{
   WindowVisibilityMessage.Setup();
   //Rest of code omitted
 </pre>
<p>in the first line of OnLaunched in the App.Xaml.cs</p>
<p>Now anywhere in your app you can now listen for the WindowVisibilityMessage to come by and act on it, like this:</p><pre>Messenger.Default.Register&lt;WindowVisibilityMessage&gt;(this, p =&gt;
{
  if (p.Visible)
  {
    //do something 
  }
  else
  {
    //do something else
  }
});</pre>
<p>And that’s all. The <a href="http://wpwinnl.codeplex.com/SourceControl/latest#portable-win81+wpa81/WpWinNl.MvvmLight/Messages/WindowVisibilityMessage.cs" target="_blank">source of this class is already on codeplex</a> and it’s also in the full <a href="http://WpWinNl.codeplex.com" target="_blank">WpWinNl</a> NuGet package that I released yesterday. Since this class and it’s use is prettysimple and straightforward, I am going to skip a sample solution. A more comprehensive sample where this class plays a minor supporting role is coming soon</p>  