---
layout: post
title: Responding to focus and showing data when tapping a hologram in Mixed Reality/HoloLens
  apps
date: '2018-11-02T21:53:00.002+01:00'
orgauthor: Joost van Schaik
tags:
- HoloLens
- Windows Mixed Reality
- Unity3D
modified_time: '2018-11-02T21:54:12.924+01:00'
thumbnail: https://lh3.googleusercontent.com/-peTKywuhL-0/W9wppnPXMzI/AAAAAAAAQRU/1ZH9jZ-vc10kz4GAL1TEuhJM0rO6MDjhwCHMYCw/s72-c/image_thumb%255B16%255D?imgmax=800
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-751809375444055779
blogger_orig_url: https://dotnetbyexample.blogspot.com/2018/11/responding-to-focus-and-showing-data.html
---

<h2>Intro</h2><p>One of the things you tend to forget as you progress into a field of expertise is how hard the first steps were. I feel that responding when gaze strikes a hologram or showing some data when an hologram is air tapped are fairly basic - but judging by the number of questions I get for "how to do this", this is apparently not so straightforward as it seems. So I decided to make a little sample that you <a href="https://github.com/LocalJoost/ClickAndShowData" target="_blank">can get from GitHub here</a>.</p><h2>Project setup</h2><a href="https://lh3.googleusercontent.com/-Hgg5EBK0ae4/W9wposHi0sI/AAAAAAAAQRQ/H189E83G-SsZu4Qzj07_VwRnqYIBXpX1gCHMYCw/s1600-h/image%255B20%255D"><img width="240" height="240" title="image" align="right" style="border-image: none; float: right; display: inline;" alt="image" src="https://lh3.googleusercontent.com/-peTKywuhL-0/W9wppnPXMzI/AAAAAAAAQRU/1ZH9jZ-vc10kz4GAL1TEuhJM0rO6MDjhwCHMYCw/image_thumb%255B16%255D?imgmax=800"></a>I created a new project in Unity. Then:<ul><li>I imported the <a href="https://github.com/Microsoft/MixedRealityToolkit-Unity" target="_blank">Mixed Reality Toolkit</a> (<a href="https://github.com/Microsoft/MixedRealityToolkit-Unity/releases/tag/2017.4.2.0" target="_blank">this version</a> to be specific)</li><li>I configured Project, Scene and app Capabilities with the Mixed Reality Toolkit menu item</li><li>I download a <a href="https://www.cgtrader.com/items/214334/download-page" target="_blank">model of a satellite</a> to have something to interact with</li></ul><p><br></p><p><br></p><p>Now this model has some less than ideal size (as in being <em>very big) </em>so I fiddled a bit with the settings to get a more or less the view as displayed to the right</p><p><a href="https://lh3.googleusercontent.com/-xEjcVyUvUAU/W9yqJlXdlTI/AAAAAAAAQR4/NYN9QIoTjSYVLHeg-b4GT09e4MPzl5nGwCHMYCw/s1600-h/image4%255B2%255D"><img width="500" height="145" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-_ZgyZ1Od1Cc/W9yqKSvMFjI/AAAAAAAAQR8/r_0WTru7DA4qyP30dSFCqK33jFBf7XMbQCHMYCw/image4_thumb%255B1%255D?imgmax=800" border="0"></a></p><p>Now this model consist out a lot of sub objects, so this is nice model to interact with.</p><h2>Creating interaction</h2><p>What a hologram needs for interaction is pretty simple:</p><ul><li>A <a href="https://docs.unity3d.com/ScriptReference/Collider.html" target="_blank">collider</a> (so the gaze cursor has something to strike <em>against)</em></li><li>For an air tap to be intercepted: a behaviour that implements the interface IInputClickHandler</li><li>For registering focus (that is, the gaze cursor strikes it): a behaviour that implements IFocusable.</li></ul><p>But this satellite has like 41 parts, and if we have to manually add a collider and 1 or two behaviors to that, it's a bit bothersome. That in this case, we can solve that by using a behaviour that sets that up for us. Mind you, that's not always possible. But for this simple sample we can.</p><p>The behaviour looks like this:</p><pre style="font-size: 12px;">using UnityEngine;

public class InteractionBuilder : MonoBehaviour
{
    [SerializeField]
    private GameObject _toolTip;
    
    void Start ()
    {
        foreach (var child in GetComponentsInChildren&lt;MeshFilter&gt;())
        {
            child.gameObject.AddComponent&lt;MeshCollider&gt;();
            var displayer = child.gameObject.AddComponent&lt;DataDisplayer&gt;();
            displayer.ToolTip = _toolTip;
        }
    }
}
</pre><p>If simply walks find every MeshFilter child component, and adds an collider and a DataDisplayer to the game object where the MeshFiilter belongs to. The intention is to drag this on the main CommunicationSatellite object. But not right yet - because for this to work, we first need to create DataDisplayer, which is the behaviour implementing IInputClickHandler and IFocusable<h2>Show tooltip on click - implementing IInputClickHandler</h2><p>The first version of DataDisplayer looks like this:<pre style="font-size: 12px;">using HoloToolkit.Unity.InputModule;
using HoloToolkit.UX.ToolTips;
using UnityEngine;

public class DataDisplayer : MonoBehaviour, IInputClickHandler
{
    public GameObject ToolTip;

    private GameObject _createdToolTip;

    public void OnInputClicked(InputClickedEventData eventData)
    {
        if (_createdToolTip == null)
        {
            _createdToolTip = Instantiate(ToolTip);
            var toolTip = _createdToolTip.GetComponent&lt;ToolTip&gt;();
            toolTip.ShowOutline = false;
            toolTip.ShowBackground = true;
            toolTip.ToolTipText = gameObject.name;
            toolTip.transform.position = transform.position + Vector3.up * 0.2f;
            toolTip.transform.parent = transform.parent;
            toolTip.AttachPointPosition = transform.position;
            toolTip.ContentParentTransform.localScale = new Vector3(0.05f, 0.05f, 0.05f);
            var connector = toolTip.GetComponent&lt;ToolTipConnector&gt;();
            connector.Target = _createdToolTip;
        }
        else
        {
            Destroy(_createdToolTip);
            _createdToolTip = null;
        }
    }
}</pre><p>Now this may look a bit complicated, but most of it I just stole from the <a href="https://github.com/Microsoft/MixedRealityToolkit-Unity/blob/3cb2b0ea1233d4d89fe2c09bb7deb41a7c5ff171/Assets/HoloToolkit/UX/Scripts/Tooltip/ToolTipSpawner.cs" target="_blank">ToolTipSpawner</a> class. Basically it only does this:</p><ul><li>When the hologram-part is clicked (and OnInputClicked is called, which is a mandatory method when you implement IInputClickHandler) it checks if a tooltip already exists.</li><li>If not, it creates one a little above the clicked element</li><li>If a tooltip already exists, it's is deleted again.</li></ul><p>This behaviour get it's&nbsp; tooltip prefab handed from the InteractionBuilder. As I said, InteractionBuider should be dragged on the CommunicationSatellite root hologram, and now we have built our DataDisplayer, we can actually do so. </p><p><a href="https://lh3.googleusercontent.com/-EFVG_u7uXYM/W9yqLIqgtuI/AAAAAAAAQSA/RzVfte0cf1whzL3ZVXVS_v4sIhtHaY9WACHMYCw/s1600-h/image%255B6%255D"><img width="500" height="173" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-amzy-PgDK1E/W9yqLznymxI/AAAAAAAAQSE/kLOkD1a8-AsYLjHy01VfCHZxpxSsAS1NwCHMYCw/image_thumb%255B3%255D?imgmax=800" border="0"></a></p><p>The Tooltip field needs to be filled by dragging the Tooltip prefab from HoloToolkit/Ux/sefabs on top of it</p><p><a href="https://lh3.googleusercontent.com/-cMgPpq8PAbk/W9yqMogISkI/AAAAAAAAQSI/ae-0gktLdWg639qaue0rlPSqYrudS9nvQCHMYCw/s1600-h/image%255B15%255D"><img width="300" height="144" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-hqJG_1FCGXw/W9yqNQXHyBI/AAAAAAAAQSM/-PL8bWzk5-sIkPf2cpnqoM2hqGPqeXs4QCHMYCw/image_thumb%255B8%255D?imgmax=800" border="0"></a></p><p>Now, if you tap on an element of the satellite, you will get tooltip data with the name of the element</p><p><a href="https://lh3.googleusercontent.com/-5RCaRh1je9c/W9yqOITvPBI/AAAAAAAAQSQ/tZ5Iut90jIUtxRG80tj7WxqxLVXRWgusQCHMYCw/s1600-h/image%255B19%255D"><img width="240" height="192" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/-l9_L6iG2T5o/W9yqOqysSlI/AAAAAAAAQSU/iVXFsm3hPhsvPPpoDffxCVH3aBmD96YawCHMYCw/image_thumb%255B10%255D?imgmax=800" border="0"></a></p><p>Now in itself this is of course pretty much useless, but in stead of displaying the name directly you can also use the name or some other attribute of the Hologram part to reach out to a web service or a local data file, using that attribute as a key, fetch some data connected to that attribute and show <em>that </em>data. Is it a fairly commonly used pattern, but is up to you - and outside the scope of this blog - to have some data file or web service with connect.</p><h2>Highlighting on focus - implementing IFocusable</h2><p>It's not always easy to see which part of the satellite is hit by the gaze cursor, as they are both quite lightly colored. How about letting the whole part light up in red? We add the following code to DataDisplayer:</p><pre style="font-size: 12px;">public class DataDisplayer : MonoBehaviour, IInputClickHandler, IFocusable
{
    private Dictionary&lt;MeshRenderer, Color[]&gt; _originalColors = <br>            new Dictionary&lt;MeshRenderer, Color[]&gt;();

    void Start()
    {
        SaveOriginalColors();
    }
    
    public void OnFocusEnter()
    {
        SetHighlight(true);
    }

    public void OnFocusExit()
    {
        SetHighlight(false);
    }
}</pre><p>This looks pretty simple</p><ul><li>A start you save a hologram part's original colors</li><li>If the gaze strikes the hologram, set the highlight colors</li><li>If the gaze leaves, turn highlight off </li></ul><p>It sometimes helps to make code self-explanatory and to write it like this.</p><p>So saving the original colors works like this - and it conveniently makes an inventory of the components inside each hologram-part and the materials they use:</p><pre style="font-size: 12px;">private void SaveOriginalColors()
{
    if (!_originalColors.Any())
    {
        foreach (var component in GetComponentsInChildren&lt;MeshRenderer&gt;())
        {
            var colorList = new List&lt;Color&gt;();

            foreach (var t in component.materials)
            {
                colorList.Add(t.color);
            }
            _originalColors.Add(component, colorList.ToArray());
        }
    }
} </pre><p>Creating the highlight is not very complex now anymore</p><pre style="font-size: 12px;">private void SetHighlight(bool status)
{
    var targetColor = Color.red;
    foreach (var component in _originalColors.Keys) 
    {
        for (var i = 0; i &lt; component.materials.Length; i++)
        {
            component.materials[i].color = status ? 
                targetColor : _originalColors[component][i];
        }
    }
}</pre><p>Basically we set the color of every material inside the the component to red if status is true - or to it's original color when it is false. And now, if the gaze cursor strikes part of our satellite:</p><p><a href="https://lh3.googleusercontent.com/-TWRKwhkRqdY/W9y5NVFA_dI/AAAAAAAAQS0/MFjGlj7d2PwTqKgmVLhuhaJkbTFTxHaKwCHMYCw/s1600-h/image%255B23%255D"><img width="240" height="228" title="image" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" alt="image" src="https://lh3.googleusercontent.com/--Frg9QG3W_s/W9y5N5t7uUI/AAAAAAAAQS4/coYv84AQd344n1_UGJJGPMV9sn9GfUwLwCHMYCw/image_thumb%255B12%255D?imgmax=800" border="0"></a></p><h2>Conclusion</h2><p>And that's all there is to it. As I wrote, I would like to suggest showing else than the name of the hologram as that is not very interesting. Also, a bit more elaborate way of showing the data than using the the Tooltip might be considered. But the principle - implementing IInputClickHandler and IFocusable
and acting on that - stays the same.</p><p>The finished demo project can be found <a href="https://github.com/LocalJoost/ClickAndShowData" target="_blank">here</a>.</p>