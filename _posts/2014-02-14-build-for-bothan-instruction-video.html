---

title: Build for both–an instruction video pivot page for Windows store apps
date: '2014-02-14T22:13:00.001+01:00'
orgauthor: Joost van Schaik
tags:
- windev
- dotnetmag
- Windows Phone
- Windows 8
- XAML
- Win8nl
modified_time: '2014-02-17T08:16:02.349+01:00'
blogger_id: tag:blogger.com,1999:blog-5295746446529817470.post-472246388632389546
blogger_orig_url: https://dotnetbyexample.blogspot.com/2014/02/build-for-bothan-instruction-video.html
---

<p>For my game 2 Phone Pong – and its Windows 8.1 counterpart 2 Tablet Pong, that at the time of this writing is going through some interesting certification challenges&nbsp; – I created a page with <em>video</em> instructions. I did not feel much like writing a lot of text on how to connect the apps and play the game – a short video usually tells so much more. That proved to be less straightforward than I had hoped, so I thought it a good idea to share how I got it to work.</p> <p>Both platforms have their own limitations and idiosyncrasies. Windows 8 does not have a Pivot, and <a href="http://www.microsoft.com/windowsphone/?ocid=aff-n-we-loc--ITPRO40939&amp;WT.mc_id=aff-n-we-loc--ITPRO40939" target="_blank">Windows Phone</a> makes life pretty difficult when it comes to playing multiple videos on one page. I have solved the first problems by creating <a href="http://dotnetbyexample.blogspot.nl/2012/08/a-winrt-behavior-to-turn-flipview-into.html" target="_blank">FlipViewPanoramaBehavior</a> and I was successfully able to reuse that behavior, although it’s now running on top of the official Windows RT Behavior SDK, no longer using my stopgap project WinRtBehaviors.</p> <p>In this post I will show you how to build a video page for Windows Store apps – the next one will show you how to do the same for Windows Phone. The Windows version is actually the most simple</p> <p>When I set out to create the video instruction page I wanted it to do the following:</p> <ul> <li>Start the video on the current visible pivot item automatically – and start the first video on the first pivot as soon as the user access the page.  <li>Repeat that movie automatically when it ends  <li>Stop it as soon as the user selects a different pivot item</li></ul> <p>This gives the following effect:</p> <div id="scid:5737277B-5D6D-4f48-ABFC-DD9C333F4C5D:ea147514-c235-4e69-8734-fe917a5f0320" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><div><object width="638" height="358"><param name="movie" value="http://www.youtube.com/v/NA5xz6pv9Cc?hl=en&amp;hd=1"></param><embed src="http://www.youtube.com/v/NA5xz6pv9Cc?hl=en&amp;hd=1" type="application/x-shockwave-flash" width="638" height="358"></embed></object></div><div style="width:638px;clear:both;font-size:.8em">Store video instruction page demo</div></div> <p>How I got to this, is explained below</p> <p><font size="4">Setting the stage</font></p> <p>The beginning is pretty simple - it usually is ;-) </p> <ul> <li>Created an Blank XAML store app  <li>Bring in my <a href="http://WpWinNl.codeplex.com" target="_blank">WpWinNl</a> library from Nuget  <li>Add an empty page “Help.xaml”  <li>Go to App.xaml.cs and change <strong>rootFrame.Navigate(typeof(MainPage), e.Arguments);</strong> to <strong>rootFrame.Navigate(typeof(<u><em><font color="#ff0000">Help</font></em></u>), e.Arguments);</strong>  <li>Bring in a couple of video’s you want to use. I took three of my actual instruction videos from 2 Tablet Pong.</li></ul> <p><font size="4">The XAML basics</font></p> <p>The page contains the usual stuff for a nice page header, but as far as the video instruction part is concerned, it only contains the following things:</p> <ul> <li>A FlipView with some (very minor) styling for the header text  <li>My <a href="http://dotnetbyexample.blogspot.nl/2012/08/a-winrt-behavior-to-turn-flipview-into.html" target="_blank">FlipViewPanoramaBehavior</a> attached to it  <li>A few FlipViewItems, each containing a grid with a header and a MediaElement with the Video in it</li></ul> <p>That looks more or less like this:</p><pre>&lt;FlipView x:Name="VideoFlipView"  &gt;
  &lt;FlipView.Resources&gt;
    &lt;Style TargetType="TextBlock"&gt;
      &lt;Setter Property="FontSize" Value="30"&gt;&lt;/Setter&gt;
    &lt;/Style&gt;
  &lt;/FlipView.Resources&gt;
  &lt;interactivity:Interaction.Behaviors&gt;
    &lt;behaviors:FlipViewPanoramaBehavior/&gt;
  &lt;/interactivity:Interaction.Behaviors&gt;
  &lt;FlipViewItem &gt;
    &lt;Grid&gt;
      &lt;Grid.RowDefinitions&gt;
        &lt;RowDefinition Height="40"&gt;&lt;/RowDefinition&gt;
        &lt;RowDefinition Height="Auto"&gt;&lt;/RowDefinition&gt;
      &lt;/Grid.RowDefinitions&gt;
      &lt;TextBlock Text="Connect via WiFi" &gt;&lt;/TextBlock&gt;
      &lt;MediaElement x:Name="FirstMovieMediaElement" 
        Source="Video/ConnectWiFi.mp4" Grid.Row="1" &gt;
       &lt;/MediaElement &gt;
    &lt;/Grid&gt;
  &lt;/FlipViewItem&gt;
  &lt;!-- More FlipViewItems with video --&gt;
&lt;/FlipView&gt;</pre>
<p>Important to see is that both the FlipView and the first FlipViewItem have a name, this is because we need to reference it form the page code.</p>
<p><font size="4">Some code to make it work</font></p>
<p>First order or business is getting this thing on the road, so we need to define some starter events in the constructor:</p><pre>using System.Linq;
using Windows.UI.Xaml;
using Windows.UI.Xaml.Controls;
using Windows.UI.Xaml.Navigation;
using WpWinNl;
using WpWinNl.Utilities;

namespace Win8VideoPivot
{
  public sealed partial class Help : Page
  {
    public Help()
    {
      InitializeComponent();
      VideoFlipView.SelectionChanged += SelectedIndexChanged;
      FirstMovieMediaElement.MediaOpened += 
        FirstMovieMediaElementMediaOpened;
    }
  }
}</pre>
<p>Next up is a little helper property that give us a short cut to all the MediaElements on the page, using a helper method from <a href="http://WpWinNl.codeplex.com" target="_blank">WpWinNl</a>:</p><pre>private IEnumerable&lt;MediaElement&gt; AllMediaElements
{
  get
  {
    return VideoFlipView.GetVisualDescendents().OfType&lt;MediaElement&gt;();
  }
}</pre>The main method of this page is StartMovieOnSelectedFlipViewItem - that finds the MediaElement on the current selected FlipViewItem, stops MediaElements on all the <em>other</em> FlipViewItems, and kicks off the current one to play it's movie: <pre>private void StartMovieOnSelectedFlipViewItem()
{
  var pivotItem = (FlipViewItem)VideoFlipView.SelectedItem;
  var mediaItem = pivotItem.GetVisualDescendents().OfType&lt;MediaElement&gt;().FirstOrDefault();
  AllMediaElements.Where(p =&gt; p != mediaItem).ForEach(p =&gt; p.Stop());

  if (mediaItem != null)
  {
    mediaItem.Play();
  }
}
</pre>
<p>In the constructor we wired up FirstMovieMediaElementMediaOpened, to be fired when the first MediaElement has opened it's media file. It does, as you would expect, start the first movie file by simply calling StartMovieOnSelectedFlipViewItem&nbsp; What it also does is setting all the MediaElement’s AutoPlay properties to false, and attach a method to their MediaEnded property, so that a movie is automatically restarted again when it ends.</p><pre>private void FirstMovieMediaElementMediaOpened(object sender, RoutedEventArgs e)
{
  AllMediaElements.ForEach(p =&gt;
  {
    p.MediaEnded += MovieMediaElementMediaEnded;
    p.AutoPlay = false;
  });
  StartMovieOnSelectedFlipViewItem();
}

private void MovieMediaElementMediaEnded(object sender, RoutedEventArgs e)
{
  ((MediaElement)sender).Play();
}

</pre>
<p>This might seem a mighty odd place to do it here, and not in the constructor – but I have found that it simply does not have the desired effect when I placed this code in a constructor. A typical ‘yeah whatever’ thing.</p>
<p>The only thing that is now missing is SelectedIndexChanged, that we also wired up in the constructor to be executed when a new FlipViewItem is selected:</p><pre>private void SelectedIndexChanged(object sender, SelectionChangedEventArgs e)
{
  StartMovieOnSelectedFlipViewItem();
}</pre>
<p>It simply restarts a movie that ends all by itself. Note – this is <em>not</em> fired when a movie is stopped by code.</p>
<p>And for good measure, to make sure we don’t introduce all kinds of memory leaks, we detach all the events again in the OnNavigatedTo</p><pre>protected override void OnNavigatedFrom(NavigationEventArgs e)
{
  base.OnNavigatedFrom(e);
  AllMediaElements.ForEach(p =&gt;
  {
    p.MediaEnded -= MovieMediaElementMediaEnded;
  });
  VideoFlipView.SelectionChanged -= SelectedIndexChanged;
  FirstMovieMediaElement.MediaOpened -= FirstMovieMediaElementMediaOpened;
}</pre>
<p>That’s all there is to it – you will find that most of the work will actually go into making videos that are good enough to convey the minimal message without enormously blowing up the size of your app. The code itself, as you see, is pretty easy.</p>
<p>Full demo solution <a href="http://www.schaikweb.net/dotnetbyexample/Win8VideoPivot.zip" target="_blank">can be found here</a>.</p>
<p>Oh by the way – I did not suddenly do a 180 of MVVM versus code behind – this is just pure view stuff, no business logic needed to drive it, so it’s OK to use code behind in this case.</p>  